function e(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise((function(i,a){var o=t.apply(n,r);function s(t){e(o,i,a,s,u,"next",t)}function u(t){e(o,i,a,s,u,"throw",t)}s(void 0)}))}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}var s={exports:{}};!function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var i=t&&t.prototype instanceof g?t:g,a=Object.create(i.prototype),o=new N(r||[]);return a._invoke=function(e,t,n){var r=h;return function(i,a){if(r===v)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return D()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=T(o,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=v;var u=f(e,t,n);if("normal"===u.type){if(r=n.done?p:d,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r=p,n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var h="suspendedStart",d="suspendedYield",v="executing",p="completed",y={};function g(){}function m(){}function k(){}var b={};c(b,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(C([])));E&&E!==n&&r.call(E,a)&&(b=E);var _=k.prototype=g.prototype=Object.create(b);function I(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function n(i,a,s,u){var c=f(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"===o(h)&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function T(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method))return y;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var i=f(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,y;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function C(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:D}}function D(){return{value:t,done:!0}}return m.prototype=k,c(_,"constructor",k),c(k,"constructor",m),m.displayName=c(k,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,k):(e.__proto__=k,c(e,u,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},I(x.prototype),c(x.prototype,s,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new x(l(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},I(_),c(_,u,"Generator"),c(_,a,(function(){return this})),c(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:C(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":o(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}(s);var u=s.exports;function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){if(e){if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function f(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,n){return t&&h(e.prototype,t),n&&h(e,n),e}var v=function(){function e(t,r){if(n(this,e),!(t&&r&&t.length&&r.length))throw new Error("Invalid base string!");this.srcBase=t,this.dstBase=r}return d(e,[{key:"run",value:function(e){if(this.srcBase===this.dstBase)return e;for(var t=e.length,n=0,r=0,i=this.srcBase.length,a=this.dstBase.length,o="",s={},u=0;u<t;u++)s[u]=this.srcBase.indexOf(e[u]);do{r=0,n=0;for(var c=0;c<t;c++)(r=r*i+s[c])>=a?(s[n++]=parseInt((r/a).toString(),10),r%=a):n>0&&(s[n++]=0);t=n,o=this.dstBase[r]+o}while(0!=n);return o}}]),e}(),p=function(){function e(){n(this,e)}return d(e,[{key:"checkBase",value:function(e){if(f(new Set(Array.from(e))).length!==e.length)throw new Error("The given base string has duplicate characters resulting in unreliable results.")}},{key:"uuidv4",value:function(){var e=window.crypto||window.msCrypto;return e?"10000000-1000-4000-8000-100000000000".replace(/[018]/g,(function(t){return(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)})):""}},{key:"new",value:function(){return this.generate(e.BASE_DEF)}},{key:"generate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.BASE_DEF;return this.translate(this.uuidv4(),e.BASE_HEX,t)}},{key:"translate",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.BASE_DEF,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.BASE_HEX;t=t.replace(/-/g,"");var i=Math.ceil(Math.log(Math.pow(2,128))/Math.log(r.length));return this.formatUuidV4(new v(n,r).run(t).padStart(i,r[0]))}},{key:"formatUuidV4",value:function(e){var t=e.match(/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/);return t?[t[1],t[2],t[3],t[4],t[5]].join("-"):e}}],[{key:"BASE_DEF",get:function(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"}},{key:"BASE_BIN",get:function(){return"01"}},{key:"BASE_OCT",get:function(){return"01234567"}},{key:"BASE_DEC",get:function(){return"0123456789"}},{key:"BASE_HEX",get:function(){return"0123456789abcdef"}}]),e}(),y=function e(t){var i=this;if(n(this,e),r(this,"queryType","invalid"),r(this,"query",null),r(this,"type",(function(){return i.queryType})),r(this,"data",(function(){return i.query})),r(this,"isValidOperator",(function(e){return["<","<=","==","!=",">=",">","array-contains","array-contains-any","in","not-in"].includes(e)})),"object"===o(t))try{!Array.isArray(t)&&Object.keys(t).length&&(this.queryType="conditional")}catch(e){}else"string"==typeof t&&t.length&&(this.queryType="string");"invalid"!==this.queryType&&(this.query=t)};function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||l(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function m(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}var k=function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(n(this,e),this._available={},this._queue={},this.lock=function(e){return m(t,void 0,void 0,u.mark((function t(){var n=this;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=e||"_default")in this._available||(this._available[e]=this._concurrency,this._queue[e]=[]),t.t0=this.isLocked(e),!t.t0){t.next=5;break}return t.next=5,new Promise((function(t){n._queue[e].push(t)}));case 5:this._available[e]-=1;case 6:case"end":return t.stop()}}),t,this)})))},this.unlock=function(e){e=e||"_default",t._available[e]<t._concurrency&&(t._available[e]+=1);var n=t._queue[e].shift();n&&n()},this.isLocked=function(e){return e=e||"_default",0===t._available[e]},r<=0)throw new Error("Only positive number allowed!");this._concurrency=r};function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function _(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}var x=function(){function e(){n(this,e)}return d(e,null,[{key:"Literal",value:function(e,t){if(!t)return!1;e=e.toLowerCase(),t=t.trim().toLowerCase();var n=new RegExp("\\s+$").test(e)?[e]:e.trim().split(" ");return n.filter((function(e){return t.indexOf(e)>=0})).length===n.length}},{key:"Fuzzy",value:function(e,t){if(!t)return!1;if(e.length>t.length)return!1;if(e=e.toLowerCase(),t=t.toLowerCase(),e.length===t.length)return e===t;e:for(var n=0,r=0;n<e.length;n++){for(var i=e.charCodeAt(n);r<t.length;)if(t.charCodeAt(r++)===i)continue e;return!1}return!0}}]),e}();function T(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var A=function e(i,a,s){var c=this;n(this,e),r(this,"_searchOptions",{fuzzy:!1,limit:Number.MAX_SAFE_INTEGER}),r(this,"_encryptionOptions",{algorithm:"sha256"}),r(this,"_isValidConfig",(function(e,t){if(!e)return!1;for(var n=!0,r=0;r<t.length;r++)if(!(t[r]in e)){n=!1;break}return n})),r(this,"_findStringMatches",(function(e,t,n,r){for(var i in t)if("_"!==i[0]){var a=t[i].toString();if(!c._isExcluded(a,r)&&n(e.data(),a))return!0}return!1})),r(this,"_findConditionalMatches",(function(e,t){for(var n=0,r=Object.entries(e.data());n<r.length;n++){var i=g(r[n],2),a=i[0],s=i[1];if(!(a in t))return!1;var u=t[a],c=s[0],l=s[1];if(o(u)===o(l))if("string"==typeof u||"number"==typeof u||"boolean"==typeof u)if("<"===c){if(!(u<l))return!1}else if("<="===c){if(!(u<=l))return!1}else if("=="===c){if(u!=l)return!1}else if("!="===c){if(u==l)return!1}else if(">="===c){if(!(u>=l))return!1}else{if(">"!==c)return!1;if(!(u>l))return!1}else{if("array-contains-any"!==c)return!1;if(!Array.isArray(u)||!Array.isArray(l))return!1;var f,h=!1,d=T(l);try{for(d.s();!(f=d.n()).done;){var v=f.value;if(u.includes(v)){h=!0;break}}}catch(e){d.e(e)}finally{d.f()}if(!h)return!1}else if("array-contains"===c){if(!Array.isArray(u))return!1;if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l)return!1;if(!u.includes(l))return!1}else if("in"===c){if(!Array.isArray(l))return!1;if("string"!=typeof u&&"number"!=typeof u&&"boolean"!=typeof u)return!1;if(!l.includes(u))return!1}else{if("not-in"!==c)return!1;if("string"!=typeof u&&"number"!=typeof u&&"boolean"!=typeof u)return!1;if(Array.isArray(l)){if(l.includes(u))return!1}else{if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l)return!1;if(!new RegExp(u.toString()).test(l.toString()))return!1}}}return!0})),r(this,"_isExcluded",(function(e,t){for(var n=0,r=t.length;n<r;n++)if(new RegExp(t[n]).test(e))return!0;return!1})),r(this,"import",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"export",function(){var e=t(u.mark((function e(n){var r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",{});case 2:return e.next=4,Promise.all(n.map(function(){var e=t(u.mark((function e(t){var n,r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.next=3,c.get(t);case 3:return(r=e.sent)&&(n[t]=r),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return r=e.sent,i={},r.forEach((function(e){Object.assign(i,e)})),e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this._order=a,this._storageName=s.name,this._name=i,Object.assign(this._searchOptions,s.search)};function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}var C=function(e){E(a,A);var i=N(a);function a(e,o,s){var c;return n(this,a),r(b(c=i.call(this,e,o,s)),"keys",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.keys(c._collection));case 1:case"end":return e.stop()}}),e)})))),r(b(c),"get",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in c._collection){e.next=2;break}return e.abrupt("return",null);case 2:return e.abrupt("return",c._collection[t]);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(b(c),"set",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,c._collection[t]=n,e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"update",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,c.get(t);case 4:if(r=e.sent){e.next=7;break}return e.abrupt("return",!1);case 7:return Object.keys(r).forEach((function(e){r=r,e in n&&r[e]})),e.abrupt("return",c.set(t,r));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"sort",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._order.sort(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"search",function(){var e=t(u.mark((function e(t,n){var r,i,a,o,s,l,h,d,v,p;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="string"===t.type(),i=n.range,a=n.fuzzy?x.Fuzzy:x.Literal,o=n.exclude,s=n.limit,l=f(i),h=[],d=u.mark((function e(n){var f,d;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f=i[n],e.next=3,c.get(f);case 3:if(d=e.sent){e.next=6;break}return e.abrupt("return","continue");case 6:if(!r){e.next=16;break}if(!c._findStringMatches(t,d,a,o)){e.next=14;break}if(h.push(f),!(h.length>=s)){e.next=11;break}return e.abrupt("return","break");case 11:if(l=l.filter((function(e){return e!==f})),l.length){e.next=14;break}return e.abrupt("return","break");case 14:e.next=23;break;case 16:if(!c._findConditionalMatches(t,d)){e.next=23;break}if(h.push(f),!(h.length>=s)){e.next=20;break}return e.abrupt("return","break");case 20:if(l=l.filter((function(e){return e!==f})),l.length){e.next=23;break}return e.abrupt("return","break");case 23:case"end":return e.stop()}}),e)})),v=0;case 9:if(!(v<i.length)){e.next=19;break}return e.delegateYield(d(v),"t0",11);case 11:if("continue"!==(p=e.t0)){e.next=14;break}return e.abrupt("continue",16);case 14:if("break"!==p){e.next=16;break}return e.abrupt("break",19);case 16:v++,e.next=9;break;case 19:return e.abrupt("return",h);case 20:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"remove",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in c._collection){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,delete c._collection[t],e.abrupt("return",!0);case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()),r(b(c),"clear",t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t in e.prev=0,c._collection)delete c._collection[t];return e.abrupt("return",!0);case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))),r(b(c),"destroy",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete c._collection,e.abrupt("return",!0);case 2:case"end":return e.stop()}}),e)})))),c._collection={},c}return a}(),D={exports:{}},R=D.exports=function e(t,n,r){function i(s,u){if(!n[s]){if(!t[s]){if(!u&&a)return a(s);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,(function(e){var n=t[s][1][e];return i(n||e)}),l,l.exports,e,t,n,r)}return n[s].exports}for(var o=a,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){(function(e){var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var a=0,o=new i(l),s=e.document.createTextNode("");o.observe(s,{characterData:!0}),n=function(){s.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var u=new e.MessageChannel;u.port1.onmessage=l,n=function(){u.port2.postMessage(0)}}var c=[];function l(){var e,t;r=!0;for(var n=c.length;n;){for(t=c,c=[],e=-1;++e<n;)t[e]();n=c.length}r=!1}function f(e){1!==c.push(e)||r||n()}t.exports=f}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function i(){}var a={},s=["REJECTED"],u=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&v(this,e)}function f(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function h(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)}))}function d(e){var t=e&&e.then;if(e&&("object"===o(e)||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function v(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function i(t){n||(n=!0,a.resolve(e,t))}function o(){t(i,r)}var s=p(o);"error"===s.status&&r(s.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function y(e){return e instanceof this?e:a.resolve(new this(i),e)}function g(e){var t=new this(i);return a.reject(t,e)}function m(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,u=-1,c=new this(i);++u<n;)l(e[u],u);return c;function l(e,i){function u(e){o[i]=e,++s!==n||r||(r=!0,a.resolve(c,o))}t.resolve(e).then(u,(function(e){r||(r=!0,a.reject(c,e))}))}}function k(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var o=-1,s=new this(i);++o<n;)u(e[o]);return s;function u(e){t.resolve(e).then((function(e){r||(r=!0,a.resolve(s,e))}),(function(e){r||(r=!0,a.reject(s,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===u||"function"!=typeof t&&this.state===s)return this;var n=new this.constructor(i);return this.state!==c?h(n,this.state===u?e:t,this.outcome):this.queue.push(new f(n,e,t)),n},f.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},f.prototype.otherCallFulfilled=function(e){h(this.promise,this.onFulfilled,e)},f.prototype.callRejected=function(e){a.reject(this.promise,e)},f.prototype.otherCallRejected=function(e){h(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)v(e,r);else{e.state=u,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},a.reject=function(e,t){e.state=s,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=y,l.reject=g,l.all=m,l.race=k},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"===o(Symbol.iterator)?function(e){return o(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":o(e)};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var s=a();function u(){try{if(!s||!s.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function f(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function h(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function d(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function v(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",y=void 0,g={},m=Object.prototype.toString,k="readonly",b="readwrite";function w(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function E(e){return new l((function(t){var n=e.transaction(p,b),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function _(e){return"boolean"==typeof y?l.resolve(y):E(e).then((function(e){return y=e}))}function I(e){var t=g[e.name],n={};n.promise=new l((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function x(e){var t=g[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function T(e,t){var n=g[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function S(e,t){return new l((function(n,r){if(g[e.name]=g[e.name]||P(),e.db){if(!t)return n(e.db);I(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var a=s.open.apply(s,i);t&&(a.onupgradeneeded=function(t){var n=a.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),a.onerror=function(e){e.preventDefault(),r(a.error)},a.onsuccess=function(){var t=a.result;t.onversionchange=function(e){e.target.close()},n(t),x(e)}}))}function A(e){return S(e,!1)}function N(e){return S(e,!0)}function C(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,i=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function D(e){return new l((function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)}))}function R(e){return c([w(atob(e.data))],{type:e.type})}function O(e){return e&&e.__local_forage_encoded_blob}function L(e){var t=this,n=t._initReady().then((function(){var e=g[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return h(n,e,e),n}function M(e){I(e);for(var t=g[e.name],n=t.forages,r=0;r<n.length;r++){var i=n[r];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,A(e).then((function(t){return e.db=t,C(e)?N(e):t})).then((function(r){e.db=t.db=r;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=r})).catch((function(t){throw T(e,t),t}))}function F(e,t,n,r){void 0===r&&(r=1);try{var i=e.db.transaction(e.storeName,t);n(null,i)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),N(e)})).then((function(){return M(e).then((function(){F(e,t,n,r-1)}))})).catch(n);n(i)}}function P(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function U(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var i=g[n.name];i||(i=P(),g[n.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=L);var a=[];function o(){return l.resolve()}for(var s=0;s<i.forages.length;s++){var u=i.forages[s];u!==t&&a.push(u._initReady().catch(o))}var c=i.forages.slice(0);return l.all(a).then((function(){return n.db=i.db,A(n)})).then((function(e){return n.db=e,C(n,t._defaultConfig.version)?N(n):e})).then((function(e){n.db=i.db=e,t._dbInfo=n;for(var r=0;r<c.length;r++){var a=c[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))}function j(e,t){var n=this;e=d(e);var r=new l((function(t,r){n.ready().then((function(){F(n._dbInfo,k,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),O(e)&&(e=R(e)),t(e)},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return f(r,t),r}function V(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){F(n._dbInfo,k,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n=o.result;if(n){var r=n.value;O(r)&&(r=R(r));var i=e(r,n.key,s++);void 0!==i?t(i):n.continue()}else t()},o.onerror=function(){r(o.error)}}catch(e){r(e)}}))})).catch(r)}));return f(r,t),r}function B(e,t,n){var r=this;e=d(e);var i=new l((function(n,i){var a;r.ready().then((function(){return a=r._dbInfo,"[object Blob]"===m.call(t)?_(a.db).then((function(e){return e?t:D(t)})):t})).then((function(t){F(r._dbInfo,b,(function(a,o){if(a)return i(a);try{var s=o.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var u=s.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),n(t)},o.onabort=o.onerror=function(){var e=u.error?u.error:u.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return f(i,n),i}function q(e,t){var n=this;e=d(e);var r=new l((function(t,r){n.ready().then((function(){F(n._dbInfo,b,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(o.error)},a.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return f(r,t),r}function z(e){var t=this,n=new l((function(e,n){t.ready().then((function(){F(t._dbInfo,b,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return f(n,e),n}function H(e){var t=this,n=new l((function(e,n){t.ready().then((function(){F(t._dbInfo,k,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return f(n,e),n}function K(e,t){var n=this,r=new l((function(t,r){e<0?t(null):n.ready().then((function(){F(n._dbInfo,k,(function(i,a){if(i)return r(i);try{var o=a.objectStore(n._dbInfo.storeName),s=!1,u=o.openKeyCursor();u.onsuccess=function(){var n=u.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},u.onerror=function(){r(u.error)}}catch(e){r(e)}}))})).catch(r)}));return f(r,t),r}function G(e){var t=this,n=new l((function(e,n){t.ready().then((function(){F(t._dbInfo,k,(function(r,i){if(r)return n(r);try{var a=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];a.onsuccess=function(){var t=a.result;t?(o.push(t.key),t.continue()):e(o)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return f(n,e),n}function W(e,t){t=v.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;if(e.name){var a=e.name===n.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):A(e).then((function(t){var n=g[e.name],r=n.forages;n.db=t;for(var i=0;i<r.length;i++)r[i]._dbInfo.db=t;return t}));r=e.storeName?a.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;I(e);var r=g[e.name],i=r.forages;t.close();for(var a=0;a<i.length;a++){var o=i[a];o._dbInfo.db=null,o._dbInfo.version=n}var u=new l((function(t,r){var i=s.open(e.name,n);i.onerror=function(e){i.result.close(),r(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return u.then((function(e){r.db=e;for(var t=0;t<i.length;t++){var n=i[t];n._dbInfo.db=e,x(n._dbInfo)}})).catch((function(t){throw(T(e,t)||l.resolve()).catch((function(){})),t}))}})):a.then((function(t){I(e);var n=g[e.name],r=n.forages;t.close();for(var i=0;i<r.length;i++)r[i]._dbInfo.db=null;var a=new l((function(t,n){var r=s.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}));return a.then((function(e){n.db=e;for(var t=0;t<r.length;t++)x(r[t]._dbInfo)})).catch((function(t){throw(T(e,t)||l.resolve()).catch((function(){})),t}))}))}else r=l.reject("Invalid arguments");return f(r,t),r}var Q={_driver:"asyncStorage",_initStorage:U,_support:u(),iterate:V,getItem:j,setItem:B,removeItem:q,clear:z,length:H,key:K,keys:G,dropInstance:W};function X(){return"function"==typeof openDatabase}var Y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$="~~local_forage_type~",J=/^~~local_forage_type~([^~]+)~/,Z="__lfsc__:",ee=Z.length,te="arbf",ne="blob",re="si08",ie="ui08",ae="uic8",oe="si16",se="si32",ue="ur16",ce="ui32",le="fl32",fe="fl64",he=ee+te.length,de=Object.prototype.toString;function ve(e){var t,n,r,i,a,o=.75*e.length,s=e.length,u=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var c=new ArrayBuffer(o),l=new Uint8Array(c);for(t=0;t<s;t+=4)n=Y.indexOf(e[t]),r=Y.indexOf(e[t+1]),i=Y.indexOf(e[t+2]),a=Y.indexOf(e[t+3]),l[u++]=n<<2|r>>4,l[u++]=(15&r)<<4|i>>2,l[u++]=(3&i)<<6|63&a;return c}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=Y[n[t]>>2],r+=Y[(3&n[t])<<4|n[t+1]>>4],r+=Y[(15&n[t+1])<<2|n[t+2]>>6],r+=Y[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function ye(e,t){var n="";if(e&&(n=de.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===de.call(e.buffer))){var r,i=Z;e instanceof ArrayBuffer?(r=e,i+=te):(r=e.buffer,"[object Int8Array]"===n?i+=re:"[object Uint8Array]"===n?i+=ie:"[object Uint8ClampedArray]"===n?i+=ae:"[object Int16Array]"===n?i+=oe:"[object Uint16Array]"===n?i+=ue:"[object Int32Array]"===n?i+=se:"[object Uint32Array]"===n?i+=ce:"[object Float32Array]"===n?i+=le:"[object Float64Array]"===n?i+=fe:t(new Error("Failed to get type for BinaryArray"))),t(i+pe(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n=$+e.type+"~"+pe(this.result);t(Z+ne+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}}function ge(e){if(e.substring(0,ee)!==Z)return JSON.parse(e);var t,n=e.substring(he),r=e.substring(ee,he);if(r===ne&&J.test(n)){var i=n.match(J);t=i[1],n=n.substring(i[0].length)}var a=ve(n);switch(r){case te:return a;case ne:return c([a],{type:t});case re:return new Int8Array(a);case ie:return new Uint8Array(a);case ae:return new Uint8ClampedArray(a);case oe:return new Int16Array(a);case ue:return new Uint16Array(a);case se:return new Int32Array(a);case ce:return new Uint32Array(a);case le:return new Float32Array(a);case fe:return new Float64Array(a);default:throw new Error("Unkown type: "+r)}}var me={serialize:ye,deserialize:ge,stringToBuffer:ve,bufferToString:pe};function ke(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function be(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var i=new l((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(i){ke(i,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=me,i}function we(e,t,n,r,i,a){e.executeSql(n,r,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?a(e,o):ke(e,t,(function(){e.executeSql(n,r,i,a)}),a)}),a):a(e,o)}),a)}function Ee(e,t){var n=this;e=d(e);var r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=i.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return f(r,t),r}function _e(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"SELECT * FROM "+i.storeName,[],(function(n,r){for(var a=r.rows,o=a.length,s=0;s<o;s++){var u=a.item(s),c=u.value;if(c&&(c=i.serializer.deserialize(c)),void 0!==(c=e(c,u.key,s+1)))return void t(c)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return f(r,t),r}function Ie(e,t,n,r){var i=this;e=d(e);var a=new l((function(a,o){i.ready().then((function(){void 0===t&&(t=null);var s=t,u=i._dbInfo;u.serializer.serialize(t,(function(t,c){c?o(c):u.db.transaction((function(n){we(n,u,"INSERT OR REPLACE INTO "+u.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void a(Ie.apply(i,[e,s,n,r-1]));o(t)}}))}))})).catch(o)}));return f(a,n),a}function xe(e,t,n){return Ie.apply(this,[e,t,n,1])}function Te(e,t){var n=this;e=d(e);var r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return f(r,t),r}function Se(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){we(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return f(n,e),n}function Ae(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){we(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return f(n,e),n}function Ne(e,t){var n=this,r=new l((function(t,r){n.ready().then((function(){var i=n._dbInfo;i.db.transaction((function(n){we(n,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return f(r,t),r}function Ce(e){var t=this,n=new l((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){we(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return f(n,e),n}function De(e){return new l((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var i=[],a=0;a<r.rows.length;a++)i.push(r.rows.item(a).name);t({db:e,storeNames:i})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}function Re(e,t){t=v.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,i=this;return r=e.name?new l((function(t){var r;r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(De(r))})).then((function(e){return new l((function(t,n){e.db.transaction((function(r){function i(e){return new l((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var a=[],o=0,s=e.storeNames.length;o<s;o++)a.push(i(e.storeNames[o]));l.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):l.reject("Invalid arguments"),f(r,t),r}var Oe={_driver:"webSQLStorage",_initStorage:be,_support:X(),iterate:_e,getItem:Ee,setItem:xe,removeItem:Te,clear:Se,length:Ae,key:Ne,keys:Ce,dropInstance:Re};function Le(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Me(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Fe(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function Pe(){return!Fe()||localStorage.length>0}function Ue(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Me(e,t._defaultConfig),Pe()?(t._dbInfo=n,n.serializer=me,l.resolve()):l.reject()}function je(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return f(n,e),n}function Ve(e,t){var n=this;e=d(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return f(r,t),r}function Be(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,i=r.length,a=localStorage.length,o=1,s=0;s<a;s++){var u=localStorage.key(s);if(0===u.indexOf(r)){var c=localStorage.getItem(u);if(c&&(c=t.serializer.deserialize(c)),void 0!==(c=e(c,u.substring(i),o++)))return c}}}));return f(r,t),r}function qe(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return f(r,t),r}function ze(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],i=0;i<n;i++){var a=localStorage.key(i);0===a.indexOf(e.keyPrefix)&&r.push(a.substring(e.keyPrefix.length))}return r}));return f(n,e),n}function He(e){var t=this.keys().then((function(e){return e.length}));return f(t,e),t}function Ke(e,t){var n=this;e=d(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return f(r,t),r}function Ge(e,t,n){var r=this;e=d(e);var i=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new l((function(i,a){var o=r._dbInfo;o.serializer.serialize(t,(function(t,r){if(r)a(r);else try{localStorage.setItem(o.keyPrefix+e,t),i(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||a(e),a(e)}}))}))}));return f(i,n),i}function We(e,t){if(t=v.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,i=this;return r=e.name?new l((function(t){e.storeName?t(Me(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):l.reject("Invalid arguments"),f(r,t),r}var Qe={_driver:"localStorageWrapper",_initStorage:Ue,_support:Le(),iterate:Be,getItem:Ve,setItem:Ge,removeItem:Ke,clear:je,length:He,key:qe,keys:ze,dropInstance:We},Xe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ye=function(e,t){for(var n=e.length,r=0;r<n;){if(Xe(e[r],t))return!0;r++}return!1},$e=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Je={},Ze={},et={INDEXEDDB:Q,WEBSQL:Oe,LOCALSTORAGE:Qe},tt=[et.INDEXEDDB._driver,et.WEBSQL._driver,et.LOCALSTORAGE._driver],nt=["dropInstance"],rt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(nt),it={description:"",driver:tt.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function at(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function ot(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&($e(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var st=function(){function e(t){for(var n in i(this,e),et)if(et.hasOwnProperty(n)){var r=et[n],a=r._driver;this[n]=a,Je[a]||this.defineDriver(r)}this._defaultConfig=ot({},it),this._config=ot({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new l((function(t,n){try{var r=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(i);for(var a=rt.concat("_initStorage"),o=0,s=a.length;o<s;o++){var u=a[o];if((!Ye(nt,u)||e[u])&&"function"!=typeof e[u])return void n(i)}var c=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=l.reject(t);return f(n,arguments[arguments.length-1]),n}},n=0,r=nt.length;n<r;n++){var i=nt[n];e[i]||(e[i]=t(i))}};c();var h=function(n){Je[r]&&console.info("Redefining LocalForage driver: "+r),Je[r]=e,Ze[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,n):h(!!e._support):h(!0)}catch(e){n(e)}}));return h(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Je[e]?l.resolve(Je[e]):l.reject(new Error("Driver not found."));return h(r,t,n),r},e.prototype.getSerializer=function(e){var t=l.resolve(me);return h(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return h(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;$e(e)||(e=[e]);var i=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function o(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}function s(e){return function(){var t=0;function n(){for(;t<e.length;){var i=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(i).then(o).catch(n)}a();var s=new Error("No available storage method found.");return r._driverSet=l.reject(s),r._driverSet}return n()}}var u=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=u.then((function(){var e=i[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=s(i)}))})).catch((function(){a();var e=new Error("No available storage method found.");return r._driverSet=l.reject(e),r._driverSet})),h(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Ze[e]},e.prototype._extend=function(e){ot(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=rt.length;e<t;e++)at(this,rt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),ut=new st;t.exports=ut},{3:3}]},{},[4])(4);function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}var L=function(e){E(a,A);var i=O(a);function a(e,o,s){var c;n(this,a),r(b(c=i.call(this,e,o,s)),"keys",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c._collection.keys();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))),r(b(c),"get",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c._collection.getItem(t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",null);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()),r(b(c),"set",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){c._collection.setItem(t,n).then((function(t){e(!0)})).catch((function(t){e(!1)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"update",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.get(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",Promise.resolve(!1));case 5:return Object.keys(r).forEach((function(e){r=r,e in n&&r[e]})),e.abrupt("return",c.set(t,r));case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"sort",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c._order.sort(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"search",function(){var e=t(u.mark((function e(t,n){var r,i,a,o,s,l,h;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="string"===t.type(),i=n.range,a=n.fuzzy?x.Fuzzy:x.Literal,o=n.exclude,s=n.limit,l=f(i),h=[],e.prev=7,e.next=10,c._collection.iterate((function(e,n){if(i.includes(n))if(r){if(c._findStringMatches(t,e,a,o)){if(h.push(n),h.length>=s)return;if(l=l.filter((function(e){return e!==n})),!l.length)return}}else if(c._findConditionalMatches(t,e)){if(h.push(n),h.length>=s)return;if(l=l.filter((function(e){return e!==n})),!l.length)return}}));case 10:return e.abrupt("return",h);case 13:return e.prev=13,e.t0=e.catch(7),e.abrupt("return",[]);case 16:case"end":return e.stop()}}),e,null,[[7,13]])})));return function(t,n){return e.apply(this,arguments)}}()),r(b(c),"remove",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){c._collection.removeItem(t).then((function(){e(!0)})).catch((function(t){e(!1)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(b(c),"clear",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){c._collection.clear().then((function(){e(!0)})).catch((function(t){e(!1)}))})));case 1:case"end":return e.stop()}}),e)})))),r(b(c),"destroy",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete c._collection,e.abrupt("return",!0);case 2:case"end":return e.stop()}}),e)}))));try{c._collection=R.createInstance({name:c._storageName,storeName:c._name})}catch(e){throw new Error("Unable to create IndexedDB instance.")}return c}return a}();function M(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function F(e,t,n){return F=M()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&w(i,n.prototype),i},F.apply(null,arguments)}function P(e){var t="function"==typeof Map?new Map:void 0;return P=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return F(e,arguments,I(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),w(n,e)},P(e)}function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}var j=function(){function e(){var t=this;n(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return d(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var B=function(e){E(r,P(Error));var t=U(r);function r(e,i,a){var o;return n(this,r),(o=t.call(this,i)).code=e,o.customData=a,o.name="FirebaseError",Object.setPrototypeOf(b(o),r.prototype),Error.captureStackTrace&&Error.captureStackTrace(b(o),q.prototype.create),o}return r}(),q=function(){function e(t,r,i){n(this,e),this.service=t,this.serviceName=r,this.errors=i}return d(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],i=r?z(r,t):"Error",a="".concat(this.serviceName,": ").concat(i," (").concat(n,")."),o=new B(n,a,t);return o}}]),e}();function z(e,t){return e.replace(H,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}var H=/\{\$([^}]+)}/g;function K(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),i=0,a=n;i<a.length;i++){var o=a[i];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(G(s)&&G(u)){if(!K(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var f=l[c];if(!n.includes(f))return!1}return!0}function G(e){return null!==e&&"object"===o(e)}
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function W(e){return e&&e._delegate?e._delegate:e}function Q(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return X(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Y=function(){function e(t,r,i){n(this,e),this.name=t,this.instanceFactory=r,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return d(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),$=function(){function e(t,r){n(this,e),this.name=t,this.container=r,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}var r;return d(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new j;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e))try{this.getOrInitializeService({instanceIdentifier:"[DEFAULT]"})}catch(e){}var t,n=Q(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=g(t.value,2),i=r[0],a=r[1],o=this.normalizeInstanceIdentifier(i);try{var s=this.getOrInitializeService({instanceIdentifier:o});a.resolve(s)}catch(e){}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DEFAULT]";this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:(r=t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat(f(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),f(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DEFAULT]";return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DEFAULT]";return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var i,a=this.getOrInitializeService({instanceIdentifier:r,options:n}),o=Q(this.instancesDeferred.entries());try{for(o.s();!(i=o.n()).done;){var s=g(i.value,2),u=s[0],c=s[1],l=this.normalizeInstanceIdentifier(u);r===l&&c.resolve(a)}}catch(e){o.e(e)}finally{o.f()}return a}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);var a=this.instances.get(r);return a&&e(a,r),function(){i.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,i=Q(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(e,t)}catch(e){}}}catch(e){i.e(e)}finally{i.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,a=this.instances.get(n);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,"[DEFAULT]"===t?void 0:t),options:i}),this.instances.set(n,a),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(a,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,a)}catch(e){}return a||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DEFAULT]";return this.component?this.component.multipleInstances?e:"[DEFAULT]":e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var J,Z,ee=function(){function e(t){n(this,e),this.name=t,this.providers=new Map}return d(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new $(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}();!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Z||(Z={}));var te,ne,re={debug:Z.DEBUG,verbose:Z.VERBOSE,info:Z.INFO,warn:Z.WARN,error:Z.ERROR,silent:Z.SILENT},ie=Z.INFO,ae=(r(J={},Z.DEBUG,"log"),r(J,Z.VERBOSE,"log"),r(J,Z.INFO,"info"),r(J,Z.WARN,"warn"),r(J,Z.ERROR,"error"),J),oe=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=ae[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i,a=arguments.length,o=new Array(a>2?a-2:0),s=2;s<a;s++)o[s-2]=arguments[s];(i=console)[r].apply(i,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},se=function(){function e(t){n(this,e),this.name=t,this._logLevel=ie,this._logHandler=oe,this._userLogHandler=null}return d(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in Z))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"==typeof e?re[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Z.DEBUG].concat(t)),this._logHandler.apply(this,[this,Z.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Z.VERBOSE].concat(t)),this._logHandler.apply(this,[this,Z.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Z.INFO].concat(t)),this._logHandler.apply(this,[this,Z.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Z.WARN].concat(t)),this._logHandler.apply(this,[this,Z.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Z.ERROR].concat(t)),this._logHandler.apply(this,[this,Z.ERROR].concat(t))}}]),e}();function ue(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var le=function(){function e(t){n(this,e),this.container=t}return d(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var fe="@firebase/app",he=new se("@firebase/app"),de=(r(te={},fe,"fire-core"),r(te,"@firebase/app-compat","fire-core-compat"),r(te,"@firebase/analytics","fire-analytics"),r(te,"@firebase/analytics-compat","fire-analytics-compat"),r(te,"@firebase/app-check","fire-app-check"),r(te,"@firebase/app-check-compat","fire-app-check-compat"),r(te,"@firebase/auth","fire-auth"),r(te,"@firebase/auth-compat","fire-auth-compat"),r(te,"@firebase/database","fire-rtdb"),r(te,"@firebase/database-compat","fire-rtdb-compat"),r(te,"@firebase/functions","fire-fn"),r(te,"@firebase/functions-compat","fire-fn-compat"),r(te,"@firebase/installations","fire-iid"),r(te,"@firebase/installations-compat","fire-iid-compat"),r(te,"@firebase/messaging","fire-fcm"),r(te,"@firebase/messaging-compat","fire-fcm-compat"),r(te,"@firebase/performance","fire-perf"),r(te,"@firebase/performance-compat","fire-perf-compat"),r(te,"@firebase/remote-config","fire-rc"),r(te,"@firebase/remote-config-compat","fire-rc-compat"),r(te,"@firebase/storage","fire-gcs"),r(te,"@firebase/storage-compat","fire-gcs-compat"),r(te,"@firebase/firestore","fire-fst"),r(te,"@firebase/firestore-compat","fire-fst-compat"),r(te,"fire-js","fire-js"),r(te,"firebase","fire-js-all"),te),ve=new Map,pe=new Map;function ye(e,t){try{e.container.addComponent(t)}catch(n){he.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function ge(e){var t=e.name;if(pe.has(t))return he.debug("There were multiple attempts to register component ".concat(t,".")),!1;pe.set(t,e);var n,r=ue(ve.values());try{for(r.s();!(n=r.n()).done;){ye(n.value,e)}}catch(e){r.e(e)}finally{r.f()}return!0}function me(e,t){return e.container.getProvider(t)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ke,be=(r(ne={},"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),r(ne,"bad-app-name","Illegal App name: '{$appName}"),r(ne,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),r(ne,"app-deleted","Firebase App named '{$appName}' already deleted"),r(ne,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),r(ne,"invalid-log-argument","First argument to `onLog` must be null or a function."),ne),we=new q("app","Firebase",be),Ee=function(){function e(t,r,i){var a=this;n(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},r),this._name=r.name,this._automaticDataCollectionEnabled=r.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Y("app",(function(){return a}),"PUBLIC"))}return d(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw we.create("app-deleted",{appName:this._name})}}]),e}();function _e(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"[DEFAULT]",t=ve.get(e);if(!t)throw we.create("no-app",{appName:e});return t}function Ie(e,t,n){var r,i=null!==(r=de[e])&&void 0!==r?r:e;n&&(i+="-".concat(n));var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var s=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return a&&s.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),a&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void he.warn(s.join(" "))}ge(new Y("".concat(i,"-version"),(function(){return{library:i,version:t}}),"VERSION"))}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ke="",ge(new Y("platform-logger",(function(e){return new le(e)}),"PRIVATE")),Ie(fe,"0.7.6",ke),Ie(fe,"0.7.6","esm2017"),Ie("fire-js","");function xe(e,t,n){return xe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=I(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},xe(e,t,n||e)}function Te(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Se(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function Se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ae(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Ie("firebase","9.3.0","app");var Ne,Ce="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},De=De||{},Re=Ce||self;function Oe(){}function Le(e){var t=o(e);return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Me(e){var t=o(e);return"object"==t&&null!=e||"function"==t}var Fe="closure_uid_"+(1e9*Math.random()>>>0),Pe=0;function Ue(e,t,n){return e.call.apply(e.bind,arguments)}function je(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Ve(e,t,n){return(Ve=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ue:je).apply(null,arguments)}function Be(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function qe(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),a=2;a<arguments.length;a++)i[a-2]=arguments[a];return t.prototype[n].apply(e,i)}}function ze(){this.s=this.s,this.o=this.o}var He={};ze.prototype.s=!1,ze.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,Fe)&&e[Fe]||(e[Fe]=++Pe)}(this);delete He[e]}},ze.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Ke=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Ge=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"==typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};function We(e){return Array.prototype.concat.apply([],arguments)}function Qe(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Xe(e){return/^[\s\xa0]*$/.test(e)}var Ye,$e=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Je(e,t){return-1!=e.indexOf(t)}function Ze(e,t){return e<t?-1:e>t?1:0}e:{var et=Re.navigator;if(et){var tt=et.userAgent;if(tt){Ye=tt;break e}}Ye=""}function nt(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function rt(e){var t={};for(var n in e)t[n]=e[n];return t}var it="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function at(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<it.length;a++)n=it[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ot(e){return ot[" "](e),e}ot[" "]=Oe;var st,ut,ct=Je(Ye,"Opera"),lt=Je(Ye,"Trident")||Je(Ye,"MSIE"),ft=Je(Ye,"Edge"),ht=ft||lt,dt=Je(Ye,"Gecko")&&!(Je(Ye.toLowerCase(),"webkit")&&!Je(Ye,"Edge"))&&!(Je(Ye,"Trident")||Je(Ye,"MSIE"))&&!Je(Ye,"Edge"),vt=Je(Ye.toLowerCase(),"webkit")&&!Je(Ye,"Edge");function pt(){var e=Re.document;return e?e.documentMode:void 0}e:{var yt="",gt=(ut=Ye,dt?/rv:([^\);]+)(\)|;)/.exec(ut):ft?/Edge\/([\d\.]+)/.exec(ut):lt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ut):vt?/WebKit\/(\S+)/.exec(ut):ct?/(?:Version)[ \/]?(\S+)/.exec(ut):void 0);if(gt&&(yt=gt?gt[1]:""),lt){var mt=pt();if(null!=mt&&mt>parseFloat(yt)){st=String(mt);break e}}st=yt}var kt,bt={};function wt(){return function(e){var t=bt;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){for(var e=0,t=$e(String(st)).split("."),n=$e("9").split("."),r=Math.max(t.length,n.length),i=0;0==e&&i<r;i++){var a=t[i]||"",o=n[i]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==a[0].length&&0==o[0].length)break;e=Ze(0==a[1].length?0:parseInt(a[1],10),0==o[1].length?0:parseInt(o[1],10))||Ze(0==a[2].length,0==o[2].length)||Ze(a[2],o[2]),a=a[3],o=o[3]}while(0==e)}return 0<=e}))}if(Re.document&&lt){var Et=pt();kt=Et||(parseInt(st,10)||void 0)}else kt=void 0;var _t=kt,It=function(){if(!Re.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{Re.addEventListener("test",Oe,t),Re.removeEventListener("test",Oe,t)}catch(e){}return e}();function xt(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Tt(e,t){if(xt.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(dt){e:{try{ot(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:St[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Tt.Z.h.call(this)}}xt.prototype.h=function(){this.defaultPrevented=!0},qe(Tt,xt);var St={2:"touch",3:"pen",4:"mouse"};Tt.prototype.h=function(){Tt.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var At="closure_listenable_"+(1e6*Math.random()|0),Nt=0;function Ct(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Nt,this.ca=this.fa=!1}function Dt(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Rt(e){this.src=e,this.g={},this.h=0}function Ot(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],a=Ke(i,t);(r=0<=a)&&Array.prototype.splice.call(i,a,1),r&&(Dt(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Lt(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.ca&&a.listener==t&&a.capture==!!n&&a.ia==r)return i}return-1}Rt.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.g[a])||(e=this.g[a]=[],this.h++);var o=Lt(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Ct(t,this.src,a,!!r,i)).fa=n,e.push(t)),t};var Mt="closure_lm_"+(1e6*Math.random()|0),Ft={};function Pt(e,t,n,r,i){if(r&&r.once)return jt(e,t,n,r,i);if(Array.isArray(t)){for(var a=0;a<t.length;a++)Pt(e,t[a],n,r,i);return null}return n=Gt(n),e&&e[At]?e.N(t,n,Me(r)?!!r.capture:!!r,i):Ut(e,t,n,!1,r,i)}function Ut(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=Me(i)?!!i.capture:!!i,s=Ht(e);if(s||(e[Mt]=s=new Rt(e)),(n=s.add(t,n,r,o,a)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=zt;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)It||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(qt(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function jt(e,t,n,r,i){if(Array.isArray(t)){for(var a=0;a<t.length;a++)jt(e,t[a],n,r,i);return null}return n=Gt(n),e&&e[At]?e.O(t,n,Me(r)?!!r.capture:!!r,i):Ut(e,t,n,!0,r,i)}function Vt(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)Vt(e,t[a],n,r,i);else r=Me(r)?!!r.capture:!!r,n=Gt(n),e&&e[At]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=Lt(a=e.g[t],n,r,i))&&(Dt(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.g[t],e.h--)))):e&&(e=Ht(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Lt(t,n,r,i)),(n=-1<e?t[e]:null)&&Bt(n))}function Bt(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[At])Ot(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(qt(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ht(t))?(Ot(n,e),0==n.h&&(n.src=null,t[Mt]=null)):Dt(e)}}}function qt(e){return e in Ft?Ft[e]:Ft[e]="on"+e}function zt(e,t){if(e.ca)e=!0;else{t=new Tt(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&Bt(e),e=n.call(r,t)}return e}function Ht(e){return(e=e[Mt])instanceof Rt?e:null}var Kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==typeof e?e:(e[Kt]||(e[Kt]=function(t){return e.handleEvent(t)}),e[Kt])}function Wt(){ze.call(this),this.i=new Rt(this),this.P=this,this.I=null}function Qt(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new xt(t,e);else if(t instanceof xt)t.target=t.target||e;else{var i=t;at(t=new xt(r,e),i)}if(i=!0,n)for(var a=n.length-1;0<=a;a--){var o=t.g=n[a];i=Xt(o,r,!0,t)&&i}if(i=Xt(o=t.g=e,r,!0,t)&&i,i=Xt(o,r,!1,t)&&i,n)for(a=0;a<n.length;a++)i=Xt(o=t.g=n[a],r,!1,t)&&i}function Xt(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.ca&&o.capture==n){var s=o.listener,u=o.ia||o.src;o.fa&&Ot(e.i,o),i=!1!==s.call(u,r)&&i}}return i&&!r.defaultPrevented}qe(Wt,ze),Wt.prototype[At]=!0,Wt.prototype.removeEventListener=function(e,t,n,r){Vt(this,e,t,n,r)},Wt.prototype.M=function(){if(Wt.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)Dt(n[r]);delete t.g[e],t.h--}}this.I=null},Wt.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Wt.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Yt=Re.JSON.stringify;function $t(){var e=on,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Jt,Zt=function(){function e(){n(this,e),this.h=this.g=null}return d(e,[{key:"add",value:function(e,t){var n=en.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),en=new(function(){function e(t,r){n(this,e),this.i=t,this.j=r,this.h=0,this.g=null}return d(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())((function(){return new tn}),(function(e){return e.reset()})),tn=function(){function e(){n(this,e),this.next=this.g=this.h=null}return d(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function nn(e){Re.setTimeout((function(){throw e}),0)}function rn(e,t){Jt||function(){var e=Re.Promise.resolve(void 0);Jt=function(){e.then(sn)}}(),an||(Jt(),an=!0),on.add(e,t)}var an=!1,on=new Zt;function sn(){for(var e;e=$t();){try{e.h.call(e.g)}catch(e){nn(e)}var t=en;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}an=!1}function un(e,t){Wt.call(this),this.h=e||1,this.g=t||Re,this.j=Ve(this.kb,this),this.l=Date.now()}function cn(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function ln(e,t,n){if("function"==typeof e)n&&(e=Ve(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Ve(e.handleEvent,e)}return 2147483647<Number(t)?-1:Re.setTimeout(e,t||0)}function fn(e){e.g=ln((function(){e.g=null,e.i&&(e.i=!1,fn(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}qe(un,Wt),(Ne=un.prototype).da=!1,Ne.S=null,Ne.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Qt(this,"tick"),this.da&&(cn(this),this.start()))}},Ne.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Ne.M=function(){un.Z.M.call(this),cn(this),delete this.g};var hn=function(e){E(r,ze);var t=Ae(r);function r(e,i){var a;return n(this,r),(a=t.call(this)).m=e,a.j=i,a.h=null,a.i=!1,a.g=null,a}return d(r,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:fn(this)}},{key:"M",value:function(){xe(I(r.prototype),"M",this).call(this),this.g&&(Re.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),r}();function dn(e){ze.call(this),this.h=e,this.g={}}qe(dn,ze);var vn=[];function pn(e,t,n,r){Array.isArray(n)||(n&&(vn[0]=n.toString()),n=vn);for(var i=0;i<n.length;i++){var a=Pt(t,n[i],r||e.handleEvent,!1,e.h||e);if(!a)break;e.g[a.key]=a}}function yn(e){nt(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Bt(e)}),e),e.g={}}function gn(){this.g=!0}function mn(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var a=i[0];if("noop"!=a&&"stop"!=a&&"close"!=a)for(var o=1;o<i.length;o++)i[o]=""}}}return Yt(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}dn.prototype.M=function(){dn.Z.M.call(this),yn(this)},dn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},gn.prototype.Aa=function(){this.g=!1},gn.prototype.info=function(){};var kn={},bn=null;function wn(){return bn=bn||new Wt}function En(e){xt.call(this,kn.Ma,e)}function _n(e){var t=wn();Qt(t,new En(t,e))}function In(e,t){xt.call(this,kn.STAT_EVENT,e),this.stat=t}function xn(e){var t=wn();Qt(t,new In(t,e))}function Tn(e,t){xt.call(this,kn.Na,e),this.size=t}function Sn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Re.setTimeout((function(){e()}),t)}kn.Ma="serverreachability",qe(En,xt),kn.STAT_EVENT="statevent",qe(In,xt),kn.Na="timingevent",qe(Tn,xt);var An={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Nn={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Cn(){}function Dn(e){return e.h||(e.h=e.i())}function Rn(){}Cn.prototype.h=null;var On,Ln={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Mn(){xt.call(this,"d")}function Fn(){xt.call(this,"c")}function Pn(){}function Un(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new dn(this),this.P=Vn,e=ht?125:void 0,this.W=new un(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new jn}function jn(){this.i=null,this.g="",this.h=!1}qe(Mn,xt),qe(Fn,xt),qe(Pn,Cn),Pn.prototype.g=function(){return new XMLHttpRequest},Pn.prototype.i=function(){return{}},On=new Pn;var Vn=45e3,Bn={},qn={};function zn(e,t,n){e.K=1,e.v=hr(or(t)),e.s=n,e.U=!0,Hn(e,null)}function Hn(e,t){e.F=Date.now(),Qn(e),e.A=or(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),xr(n.h,"t",r),e.C=0,n=e.l.H,e.h=new jn,e.g=Ti(e.l,n?t:null,!e.s),0<e.O&&(e.L=new hn(Ve(e.Ia,e,e.g),e.O)),pn(e.V,e.g,"readystatechange",e.gb),t=e.H?rt(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),_n(1),function(e,t,n,r,i,a){e.info((function(){if(e.g)if(a)for(var o="",s=a.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var f=l.split("_");o=2<=f.length&&"type"==f[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=a;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function Kn(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Ba)}function Gn(e,t,n){for(var r,i=!0;!e.I&&e.C<n.length;){if((r=Wn(e,n))==qn){4==t&&(e.o=4,xn(14),i=!1),mn(e.j,e.m,null,"[Incomplete Response]");break}if(r==Bn){e.o=4,xn(15),mn(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}mn(e.j,e.m,r,null),Zn(e,r)}Kn(e)&&r!=qn&&r!=Bn&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,xn(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),mi(t),t.L=!0,xn(11))):(mn(e.j,e.m,n,"[Invalid Chunked Response]"),Jn(e),$n(e))}function Wn(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?qn:(n=Number(t.substring(n,r)),isNaN(n)?Bn:(r+=1)+n>t.length?qn:(t=t.substr(r,n),e.C=r+n,t))}function Qn(e){e.Y=Date.now()+e.P,Xn(e,e.P)}function Xn(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Sn(Ve(e.eb,e),t)}function Yn(e){e.B&&(Re.clearTimeout(e.B),e.B=null)}function $n(e){0==e.l.G||e.I||wi(e.l,e)}function Jn(e){Yn(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,cn(e.W),yn(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Zn(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Rr(n.i,e)))if(n.I=e.N,!e.J&&Rr(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(a){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;bi(n),ci(n)}gi(n),xn(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Sn(Ve(n.ab,n),6e3));if(1>=Dr(n.i)&&n.ka){try{n.ka()}catch(a){}n.ka=void 0}}else _i(n,11)}else if((e.J||n.g==e)&&bi(n),!Xe(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var a=i[t];if(n.U=a[0],a=a[1],2==n.G)if("c"==a[0]){n.J=a[1],n.la=a[2];var o=a[3];null!=o&&(n.ma=o,n.h.info("VER="+n.ma));var s=a[4];null!=s&&(n.za=s,n.h.info("SVER="+n.za));var u=a[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var f=r.i;!f.g&&(Je(l,"spdy")||Je(l,"quic")||Je(l,"h2"))&&(f.j=f.l,f.g=new Set,f.h&&(Or(f,f.h),f.h=null))}if(r.D){var h=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;h&&(r.sa=h,fr(r.F,r.D,h))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var d=e;if((r=n).oa=xi(r,r.H?r.la:null,r.W),d.J){Lr(r.i,d);var v=d,p=r.K;p&&v.setTimeout(p),v.B&&(Yn(v),Qn(v)),r.g=d}else yi(r);0<n.l.length&&hi(n)}else"stop"!=a[0]&&"close"!=a[0]||_i(n,7);else 3==n.G&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?_i(n,7):ui(n):"noop"!=a[0]&&n.j&&n.j.wa(a),n.A=0)}_n(4)}catch(a){}}function er(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Le(e)||"string"==typeof e)Ge(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(Le(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(Le(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length;for(var a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}}function tr(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof tr)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function nr(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];rr(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)rr(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function rr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(Ne=Un.prototype).setTimeout=function(e){this.P=e},Ne.gb=function(e){e=e.target;var t=this.L;t&&3==ri(e)?t.l():this.Ia(e)},Ne.Ia=function(e){try{if(e==this.g)e:{var t=ri(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(3!=t||ht||this.g&&(this.h.h||this.g.ga()||ii(this.g)))){this.I||4!=t||7==n||_n(8==n||0>=r?3:2),Yn(this);var i=this.g.ba();this.N=i;t:if(Kn(this)){var a=ii(this.g);e="";var o=a.length,s=4==ri(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Jn(this),$n(this);var u="";break t}this.h.i=new Re.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,e+=this.h.i.decode(a[n],{stream:s&&n==o-1});a.splice(0,o),this.h.g+=e,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=200==i,function(e,t,n,r,i,a,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+a+" "+o}))}(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Xe(c)){var f=c;break t}}f=null}if(!(i=f)){this.i=!1,this.o=3,xn(12),Jn(this),$n(this);break e}mn(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Zn(this,i)}this.U?(Gn(this,t,u),ht&&this.i&&3==t&&(pn(this.V,this.W,"tick",this.fb),this.W.start())):(mn(this.j,this.m,u,null),Zn(this,u)),4==t&&Jn(this),this.i&&!this.I&&(4==t?wi(this.l,this):(this.i=!1,Qn(this)))}else 400==i&&0<u.indexOf("Unknown SID")?(this.o=3,xn(12)):(this.o=0,xn(13)),Jn(this),$n(this)}}}catch(t){}},Ne.fb=function(){if(this.g){var e=ri(this.g),t=this.g.ga();this.C<t.length&&(Yn(this),Gn(this,e,t),this.i&&4!=e&&Qn(this))}},Ne.cancel=function(){this.I=!0,Jn(this)},Ne.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(_n(3),xn(17)),Jn(this),this.o=2,$n(this)):Xn(this,this.Y-e)},(Ne=tr.prototype).R=function(){nr(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},Ne.T=function(){return nr(this),this.g.concat()},Ne.get=function(e,t){return rr(this.h,e)?this.h[e]:t},Ne.set=function(e,t){rr(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},Ne.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var ir=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function ar(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof ar){this.g=void 0!==t?t:e.g,sr(this,e.j),this.s=e.s,ur(this,e.i),cr(this,e.m),this.l=e.l,t=e.h;var n=new wr;n.i=t.i,t.g&&(n.g=new tr(t.g),n.h=t.h),lr(this,n),this.o=e.o}else e&&(n=String(e).match(ir))?(this.g=!!t,sr(this,n[1]||"",!0),this.s=dr(n[2]||""),ur(this,n[3]||"",!0),cr(this,n[4]),this.l=dr(n[5]||"",!0),lr(this,n[6]||"",!0),this.o=dr(n[7]||"")):(this.g=!!t,this.h=new wr(null,this.g))}function or(e){return new ar(e)}function sr(e,t,n){e.j=n?dr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function ur(e,t,n){e.i=n?dr(t,!0):t}function cr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function lr(e,t,n){t instanceof wr?(e.h=t,function(e,t){t&&!e.j&&(Er(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(_r(this,t),xr(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=vr(t,kr)),e.h=new wr(t,e.g))}function fr(e,t,n){e.h.set(t,n)}function hr(e){return fr(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function dr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function vr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,pr),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function pr(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}ar.prototype.toString=function(){var e=[],t=this.j;t&&e.push(vr(t,yr,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(vr(t,yr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(vr(n,"/"==n.charAt(0)?mr:gr,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",vr(n,br)),e.join("")};var yr=/[#\/\?@]/g,gr=/[#\?:]/g,mr=/[#\?]/g,kr=/[#\?@]/g,br=/#/g;function wr(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Er(e){e.g||(e.g=new tr,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function _r(e,t){Er(e),t=Tr(e,t),rr(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,rr((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&nr(e)))}function Ir(e,t){return Er(e),t=Tr(e,t),rr(e.g.h,t)}function xr(e,t,n){_r(e,t),0<n.length&&(e.i=null,e.g.set(Tr(e,t),Qe(n)),e.h+=n.length)}function Tr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Ne=wr.prototype).add=function(e,t){Er(this),this.i=null,e=Tr(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Ne.forEach=function(e,t){Er(this),this.g.forEach((function(n,r){Ge(n,(function(n){e.call(t,n,r,this)}),this)}),this)},Ne.T=function(){Er(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},Ne.R=function(e){Er(this);var t=[];if("string"==typeof e)Ir(this,e)&&(t=We(t,this.g.get(Tr(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=We(t,e[n])}return t},Ne.set=function(e,t){return Er(this),this.i=null,Ir(this,e=Tr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Ne.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},Ne.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var a=0;a<r.length;a++){var o=i;""!==r[a]&&(o+="="+encodeURIComponent(String(r[a]))),e.push(o)}}return this.i=e.join("&")};var Sr=function e(t,r){n(this,e),this.h=t,this.g=r};function Ar(e){this.l=e||Nr,Re.PerformanceNavigationTiming?e=0<(e=Re.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(Re.g&&Re.g.Ea&&Re.g.Ea()&&Re.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Nr=10;function Cr(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Dr(e){return e.h?1:e.g?e.g.size:0}function Rr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Or(e,t){e.g?e.g.add(t):e.h=t}function Lr(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Mr(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=Te(e.g.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n=n.concat(i.D)}}catch(e){r.e(e)}finally{r.f()}return n}return Qe(e.i)}function Fr(){}function Pr(){this.g=new Fr}function Ur(e,t,n){var r=n||"";try{er(e,(function(e,n){var i=e;Me(e)&&(i=Yt(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function jr(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function Vr(e){this.l=e.$b||null,this.j=e.ib||!1}function Br(e,t){Wt.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=qr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ar.prototype.cancel=function(){if(this.i=Mr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=Te(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(e){t.e(e)}finally{t.f()}this.g.clear()}},Fr.prototype.stringify=function(e){return Re.JSON.stringify(e,void 0)},Fr.prototype.parse=function(e){return Re.JSON.parse(e,void 0)},qe(Vr,Cn),Vr.prototype.g=function(){return new Br(this.l,this.j)},Vr.prototype.i=function(e){return function(){return e}}({}),qe(Br,Wt);var qr=0;function zr(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function Hr(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Kr(e)}function Kr(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Ne=Br.prototype).open=function(e,t){if(this.readyState!=qr)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Kr(this)},Ne.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||Re).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},Ne.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Hr(this)),this.readyState=qr},Ne.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Kr(this)),this.g&&(this.readyState=3,Kr(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==Re.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;zr(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},Ne.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Hr(this):Kr(this),3==this.readyState&&zr(this)}},Ne.Ua=function(e){this.g&&(this.response=this.responseText=e,Hr(this))},Ne.Ta=function(e){this.g&&(this.response=e,Hr(this))},Ne.ha=function(){this.g&&Hr(this)},Ne.setRequestHeader=function(e,t){this.v.append(e,t)},Ne.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Ne.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Br.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Gr=Re.JSON.parse;function Wr(e){Wt.call(this),this.headers=new tr,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Qr,this.K=this.L=!1}qe(Wr,Wt);var Qr="",Xr=/^https?$/i,Yr=["POST","PUT"];function $r(e){return"content-type"==e.toLowerCase()}function Jr(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Zr(e),ti(e)}function Zr(e){e.D||(e.D=!0,Qt(e,"complete"),Qt(e,"error"))}function ei(e){if(e.h&&void 0!==De&&(!e.C[1]||4!=ri(e)||2!=e.ba()))if(e.v&&4==ri(e))ln(e.Fa,0,e);else if(Qt(e,"readystatechange"),4==ri(e)){e.h=!1;try{var t,n=e.ba();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.H).match(ir)[1]||null;if(!a&&Re.self&&Re.self.location){var o=Re.self.location.protocol;a=o.substr(0,o.length-1)}i=!Xr.test(a?a.toLowerCase():"")}t=i}if(t)Qt(e,"complete"),Qt(e,"success");else{e.m=6;try{var s=2<ri(e)?e.g.statusText:""}catch(e){s=""}e.j=s+" ["+e.ba()+"]",Zr(e)}}finally{ti(e)}}}function ti(e,t){if(e.g){ni(e);var n=e.g,r=e.C[0]?Oe:null;e.g=null,e.C=null,t||Qt(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function ni(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(Re.clearTimeout(e.A),e.A=null)}function ri(e){return e.g?e.g.readyState:0}function ii(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Qr:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ai(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){var t="";return nt(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):fr(e,t,n))}function oi(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function si(e){this.za=0,this.l=[],this.h=new gn,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=oi("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=oi("baseRetryDelayMs",5e3,e),this.$a=oi("retryDelaySeedMs",1e4,e),this.Ya=oi("forwardChannelMaxRetries",2,e),this.ra=oi("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Ar(e&&e.concurrentRequestLimit),this.Ca=new Pr,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function ui(e){if(li(e),3==e.G){var t=e.V++,n=or(e.F);fr(n,"SID",e.J),fr(n,"RID",t),fr(n,"TYPE","terminate"),vi(e,n),(t=new Un(e,e.h,t,void 0)).K=2,t.v=hr(or(n)),n=!1,Re.navigator&&Re.navigator.sendBeacon&&(n=Re.navigator.sendBeacon(t.v.toString(),"")),!n&&Re.Image&&((new Image).src=t.v,n=!0),n||(t.g=Ti(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Qn(t)}Ii(e)}function ci(e){e.g&&(mi(e),e.g.cancel(),e.g=null)}function li(e){ci(e),e.u&&(Re.clearTimeout(e.u),e.u=null),bi(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Re.clearTimeout(e.m),e.m=null)}function fi(e,t){e.l.push(new Sr(e.Za++,t)),3==e.G&&hi(e)}function hi(e){Cr(e.i)||e.m||(e.m=!0,rn(e.Ha,e),e.C=0)}function di(e,t){var n;n=t?t.m:e.V++;var r=or(e.F);fr(r,"SID",e.J),fr(r,"RID",n),fr(r,"AID",e.U),vi(e,r),e.o&&e.s&&ai(r,e.o,e.s),n=new Un(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=pi(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Or(e.i,n),zn(n,r,t)}function vi(e,t){e.j&&er({},(function(e,n){fr(t,n,e)}))}function pi(e,t,n){n=Math.min(e.l.length,n);var r=e.j?Ve(e.j.Oa,e.j,e):null;e:for(var i=e.l,a=-1;;){var o=["count="+n];-1==a?0<n?(a=i[0].h,o.push("ofs="+a)):a=0:o.push("ofs="+a);for(var s=!0,u=0;u<n;u++){var c=i[u].h,l=i[u].g;if(0>(c-=a))a=Math.max(0,i[u].h-100),s=!1;else try{Ur(l,o,"req"+c+"_")}catch(e){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.l.splice(0,n),t.D=e,r}function yi(e){e.g||e.u||(e.Y=1,rn(e.Ga,e),e.A=0)}function gi(e){return!(e.g||e.u||3<=e.A)&&(e.Y++,e.u=Sn(Ve(e.Ga,e),Ei(e,e.A)),e.A++,!0)}function mi(e){null!=e.B&&(Re.clearTimeout(e.B),e.B=null)}function ki(e){e.g=new Un(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=or(e.oa);fr(t,"RID","rpc"),fr(t,"SID",e.J),fr(t,"CI",e.N?"0":"1"),fr(t,"AID",e.U),vi(e,t),fr(t,"TYPE","xmlhttp"),e.o&&e.s&&ai(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=hr(or(t)),n.s=null,n.U=!0,Hn(n,e)}function bi(e){null!=e.v&&(Re.clearTimeout(e.v),e.v=null)}function wi(e,t){var n=null;if(e.g==t){bi(e),mi(e),e.g=null;var r=2}else{if(!Rr(e.i,t))return;n=t.D,Lr(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;Qt(r=wn(),new Tn(r,n,t,i)),hi(e)}else yi(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(Dr(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Sn(Ve(e.Ha,e,t),Ei(e,e.C)),e.C++,0)))}(e,t)||2==r&&gi(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:_i(e,5);break;case 4:_i(e,10);break;case 3:_i(e,6);break;default:_i(e,2)}}function Ei(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function _i(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=Ve(e.jb,e);n||(n=new ar("//www.google.com/images/cleardot.gif"),Re.location&&"http"==Re.location.protocol||sr(n,"https"),hr(n)),function(e,t){var n=new gn;if(Re.Image){var r=new Image;r.onload=Be(jr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Be(jr,n,r,"TestLoadImage: error",!1,t),r.onabort=Be(jr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Be(jr,n,r,"TestLoadImage: timeout",!1,t),Re.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else xn(2);e.G=0,e.j&&e.j.va(t),Ii(e),li(e)}function Ii(e){e.G=0,e.I=-1,e.j&&(0==Mr(e.i).length&&0==e.l.length||(e.i.i.length=0,Qe(e.l),e.l.length=0),e.j.ua())}function xi(e,t,n){var r=function(e){return e instanceof ar?or(e):new ar(e,void 0)}(n);if(""!=r.i)t&&ur(r,t+"."+r.i),cr(r,r.m);else{var i=Re.location;r=function(e,t,n,r){var i=new ar(null,void 0);return e&&sr(i,e),t&&ur(i,t),n&&cr(i,n),r&&(i.l=r),i}(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&nt(e.aa,(function(e,t){fr(r,t,e)})),t=e.D,n=e.sa,t&&n&&fr(r,t,n),fr(r,"VER",e.ma),vi(e,r),r}function Ti(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new Wr(new Vr({ib:!0})):new Wr(e.qa)).L=e.H,t}function Si(){}function Ai(){if(lt&&!(10<=Number(_t)))throw Error("Environmental error: no available transport.")}function Ni(e,t){Wt.call(this),this.g=new si(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!Xe(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Xe(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new Ri(this)}function Ci(e){Mn.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Di(){Fn.call(this),this.status=1}function Ri(e){this.g=e}(Ne=Wr.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():On.g(),this.C=this.u?Dn(this.u):Dn(On),this.g.onreadystatechange=Ve(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void Jr(this,e)}e=n||"";var i=new tr(this.headers);r&&er(r,(function(e,t){i.set(t,e)})),r=function(e){e:{for(var t=$r,n=e.length,r="string"==typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=Re.FormData&&e instanceof Re.FormData,!(0<=Ke(Yr,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ni(this),0<this.B&&((this.K=function(e){return lt&&wt()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Ve(this.pa,this)):this.A=ln(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Jr(this,e)}},Ne.pa=function(){void 0!==De&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Qt(this,"timeout"),this.abort(8))},Ne.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Qt(this,"complete"),Qt(this,"abort"),ti(this))},Ne.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ti(this,!0)),Wr.Z.M.call(this)},Ne.Fa=function(){this.s||(this.F||this.v||this.l?ei(this):this.cb())},Ne.cb=function(){ei(this)},Ne.ba=function(){try{return 2<ri(this)?this.g.status:-1}catch(e){return-1}},Ne.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Ne.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Gr(t)}},Ne.Da=function(){return this.m},Ne.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Ne=si.prototype).ma=8,Ne.G=1,Ne.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},Ne.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Un(this,this.h,e,void 0),n=this.s;if(this.P&&(n?at(n=rt(n),this.P):n=this.P),null===this.o&&(t.H=n),this.ja)e:{for(var r=0,i=0;i<this.l.length;i++){var a=this.l[i];if(void 0===(a="__data__"in a.g&&"string"==typeof(a=a.g.__data__)?a.length:void 0))break;if(4096<(r+=a)){r=i;break e}if(4096===r||i===this.l.length-1){r=i+1;break e}}r=1e3}else r=1e3;r=pi(this,t,r),fr(i=or(this.F),"RID",e),fr(i,"CVER",22),this.D&&fr(i,"X-HTTP-Session-Id",this.D),vi(this,i),this.o&&n&&ai(i,this.o,n),Or(this.i,t),this.Ra&&fr(i,"TYPE","init"),this.ja?(fr(i,"$req",r),fr(i,"SID","null"),t.$=!0,zn(t,i,null)):zn(t,i,r),this.G=2}}else 3==this.G&&(e?di(this,e):0==this.l.length||Cr(this.i)||di(this))},Ne.Ga=function(){if(this.u=null,ki(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Sn(Ve(this.bb,this),e)}},Ne.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,xn(10),ci(this),ki(this))},Ne.ab=function(){null!=this.v&&(this.v=null,ci(this),gi(this),xn(19))},Ne.jb=function(e){e?(this.h.info("Successfully pinged google.com"),xn(2)):(this.h.info("Failed to ping google.com"),xn(1))},(Ne=Si.prototype).xa=function(){},Ne.wa=function(){},Ne.va=function(){},Ne.ua=function(){},Ne.Oa=function(){},Ai.prototype.g=function(e,t){return new Ni(e,t)},qe(Ni,Wt),Ni.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),rn(Ve(e.hb,e,t))),xn(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=xi(e,null,e.W),hi(e)},Ni.prototype.close=function(){ui(this.g)},Ni.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,fi(this.g,t)}else this.v?((t={}).__data__=Yt(e),fi(this.g,t)):fi(this.g,e)},Ni.prototype.M=function(){this.g.j=null,delete this.j,ui(this.g),delete this.g,Ni.Z.M.call(this)},qe(Ci,Mn),qe(Di,Fn),qe(Ri,Si),Ri.prototype.xa=function(){Qt(this.g,"a")},Ri.prototype.wa=function(e){Qt(this.g,new Ci(e))},Ri.prototype.va=function(e){Qt(this.g,new Di(e))},Ri.prototype.ua=function(){Qt(this.g,"b")},Ai.prototype.createWebChannel=Ai.prototype.g,Ni.prototype.send=Ni.prototype.u,Ni.prototype.open=Ni.prototype.m,Ni.prototype.close=Ni.prototype.close,An.NO_ERROR=0,An.TIMEOUT=8,An.HTTP_ERROR=6,Nn.COMPLETE="complete",Rn.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",Wt.prototype.listen=Wt.prototype.N,Wr.prototype.listenOnce=Wr.prototype.O,Wr.prototype.getLastError=Wr.prototype.La,Wr.prototype.getLastErrorCode=Wr.prototype.Da,Wr.prototype.getStatus=Wr.prototype.ba,Wr.prototype.getResponseJson=Wr.prototype.Qa,Wr.prototype.getResponseText=Wr.prototype.ga,Wr.prototype.send=Wr.prototype.ea;var Oi=An,Li=Nn,Mi=kn,Fi=10,Pi=11,Ui=Vr,ji=Rn,Vi=Wr;function Bi(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qi(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function qi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zi(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}var Hi="@firebase/firestore",Ki=function(){function e(t){n(this,e),this.uid=t}return d(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ki.UNAUTHENTICATED=new Ki(null),Ki.GOOGLE_CREDENTIALS=new Ki("google-credentials-uid"),Ki.FIRST_PARTY=new Ki("first-party-uid"),Ki.MOCK_USER=new Ki("mock-user");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Gi="9.3.0",Wi=new se("@firebase/firestore");
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qi(){return Wi.logLevel}function Xi(e){if(Wi.logLevel<=Z.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Ji);Wi.debug.apply(Wi,["Firestore (".concat(Gi,"): ").concat(e)].concat(f(i)))}}function Yi(e){if(Wi.logLevel<=Z.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Ji);Wi.error.apply(Wi,["Firestore (".concat(Gi,"): ").concat(e)].concat(f(i)))}}function $i(e){if(Wi.logLevel<=Z.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(Ji);Wi.warn.apply(Wi,["Firestore (".concat(Gi,"): ").concat(e)].concat(f(i)))}}function Ji(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zi(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(Gi,") INTERNAL ASSERTION FAILED: ")+e;throw Yi(t),new Error(t)}function ea(e,t){e||Zi()}function ta(e,t){return e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var na={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ra=function(e){E(r,P(Error));var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this,i)).code=e,a.message=i,a.name="FirebaseError",a.toString=function(){return"".concat(a.name,": [code=").concat(a.code,"]: ").concat(a.message)},a}return r}(),ia=function e(){var t=this;n(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},aa=function e(t,r){n(this,e),this.user=r,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer ".concat(t)},oa=function(){function e(){n(this,e)}return d(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Ki.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),sa=function(){function e(t){n(this,e),this.t=t,this.currentUser=Ki.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return d(e,[{key:"start",value:function(e,n){var r=this,i=this.i,a=function(e){return r.i!==i?(i=r.i,n(e)):Promise.resolve()},o=new ia;this.o=function(){r.i++,r.currentUser=r.u(),o.resolve(),o=new ia,e.enqueueRetryable((function(){return a(r.currentUser)}))};var s=function(){var n=o;e.enqueueRetryable(t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.promise;case 2:return e.next=4,a(r.currentUser);case 4:case"end":return e.stop()}}),e)}))))},c=function(e){Xi("FirebaseCredentialsProvider","Auth detected"),r.auth=e,r.auth.addAuthTokenListener(r.o),s()};this.t.onInit((function(e){return c(e)})),setTimeout((function(){if(!r.auth){var e=r.t.getImmediate({optional:!0});e?c(e):(Xi("FirebaseCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ia)}}),0),s()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(Xi("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(ea("string"==typeof n.accessToken),new aa(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return ea(null===e||"string"==typeof e),new Ki(e)}}]),e}(),ua=function(){function e(t,r,i){n(this,e),this.h=t,this.l=r,this.m=i,this.type="FirstParty",this.user=Ki.FIRST_PARTY}return d(e,[{key:"authHeaders",get:function(){var e={"X-Goog-AuthUser":this.l},t=this.h.auth.getAuthHeaderValueForFirstParty([]);return t&&(e.Authorization=t),this.m&&(e["X-Goog-Iam-Authorization-Token"]=this.m),e}}]),e}(),ca=function(){function e(t,r,i){n(this,e),this.h=t,this.l=r,this.m=i}return d(e,[{key:"getToken",value:function(){return Promise.resolve(new ua(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Ki.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),la=function(){function e(t,r){var i=this;n(this,e),this.previousValue=t,r&&(r.sequenceNumberHandler=function(e){return i.g(e)},this.p=function(e){return r.writeSequenceNumber(e)})}return d(e,[{key:"g",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.p&&this.p(e),e}}]),e}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function fa(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */la.T=-1;var ha=function(){function e(){n(this,e)}return d(e,null,[{key:"I",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=fa(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function da(e,t){return e<t?-1:e>t?1:0}function va(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}var pa=function(){function e(t,r){if(n(this,e),this.seconds=t,this.nanoseconds=r,r<0)throw new ra(na.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(r>=1e9)throw new ra(na.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+r);if(t<-62135596800)throw new ra(na.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ra(na.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return d(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?da(this.nanoseconds,e.nanoseconds):da(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),ya=function(){function e(t){n(this,e),this.timestamp=t}return d(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new pa(0,0))}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function ga(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ma(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ka(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ba=function(){function e(t,r,i){n(this,e),void 0===r?r=0:r>t.length&&Zi(),void 0===i?i=t.length-r:i>t.length-r&&Zi(),this.segments=t,this.offset=r,this.len=i}return d(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),wa=function(e){E(r,ba);var t=zi(r);function r(){return n(this,r),t.apply(this,arguments)}return d(r,[{key:"construct",value:function(e,t,n){return new r(e,t,n)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];for(var a=0,o=n;a<o.length;a++){var s=o[a];if(s.indexOf("//")>=0)throw new ra(na.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,f(s.split("/").filter((function(e){return e.length>0}))))}return new r(e)}},{key:"emptyPath",value:function(){return new r([])}}]),r}(),Ea=/^[_a-zA-Z][_a-zA-Z0-9]*$/,_a=function(e){E(r,ba);var t=zi(r);function r(){return n(this,r),t.apply(this,arguments)}return d(r,[{key:"construct",value:function(e,t,n){return new r(e,t,n)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return Ea.test(e)}},{key:"keyField",value:function(){return new r(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],n="",i=0,a=function(){if(0===n.length)throw new ra(na.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(n),n=""},o=!1;i<e.length;){var s=e[i];if("\\"===s){if(i+1===e.length)throw new ra(na.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var u=e[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ra(na.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=u,i+=2}else"`"===s?(o=!o,i++):"."!==s||o?(n+=s,i++):(a(),i++)}if(a(),o)throw new ra(na.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}},{key:"emptyPath",value:function(){return new r([])}}]),r}(),Ia=function(){function e(t){n(this,e),this.fields=t,t.sort(_a.comparator)}return d(e,[{key:"covers",value:function(e){var t,n=Bi(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return va(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}]),e}(),xa=function(){function e(t){n(this,e),this.binaryString=t}return d(e,[{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return da(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(t){return new e(atob(t))}},{key:"fromUint8Array",value:function(t){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t);return new e(n)}}]),e}();xa.EMPTY_BYTE_STRING=new xa("");var Ta=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Sa(e){if(ea(!!e),"string"==typeof e){var t=0,n=Ta.exec(e);if(ea(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:Aa(e.seconds),nanos:Aa(e.nanos)}}function Aa(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Na(e){return"string"==typeof e?xa.fromBase64String(e):xa.fromUint8Array(e)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ca(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Da(e){var t=e.mapValue.fields.__previous_value__;return Ca(t)?Da(t):t}function Ra(e){var t=Sa(e.mapValue.fields.__local_write_time__.timestampValue);return new pa(t.seconds,t.nanos)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Oa(e){return null==e}function La(e){return 0===e&&1/e==-1/0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Ma=function(){function e(t){n(this,e),this.path=t}return d(e,[{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"isEqual",value:function(e){return null!==e&&0===wa.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(wa.fromString(t))}},{key:"fromName",value:function(t){return new e(wa.fromString(t).popFirst(5))}},{key:"comparator",value:function(e,t){return wa.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new wa(t.slice()))}}]),e}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fa(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Ca(e)?4:10:Zi()}function Pa(e,t){var n=Fa(e);if(n!==Fa(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Ra(e).isEqual(Ra(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=Sa(e.timestampValue),r=Sa(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Na(e.bytesValue).isEqual(Na(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Aa(e.geoPointValue.latitude)===Aa(t.geoPointValue.latitude)&&Aa(e.geoPointValue.longitude)===Aa(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Aa(e.integerValue)===Aa(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Aa(e.doubleValue),r=Aa(t.doubleValue);return n===r?La(n)===La(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return va(e.arrayValue.values||[],t.arrayValue.values||[],Pa);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ga(n)!==ga(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Pa(n[i],r[i])))return!1;return!0}(e,t);default:return Zi()}}function Ua(e,t){return void 0!==(e.values||[]).find((function(e){return Pa(e,t)}))}function ja(e,t){var n=Fa(e),r=Fa(t);if(n!==r)return da(n,r);switch(n){case 0:return 0;case 1:return da(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=Aa(e.integerValue||e.doubleValue),r=Aa(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Va(e.timestampValue,t.timestampValue);case 4:return Va(Ra(e),Ra(t));case 5:return da(e.stringValue,t.stringValue);case 6:return function(e,t){var n=Na(e),r=Na(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=da(n[i],r[i]);if(0!==a)return a}return da(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=da(Aa(e.latitude),Aa(t.latitude));return 0!==n?n:da(Aa(e.longitude),Aa(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=ja(n[i],r[i]);if(a)return a}return da(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var o=0;o<r.length&&o<a.length;++o){var s=da(r[o],a[o]);if(0!==s)return s;var u=ja(n[r[o]],i[a[o]]);if(0!==u)return u}return da(r.length,a.length)}(e.mapValue,t.mapValue);default:throw Zi()}}function Va(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return da(e,t);var n=Sa(e),r=Sa(t),i=da(n.seconds,r.seconds);return 0!==i?i:da(n.nanos,r.nanos)}function Ba(e){return qa(e)}function qa(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=Sa(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Na(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Ma.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=Bi(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=qa(a)}}catch(e){i.e(e)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=Bi(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(qa(e.fields[a]))}}catch(e){i.e(e)}finally{i.f()}return n+"}"}(e.mapValue):Zi();var t,n}function za(e){return!!e&&"integerValue"in e}function Ha(e){return!!e&&"arrayValue"in e}function Ka(e){return!!e&&"nullValue"in e}function Ga(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Wa(e){return!!e&&"mapValue"in e}function Qa(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==o(e.timestampValue))return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return ma(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Qa(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Qa(e.arrayValue.values[r]);return n}return Object.assign({},e)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xa=function(){function e(t){n(this,e),this.value=t}return d(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Wa(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Qa(t)}},{key:"setAll",value:function(e){var t=this,n=_a.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var o=t.getFieldsMap(n);t.applyChanges(o,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Qa(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Wa(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Pa(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Wa(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){ma(t,(function(t,n){return e[t]=n}));var r,i=Bi(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(e){i.e(e)}finally{i.f()}}},{key:"clone",value:function(){return new e(Qa(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Ya(e){var t=[];return ma(e.fields,(function(e,n){var r=new _a([e]);if(Wa(n)){var i=Ya(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,o=Bi(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;t.push(r.child(s))}}catch(e){o.e(e)}finally{o.f()}}}else t.push(r)})),new Ia(t)
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var $a=function(){function e(t,r,i,a,o){n(this,e),this.key=t,this.documentType=r,this.version=i,this.data=a,this.documentState=o}return d(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Xa.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Xa.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"clone",value:function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,ya.min(),Xa.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,Xa.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,Xa.empty(),2)}}]),e}(),Ja=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;n(this,e),this.path=t,this.collectionGroup=r,this.orderBy=i,this.filters=a,this.limit=o,this.startAt=s,this.endAt=u,this.A=null};
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Za(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Ja(e,t,n,r,i,a,o)}function eo(e){var t=ta(e);if(null===t.A){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return function(e){return e.field.canonicalString()+e.op.toString()+Ba(e.value)}(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),Oa(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=vo(t.startAt)),t.endAt&&(n+="|ub:",n+=vo(t.endAt)),t.A=n}return t.A}function to(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!yo(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!Pa(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!mo(e.startAt,t.startAt)&&mo(e.endAt,t.endAt)}function no(e){return Ma.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var ro=function(e){E(r,e);var t=zi(r);function r(e,i,a){var o;return n(this,r),(o=t.call(this)).field=e,o.op=i,o.value=a,o}return d(r,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.P(ja(t,this.value)):null!==t&&Fa(this.value)===Fa(t)&&this.P(ja(t,this.value))}},{key:"P",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Zi()}}},{key:"v",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.R(e,t,n):new io(e,t,n):"array-contains"===t?new uo(e,n):"in"===t?new co(e,n):"not-in"===t?new lo(e,n):"array-contains-any"===t?new fo(e,n):new r(e,t,n)}},{key:"R",value:function(e,t,n){return"in"===t?new ao(e,n):new oo(e,n)}}]),r}(function(){return function e(){n(this,e)}}());var io=function(e){E(r,ro);var t=zi(r);function r(e,i,a){var o;return n(this,r),(o=t.call(this,e,i,a)).key=Ma.fromName(a.referenceValue),o}return d(r,[{key:"matches",value:function(e){var t=Ma.comparator(e.key,this.key);return this.P(t)}}]),r}(),ao=function(e){E(r,ro);var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this,e,"in",i)).keys=so("in",i),a}return d(r,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),r}(),oo=function(e){E(r,ro);var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this,e,"not-in",i)).keys=so("not-in",i),a}return d(r,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),r}();function so(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return Ma.fromName(e.referenceValue)}))}var uo=function(e){E(r,ro);var t=zi(r);function r(e,i){return n(this,r),t.call(this,e,"array-contains",i)}return d(r,[{key:"matches",value:function(e){var t=e.data.field(this.field);return Ha(t)&&Ua(t.arrayValue,this.value)}}]),r}(),co=function(e){E(r,ro);var t=zi(r);function r(e,i){return n(this,r),t.call(this,e,"in",i)}return d(r,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Ua(this.value.arrayValue,t)}}]),r}(),lo=function(e){E(r,ro);var t=zi(r);function r(e,i){return n(this,r),t.call(this,e,"not-in",i)}return d(r,[{key:"matches",value:function(e){if(Ua(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Ua(this.value.arrayValue,t)}}]),r}(),fo=function(e){E(r,ro);var t=zi(r);function r(e,i){return n(this,r),t.call(this,e,"array-contains-any",i)}return d(r,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!Ha(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Ua(t.value.arrayValue,e)}))}}]),r}(),ho=function e(t,r){n(this,e),this.position=t,this.before=r};function vo(e){return"".concat(e.before?"b":"a",":").concat(e.position.map((function(e){return Ba(e)})).join(","))}var po=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";n(this,e),this.field=t,this.dir=r};function yo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function go(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],o=e.position[i];if(r=a.field.isKeyField()?Ma.comparator(Ma.fromName(o.referenceValue),n.key):ja(o,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function mo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Pa(e.position[n],t.position[n]))return!1;return!0}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ko=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;n(this,e),this.path=t,this.collectionGroup=r,this.explicitOrderBy=i,this.filters=a,this.limit=o,this.limitType=s,this.startAt=u,this.endAt=c,this.V=null,this.S=null,this.startAt,this.endAt};function bo(e){return new ko(e)}function wo(e){return!Oa(e.limit)&&"F"===e.limitType}function Eo(e){return!Oa(e.limit)&&"L"===e.limitType}function _o(e){var t=ta(e);if(null===t.V){t.V=[];var n=function(e){var t,n=Bi(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.v())return r.field}}catch(e){n.e(e)}finally{n.f()}return null}(t),r=function(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}(t);if(null!==n&&null===r)n.isKeyField()||t.V.push(new po(n)),t.V.push(new po(_a.keyField(),"asc"));else{var i,a=!1,o=Bi(t.explicitOrderBy);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.V.push(s),s.field.isKeyField()&&(a=!0)}}catch(e){o.e(e)}finally{o.f()}if(!a){var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.V.push(new po(_a.keyField(),u))}}}return t.V}function Io(e){var t=ta(e);if(!t.S)if("F"===t.limitType)t.S=Za(t.path,t.collectionGroup,_o(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=Bi(_o(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,o="desc"===a.dir?"asc":"desc";r.push(new po(a.field,o))}}catch(e){i.e(e)}finally{i.f()}var s=t.endAt?new ho(t.endAt.position,!t.endAt.before):null,u=t.startAt?new ho(t.startAt.position,!t.startAt.before):null;t.S=Za(t.path,t.collectionGroup,r,t.filters,t.limit,s,u)}return t.S}function xo(e,t){return to(Io(e),Io(t))&&e.limitType===t.limitType}function To(e){return"".concat(eo(Io(e)),"|lt:").concat(e.limitType)}function So(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(Ba(t.value));var t})).join(", "),"]")),Oa(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: "+vo(e.startAt)),e.endAt&&(t+=", endAt: "+vo(e.endAt)),"Target(".concat(t,")")}(Io(e)),"; limitType=").concat(e.limitType,")")}function Ao(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ma.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=Bi(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=Bi(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(e){r.e(e)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!go(e.startAt,_o(e),t))&&(!e.endAt||!go(e.endAt,_o(e),t))}(e,t)}function No(e){return function(t,n){var r,i=!1,a=Bi(_o(e));try{for(a.s();!(r=a.n()).done;){var o=r.value,s=Co(o,t,n);if(0!==s)return s;i=i||o.field.isKeyField()}}catch(e){a.e(e)}finally{a.f()}return 0}}function Co(e,t,n){var r=e.field.isKeyField()?Ma.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?ja(r,i):Zi()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Zi()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Do(e,t){if(e.D){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:La(t)?"-0":t}}function Ro(e){return{integerValue:""+e}}function Oo(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!La(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Ro(t):Do(e,t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lo=function e(){n(this,e),this._=void 0};function Mo(e,t,n){return e instanceof Uo?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof jo?Vo(e,t):e instanceof Bo?qo(e,t):function(e,t){var n=Po(e,t),r=Ho(n)+Ho(e.C);return za(n)&&za(e.C)?Ro(r):Do(e.N,r)}(e,t)}function Fo(e,t,n){return e instanceof jo?Vo(e,t):e instanceof Bo?qo(e,t):n}function Po(e,t){return e instanceof zo?za(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var Uo=function(e){E(r,Lo);var t=zi(r);function r(){return n(this,r),t.apply(this,arguments)}return r}(),jo=function(e){E(r,Lo);var t=zi(r);function r(e){var i;return n(this,r),(i=t.call(this)).elements=e,i}return r}();function Vo(e,t){var n,r=Ko(t),i=Bi(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Pa(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return{arrayValue:{values:r}}}var Bo=function(e){E(r,Lo);var t=zi(r);function r(e){var i;return n(this,r),(i=t.call(this)).elements=e,i}return r}();function qo(e,t){var n,r=Ko(t),i=Bi(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Pa(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return{arrayValue:{values:r}}}var zo=function(e){E(r,Lo);var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this)).N=e,a.C=i,a}return r}();function Ho(e){return Aa(e.integerValue||e.doubleValue)}function Ko(e){return Ha(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Go=function e(t,r){n(this,e),this.version=t,this.transformResults=r},Wo=function(){function e(t,r){n(this,e),this.updateTime=t,this.exists=r}return d(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Qo(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var Xo=function e(){n(this,e)};function Yo(e,t,n){e instanceof ts?function(e,t,n){var r=e.value.clone(),i=is(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ns?function(e,t,n){if(Qo(e.precondition,t)){var r=is(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(rs(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function $o(e,t,n){e instanceof ts?function(e,t,n){if(Qo(e.precondition,t)){var r=e.value.clone(),i=as(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(es(t),r).setHasLocalMutations()}}(e,t,n):e instanceof ns?function(e,t,n){if(Qo(e.precondition,t)){var r=as(e.fieldTransforms,n,t),i=t.data;i.setAll(rs(e)),i.setAll(r),t.convertToFoundDocument(es(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){Qo(e.precondition,t)&&t.convertToNoDocument(ya.min())}(e,t)}function Jo(e,t){var n,r=null,i=Bi(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t.data.field(a.field),s=Po(a.transform,o||null);null!=s&&(null==r&&(r=Xa.empty()),r.set(a.field,s))}}catch(e){i.e(e)}finally{i.f()}return r||null}function Zo(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&va(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof jo&&t instanceof jo||e instanceof Bo&&t instanceof Bo?va(e.elements,t.elements,Pa):e instanceof zo&&t instanceof zo?Pa(e.C,t.C):e instanceof Uo&&t instanceof Uo}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function es(e){return e.isFoundDocument()?e.version:ya.min()}var ts=function(e){E(r,Xo);var t=zi(r);function r(e,i,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return n(this,r),(o=t.call(this)).key=e,o.value=i,o.precondition=a,o.fieldTransforms=s,o.type=0,o}return r}(),ns=function(e){E(r,Xo);var t=zi(r);function r(e,i,a,o){var s,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return n(this,r),(s=t.call(this)).key=e,s.data=i,s.fieldMask=a,s.precondition=o,s.fieldTransforms=u,s.type=1,s}return r}();function rs(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function is(e,t,n){var r=new Map;ea(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],o=a.transform,s=t.data.field(a.field);r.set(a.field,Fo(o,s,n[i]))}return r}function as(e,t,n){var r,i=new Map,a=Bi(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.transform,u=n.data.field(o.field);i.set(o.field,Mo(s,u,t))}}catch(e){a.e(e)}finally{a.f()}return i}var os,ss,us=function(e){E(r,Xo);var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this)).key=e,a.precondition=i,a.type=2,a.fieldTransforms=[],a}return r}(),cs=function(e){E(r,Xo);var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this)).key=e,a.precondition=i,a.type=3,a.fieldTransforms=[],a}return r}(),ls=function e(t){n(this,e),this.count=t};function fs(e){switch(e){default:return Zi();case na.CANCELLED:case na.UNKNOWN:case na.DEADLINE_EXCEEDED:case na.RESOURCE_EXHAUSTED:case na.INTERNAL:case na.UNAVAILABLE:case na.UNAUTHENTICATED:return!1;case na.INVALID_ARGUMENT:case na.NOT_FOUND:case na.ALREADY_EXISTS:case na.PERMISSION_DENIED:case na.FAILED_PRECONDITION:case na.ABORTED:case na.OUT_OF_RANGE:case na.UNIMPLEMENTED:case na.DATA_LOSS:return!0}}function hs(e){if(void 0===e)return Yi("GRPC error has no .code"),na.UNKNOWN;switch(e){case os.OK:return na.OK;case os.CANCELLED:return na.CANCELLED;case os.UNKNOWN:return na.UNKNOWN;case os.DEADLINE_EXCEEDED:return na.DEADLINE_EXCEEDED;case os.RESOURCE_EXHAUSTED:return na.RESOURCE_EXHAUSTED;case os.INTERNAL:return na.INTERNAL;case os.UNAVAILABLE:return na.UNAVAILABLE;case os.UNAUTHENTICATED:return na.UNAUTHENTICATED;case os.INVALID_ARGUMENT:return na.INVALID_ARGUMENT;case os.NOT_FOUND:return na.NOT_FOUND;case os.ALREADY_EXISTS:return na.ALREADY_EXISTS;case os.PERMISSION_DENIED:return na.PERMISSION_DENIED;case os.FAILED_PRECONDITION:return na.FAILED_PRECONDITION;case os.ABORTED:return na.ABORTED;case os.OUT_OF_RANGE:return na.OUT_OF_RANGE;case os.UNIMPLEMENTED:return na.UNIMPLEMENTED;case os.DATA_LOSS:return na.DATA_LOSS;default:return Zi()}}(ss=os||(os={}))[ss.OK=0]="OK",ss[ss.CANCELLED=1]="CANCELLED",ss[ss.UNKNOWN=2]="UNKNOWN",ss[ss.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ss[ss.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ss[ss.NOT_FOUND=5]="NOT_FOUND",ss[ss.ALREADY_EXISTS=6]="ALREADY_EXISTS",ss[ss.PERMISSION_DENIED=7]="PERMISSION_DENIED",ss[ss.UNAUTHENTICATED=16]="UNAUTHENTICATED",ss[ss.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ss[ss.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ss[ss.ABORTED=10]="ABORTED",ss[ss.OUT_OF_RANGE=11]="OUT_OF_RANGE",ss[ss.UNIMPLEMENTED=12]="UNIMPLEMENTED",ss[ss.INTERNAL=13]="INTERNAL",ss[ss.UNAVAILABLE=14]="UNAVAILABLE",ss[ss.DATA_LOSS=15]="DATA_LOSS";
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ds=function(){function e(t,r){n(this,e),this.comparator=t,this.root=r||ps.EMPTY}return d(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,ps.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ps.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new vs(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new vs(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new vs(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new vs(this.root,e,this.comparator,!0)}}]),e}(),vs=function(){function e(t,r,i,a){n(this,e),this.isReverse=a,this.nodeStack=[];for(var o=1;!t.isEmpty();)if(o=r?i(t.key,r):1,a&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(0===o){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return d(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),ps=function(){function e(t,r,i,a,o){n(this,e),this.key=t,this.value=r,this.color=null!=i?i:e.RED,this.left=null!=a?a:e.EMPTY,this.right=null!=o?o:e.EMPTY,this.size=this.left.size+1+this.right.size}return d(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Zi();if(this.right.isRed())throw Zi();var e=this.left.check();if(e!==this.right.check())throw Zi();return e+(this.isRed()?0:1)}}]),e}();ps.EMPTY=null,ps.RED=!0,ps.BLACK=!1,ps.EMPTY=new(function(){function e(){n(this,e),this.size=0}return d(e,[{key:"key",get:function(){throw Zi()}},{key:"value",get:function(){throw Zi()}},{key:"color",get:function(){throw Zi()}},{key:"left",get:function(){throw Zi()}},{key:"right",get:function(){throw Zi()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new ps(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var ys=function(){function e(t){n(this,e),this.comparator=t,this.data=new ds(this.comparator)}return d(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new gs(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new gs(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),gs=function(){function e(t){n(this,e),this.iter=t}return d(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),ms=new ds(Ma.comparator);function ks(){return ms}var bs=new ds(Ma.comparator);function ws(){return bs}var Es=new ds(Ma.comparator);var _s=new ys(Ma.comparator);function Is(){for(var e=_s,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];e=e.add(o)}return e}var xs=new ys(da);function Ts(){return xs}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ss=function(){function e(t,r,i,a,o){n(this,e),this.snapshotVersion=t,this.targetChanges=r,this.targetMismatches=i,this.documentUpdates=a,this.resolvedLimboDocuments=o}return d(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,As.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(ya.min(),r,Ts(),ks(),Is())}}]),e}(),As=function(){function e(t,r,i,a,o){n(this,e),this.resumeToken=t,this.current=r,this.addedDocuments=i,this.modifiedDocuments=a,this.removedDocuments=o}return d(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(xa.EMPTY_BYTE_STRING,n,Is(),Is(),Is())}}]),e}(),Ns=function e(t,r,i,a){n(this,e),this.k=t,this.removedTargetIds=r,this.key=i,this.$=a},Cs=function e(t,r){n(this,e),this.targetId=t,this.O=r},Ds=function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xa.EMPTY_BYTE_STRING,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;n(this,e),this.state=t,this.targetIds=r,this.resumeToken=i,this.cause=a},Rs=function(){function e(){n(this,e),this.F=0,this.M=Ms(),this.L=xa.EMPTY_BYTE_STRING,this.B=!1,this.U=!0}return d(e,[{key:"current",get:function(){return this.B}},{key:"resumeToken",get:function(){return this.L}},{key:"q",get:function(){return 0!==this.F}},{key:"K",get:function(){return this.U}},{key:"j",value:function(e){e.approximateByteSize()>0&&(this.U=!0,this.L=e)}},{key:"W",value:function(){var e=Is(),t=Is(),n=Is();return this.M.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Zi()}})),new As(this.L,this.B,e,t,n)}},{key:"G",value:function(){this.U=!1,this.M=Ms()}},{key:"H",value:function(e,t){this.U=!0,this.M=this.M.insert(e,t)}},{key:"J",value:function(e){this.U=!0,this.M=this.M.remove(e)}},{key:"Y",value:function(){this.F+=1}},{key:"X",value:function(){this.F-=1}},{key:"Z",value:function(){this.U=!0,this.B=!0}}]),e}(),Os=function(){function e(t){n(this,e),this.tt=t,this.et=new Map,this.nt=ks(),this.st=Ls(),this.it=new ys(da)}return d(e,[{key:"rt",value:function(e){var t,n=Bi(e.k);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.$&&e.$.isFoundDocument()?this.ot(r,e.$):this.ct(r,e.key,e.$)}}catch(e){n.e(e)}finally{n.f()}var i,a=Bi(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.ct(o,e.key,e.$)}}catch(e){a.e(e)}finally{a.f()}}},{key:"at",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.ut(n);switch(e.state){case 0:t.ht(n)&&r.j(e.resumeToken);break;case 1:r.X(),r.q||r.G(),r.j(e.resumeToken);break;case 2:r.X(),r.q||t.removeTarget(n);break;case 3:t.ht(n)&&(r.Z(),r.j(e.resumeToken));break;case 4:t.ht(n)&&(t.lt(n),r.j(e.resumeToken));break;default:Zi()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.et.forEach((function(e,r){n.ht(r)&&t(r)}))}},{key:"ft",value:function(e){var t=e.targetId,n=e.O.count,r=this.dt(t);if(r){var i=r.target;if(no(i))if(0===n){var a=new Ma(i.path);this.ct(t,a,$a.newNoDocument(a,ya.min()))}else ea(1===n);else this.wt(t)!==n&&(this.lt(t),this.it=this.it.add(t))}}},{key:"_t",value:function(e){var t=this,n=new Map;this.et.forEach((function(r,i){var a=t.dt(i);if(a){if(r.current&&no(a.target)){var o=new Ma(a.target.path);null!==t.nt.get(o)||t.gt(i,o)||t.ct(i,o,$a.newNoDocument(o,e))}r.K&&(n.set(i,r.W()),r.G())}}));var r=Is();this.st.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.dt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))}));var i=new Ss(e,n,this.it,this.nt,r);return this.nt=ks(),this.st=Ls(),this.it=new ys(da),i}},{key:"ot",value:function(e,t){if(this.ht(e)){var n=this.gt(e,t.key)?2:0;this.ut(e).H(t.key,n),this.nt=this.nt.insert(t.key,t),this.st=this.st.insert(t.key,this.yt(t.key).add(e))}}},{key:"ct",value:function(e,t,n){if(this.ht(e)){var r=this.ut(e);this.gt(e,t)?r.H(t,1):r.J(t),this.st=this.st.insert(t,this.yt(t).delete(e)),n&&(this.nt=this.nt.insert(t,n))}}},{key:"removeTarget",value:function(e){this.et.delete(e)}},{key:"wt",value:function(e){var t=this.ut(e).W();return this.tt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Y",value:function(e){this.ut(e).Y()}},{key:"ut",value:function(e){var t=this.et.get(e);return t||(t=new Rs,this.et.set(e,t)),t}},{key:"yt",value:function(e){var t=this.st.get(e);return t||(t=new ys(da),this.st=this.st.insert(e,t)),t}},{key:"ht",value:function(e){var t=null!==this.dt(e);return t||Xi("WatchChangeAggregator","Detected inactive target",e),t}},{key:"dt",value:function(e){var t=this.et.get(e);return t&&t.q?null:this.tt.Tt(e)}},{key:"lt",value:function(e){var t=this;this.et.set(e,new Rs),this.tt.getRemoteKeysForTarget(e).forEach((function(n){t.ct(e,n,null)}))}},{key:"gt",value:function(e,t){return this.tt.getRemoteKeysForTarget(e).has(t)}}]),e}();function Ls(){return new ds(Ma.comparator)}function Ms(){return new ds(Ma.comparator)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Fs={asc:"ASCENDING",desc:"DESCENDING"},Ps={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Us=function e(t,r){n(this,e),this.databaseId=t,this.D=r};function js(e,t){return e.D?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function Vs(e,t){return e.D?t.toBase64():t.toUint8Array()}function Bs(e,t){return js(e,t.toTimestamp())}function qs(e){return ea(!!e),ya.fromTimestamp(function(e){var t=Sa(e);return new pa(t.seconds,t.nanos)}(e))}function zs(e,t){return function(e){return new wa(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Hs(e){var t=wa.fromString(e);return ea(lu(t)),t}function Ks(e,t){return zs(e.databaseId,t.path)}function Gs(e,t){var n=Hs(t);if(n.get(1)!==e.databaseId.projectId)throw new ra(na.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new ra(na.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ma(Xs(n))}function Ws(e,t){return zs(e.databaseId,t)}function Qs(e){return new wa(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Xs(e){return ea(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Ys(e,t,n){return{name:Ks(e,t),fields:n.value.mapValue.fields}}function $s(e,t){return{documents:[Ws(e,t.path)]}}function Js(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Ws(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Ws(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(Ga(e.value))return{unaryFilter:{field:au(e.field),op:"IS_NAN"}};if(Ka(e.value))return{unaryFilter:{field:au(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ga(e.value))return{unaryFilter:{field:au(e.field),op:"IS_NOT_NAN"}};if(Ka(e.value))return{unaryFilter:{field:au(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:au(e.field),op:iu(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:au(e.field),direction:ru(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var o=function(e,t){return e.D||Oa(t)?t:{value:t}}(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=tu(t.startAt)),t.endAt&&(n.structuredQuery.endAt=tu(t.endAt)),n}function Zs(e){var t=function(e){var t=Hs(e);return 4===t.length?wa.emptyPath():Xs(t)}(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ea(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var s=[];n.where&&(s=eu(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(e){return function(e){return new po(ou(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var c=null;n.limit&&(c=function(e){var t;return Oa(t="object"==o(e)?e.value:e)?null:t}(n.limit));var l=null;n.startAt&&(l=nu(n.startAt));var f=null;return n.endAt&&(f=nu(n.endAt)),function(e,t,n,r,i,a,o,s){return new ko(e,t,n,r,i,a,o,s)}(t,i,u,s,c,"F",l,f)}function eu(e){return e?void 0!==e.unaryFilter?[uu(e)]:void 0!==e.fieldFilter?[su(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return eu(e)})).reduce((function(e,t){return e.concat(t)})):Zi():[]}function tu(e){return{before:e.before,values:e.position}}function nu(e){var t=!!e.before,n=e.values||[];return new ho(n,t)}function ru(e){return Fs[e]}function iu(e){return Ps[e]}function au(e){return{fieldPath:e.canonicalString()}}function ou(e){return _a.fromServerFormat(e.fieldPath)}function su(e){return ro.create(ou(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Zi()}}(e.fieldFilter.op),e.fieldFilter.value)}function uu(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ou(e.unaryFilter.field);return ro.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ou(e.unaryFilter.field);return ro.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ou(e.unaryFilter.field);return ro.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ou(e.unaryFilter.field);return ro.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Zi()}}function cu(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function lu(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fu(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=du(t)),t=hu(e.get(n),t);return du(t)}function hu(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="";break;case"":n+="";break;default:n+=a}}return n}function du(e){return e+""}var vu=function(){function e(){n(this,e)}return d(e,null,[{key:"prefixForUser",value:function(e){return[e]}},{key:"prefixForPath",value:function(e,t){return[e,fu(t)]}},{key:"key",value:function(e,t,n){return[e,fu(t),n]}}]),e}();vu.store="documentMutations",vu.PLACEHOLDER=new vu;var pu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",yu=function(){function e(){n(this,e),this.onCommittedListeners=[]}return d(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}(),gu=function(){function e(t){var r=this;n(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){r.isDone=!0,r.result=e,r.nextCallback&&r.nextCallback(e)}),(function(e){r.isDone=!0,r.error=e,r.catchCallback&&r.catchCallback(e)}))}return d(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Zi(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=Bi(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mu(e){return"IndexedDbTransactionError"===e.name}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ku=function(){function e(t,r,i,a){n(this,e),this.batchId=t,this.localWriteTime=r,this.baseMutations=i,this.mutations=a}return d(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Yo(i,e,n[r])}}},{key:"applyToLocalView",value:function(e){var t,n=Bi(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&$o(r,e,this.localWriteTime)}}catch(e){n.e(e)}finally{n.f()}var i,a=Bi(this.mutations);try{for(a.s();!(i=a.n()).done;){var o=i.value;o.key.isEqual(e.key)&&$o(o,e,this.localWriteTime)}}catch(e){a.e(e)}finally{a.f()}}},{key:"applyToLocalDocumentSet",value:function(e){var t=this;this.mutations.forEach((function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(ya.min())}))}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),Is())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&va(this.mutations,e.mutations,(function(e,t){return Zo(e,t)}))&&va(this.baseMutations,e.baseMutations,(function(e,t){return Zo(e,t)}))}}]),e}(),bu=function(){function e(t,r,i,a){n(this,e),this.batch=t,this.commitVersion=r,this.mutationResults=i,this.docVersions=a}return d(e,null,[{key:"from",value:function(t,n,r){ea(t.mutations.length===r.length);for(var i=Es,a=t.mutations,o=0;o<a.length;o++)i=i.insert(a[o].key,r[o].version);return new e(t,n,r,i)}}]),e}(),wu=function(){function e(t,r,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ya.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:ya.min(),u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:xa.EMPTY_BYTE_STRING;n(this,e),this.target=t,this.targetId=r,this.purpose=i,this.sequenceNumber=a,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=u}return d(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Eu=function e(t){n(this,e),this.Wt=t};function _u(e){var t=Zs({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?function(e,t,n){return new ko(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}(t,t.limit,"L"):t}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Iu=function(){function e(){n(this,e),this.Gt=new xu}return d(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.Gt.add(t),gu.resolve()}},{key:"getCollectionParents",value:function(e,t){return gu.resolve(this.Gt.getEntries(t))}}]),e}(),xu=function(){function e(){n(this,e),this.index={}}return d(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new ys(wa.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new ys(wa.comparator)).toArray()}}]),e}(),Tu=function(){function e(t,r,i){n(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=r,this.maximumSequenceNumbersToCollect=i}return d(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Tu.DEFAULT_COLLECTION_PERCENTILE=10,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tu.DEFAULT=new Tu(41943040,Tu.DEFAULT_COLLECTION_PERCENTILE,Tu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tu.DISABLED=new Tu(-1,0,0);
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Su=function(){function e(t){n(this,e),this.ne=t}return d(e,[{key:"next",value:function(){return this.ne+=2,this.ne}}],[{key:"se",value:function(){return new e(0)}},{key:"ie",value:function(){return new e(-1)}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Au(e){return Nu.apply(this,arguments)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(){return Nu=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===na.FAILED_PRECONDITION&&t.message===pu){e.next=2;break}throw t;case 2:Xi("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)}))),Nu.apply(this,arguments)}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Cu=function(){function e(t,r){n(this,e),this.mapKeyFn=t,this.equalsFn=r,this.inner={}}return d(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=Bi(n);try{for(i.s();!(r=i.n()).done;){var a=g(r.value,2),o=a[0],s=a[1];if(this.equalsFn(o,e))return s}}catch(e){i.e(e)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}},{key:"forEach",value:function(e){ma(this.inner,(function(t,n){var r,i=Bi(n);try{for(i.s();!(r=i.n()).done;){var a=g(r.value,2),o=a[0],s=a[1];e(o,s)}}catch(e){i.e(e)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return ka(this.inner)}}]),e}(),Du=function(){function e(){n(this,e),this.changes=new Cu((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return d(e,[{key:"getReadTime",value:function(e){var t=this.changes.get(e);return t?t.readTime:ya.min()}},{key:"addEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}},{key:"removeEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.assertNotApplied(),this.changes.set(e,{document:$a.newInvalidDocument(e),readTime:t})}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?gu.resolve(n.document):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Ru=function(){function e(t,r,i){n(this,e),this.He=t,this.In=r,this.Ht=i}return d(e,[{key:"An",value:function(e,t){var n=this;return this.In.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(r){return n.Rn(e,t,r)}))}},{key:"Rn",value:function(e,t,n){return this.He.getEntry(e,t).next((function(e){var t,r=Bi(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(e){r.e(e)}finally{r.f()}return e}))}},{key:"bn",value:function(e,t){e.forEach((function(e,n){var r,i=Bi(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(e){i.e(e)}finally{i.f()}}))}},{key:"Pn",value:function(e,t){var n=this;return this.He.getEntries(e,t).next((function(t){return n.vn(e,t).next((function(){return t}))}))}},{key:"vn",value:function(e,t){var n=this;return this.In.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){return n.bn(t,e)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return Ma.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Vn(e,t.path):function(e){return null!==e.collectionGroup}(t)?this.Sn(e,t,n):this.Dn(e,t,n)}},{key:"Vn",value:function(e,t){return this.An(e,new Ma(t)).next((function(e){var t=ws();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"Sn",value:function(e,t,n){var r=this,i=t.collectionGroup,a=ws();return this.Ht.getCollectionParents(e,i).next((function(o){return gu.forEach(o,(function(o){var s=function(e,t){return new ko(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return r.Dn(e,s,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"Dn",value:function(e,t,n){var r,i,a=this;return this.He.getDocumentsMatchingQuery(e,t,n).next((function(n){return r=n,a.In.getAllMutationBatchesAffectingQuery(e,t)})).next((function(t){return i=t,a.Cn(e,i,r).next((function(e){r=e;var t,n=Bi(i);try{for(n.s();!(t=n.n()).done;){var a,o=t.value,s=Bi(o.mutations);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u.key,l=r.get(c);null==l&&(l=$a.newInvalidDocument(c),r=r.insert(c,l)),$o(u,l,o.localWriteTime),l.isFoundDocument()||(r=r.remove(c))}}catch(e){s.e(e)}finally{s.f()}}}catch(e){n.e(e)}finally{n.f()}}))})).next((function(){return r.forEach((function(e,n){Ao(t,n)||(r=r.remove(e))})),r}))}},{key:"Cn",value:function(e,t,n){var r,i=Is(),a=Bi(t);try{for(a.s();!(r=a.n()).done;){var o,s=Bi(r.value.mutations);try{for(s.s();!(o=s.n()).done;){var u=o.value;u instanceof ns&&null===n.get(u.key)&&(i=i.add(u.key))}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}var c=n;return this.He.getEntries(e,i).next((function(e){return e.forEach((function(e,t){t.isFoundDocument()&&(c=c.insert(e,t))})),c}))}}]),e}(),Ou=function(){function e(t,r,i,a){n(this,e),this.targetId=t,this.fromCache=r,this.Nn=i,this.xn=a}return d(e,null,[{key:"kn",value:function(t,n){var r,i=Is(),a=Is(),o=Bi(n.docChanges);try{for(o.s();!(r=o.n()).done;){var s=r.value;switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:a=a.add(s.doc.key)}}}catch(e){o.e(e)}finally{o.f()}return new e(t,n.fromCache,i,a)}}]),e}(),Lu=function(){function e(){n(this,e)}return d(e,[{key:"$n",value:function(e){this.On=e}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(ya.min())?this.Fn(e,t):this.On.Pn(e,r).next((function(a){var o=i.Mn(t,a);return(wo(t)||Eo(t))&&i.Ln(t.limitType,o,r,n)?i.Fn(e,t):(Qi()<=Z.DEBUG&&Xi("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),So(t)),i.On.getDocumentsMatchingQuery(e,t,n).next((function(e){return o.forEach((function(t){e=e.insert(t.key,t)})),e})))}))}},{key:"Mn",value:function(e,t){var n=new ys(No(e));return t.forEach((function(t,r){Ao(e,r)&&(n=n.add(r))})),n}},{key:"Ln",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Fn",value:function(e,t){return Qi()<=Z.DEBUG&&Xi("QueryEngine","Using full collection scan to execute query:",So(t)),this.On.getDocumentsMatchingQuery(e,t,ya.min())}}]),e}(),Mu=function(){function e(t,r,i,a){n(this,e),this.persistence=t,this.Bn=r,this.N=a,this.Un=new ds(da),this.qn=new Cu((function(e){return eo(e)}),to),this.Kn=ya.min(),this.In=t.getMutationQueue(i),this.jn=t.getRemoteDocumentCache(),this.ze=t.getTargetCache(),this.Qn=new Ru(this.jn,this.In,this.persistence.getIndexManager()),this.Je=t.getBundleCache(),this.Bn.$n(this.Qn)}return d(e,[{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.Un)}))}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fu(e,t){return Pu.apply(this,arguments)}function Pu(){return Pu=t(u.mark((function e(t,n){var r,i,a,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ta(t),i=r.In,a=r.Qn,e.next=4,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.In.getAllMutationBatches(e).next((function(o){return t=o,i=r.persistence.getMutationQueue(n),a=new Ru(r.jn,i,r.persistence.getIndexManager()),i.getAllMutationBatches(e)})).next((function(n){var r,i=[],o=[],s=Is(),u=Bi(t);try{for(u.s();!(r=u.n()).done;){var c=r.value;i.push(c.batchId);var l,f=Bi(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;s=s.add(h.key)}}catch(e){f.e(e)}finally{f.f()}}}catch(e){u.e(e)}finally{u.f()}var d,v=Bi(n);try{for(v.s();!(d=v.n()).done;){var p=d.value;o.push(p.batchId);var y,g=Bi(p.mutations);try{for(g.s();!(y=g.n()).done;){var m=y.value;s=s.add(m.key)}}catch(e){g.e(e)}finally{g.f()}}}catch(e){v.e(e)}finally{v.f()}return a.Pn(e,s).next((function(e){return{Wn:e,removedBatchIds:i,addedBatchIds:o}}))}))}));case 4:return o=e.sent,e.abrupt("return",(r.In=i,r.Qn=a,r.Bn.$n(r.Qn),o));case 6:case"end":return e.stop()}}),e)}))),Pu.apply(this,arguments)}function Uu(e,t){var n=ta(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.jn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),o=gu.resolve();return a.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);ea(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),o.next((function(){return e.In.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.In.performConsistencyCheck(e)})).next((function(){return n.Qn.Pn(e,r)}))}))}function ju(e){var t=ta(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.ze.getLastRemoteSnapshotVersion(e)}))}function Vu(e,t){var n=ta(e),r=t.snapshotVersion,i=n.Un;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.jn.newChangeBuffer({trackRemovals:!0});i=n.Un;var o=[];t.targetChanges.forEach((function(t,a){var s=i.get(a);if(s){o.push(n.ze.removeMatchingKeys(e,t.removedDocuments,a).next((function(){return n.ze.addMatchingKeys(e,t.addedDocuments,a)})));var u=t.resumeToken;if(u.approximateByteSize()>0){var c=s.withResumeToken(u,r).withSequenceNumber(e.currentSequenceNumber);i=i.insert(a,c),function(e,t,n){return ea(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(s,c,t)&&o.push(n.ze.updateTargetData(e,c))}}}));var s=ks();if(t.documentUpdates.forEach((function(r,i){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n,r,i){var a=Is();return n.forEach((function(e){return a=a.add(e)})),t.getEntries(e,a).next((function(e){var a=ks();return n.forEach((function(n,o){var s=e.get(n),u=(null==i?void 0:i.get(n))||r;o.isNoDocument()&&o.version.isEqual(ya.min())?(t.removeEntry(n,u),a=a.insert(n,o)):!s.isValidDocument()||o.version.compareTo(s.version)>0||0===o.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(o,u),a=a.insert(n,o)):Xi("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",o.version)})),a}))}(e,a,t.documentUpdates,r,void 0).next((function(e){s=e}))),!r.isEqual(ya.min())){var u=n.ze.getLastRemoteSnapshotVersion(e).next((function(t){return n.ze.setTargetsMetadata(e,e.currentSequenceNumber,r)}));o.push(u)}return gu.waitFor(o).next((function(){return a.apply(e)})).next((function(){return n.Qn.vn(e,s)})).next((function(){return s}))})).then((function(e){return n.Un=i,e}))}function Bu(e,t){var n=ta(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.In.getNextMutationBatchAfterBatchId(e,t)}))}function qu(e,t){var n=ta(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.ze.getTargetData(e,t).next((function(i){return i?(r=i,gu.resolve(r)):n.ze.allocateTargetId(e).next((function(i){return r=new wu(t,i,0,e.currentSequenceNumber),n.ze.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.Un.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Un=n.Un.insert(e.targetId,e),n.qn.set(t,e.targetId)),e}))}function zu(e,t,n){return Hu.apply(this,arguments)}function Hu(){return Hu=t(u.mark((function e(t,n,r){var i,a,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=ta(t),a=i.Un.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",o,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),mu(e.t1)){e.next=12;break}throw e.t1;case 12:Xi("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.Un=i.Un.remove(n),i.qn.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])}))),Hu.apply(this,arguments)}function Ku(e,t,n){var r=ta(e),i=ya.min(),a=Is();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=ta(e),i=r.qn.get(n);return void 0!==i?gu.resolve(r.Un.get(i)):r.ze.getTargetData(t,n)}(r,e,Io(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.ze.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Bn.getDocumentsMatchingQuery(e,t,n?i:ya.min(),n?a:Is())})).next((function(e){return{documents:e,Gn:a}}))}))}var Gu=function(){function e(t){n(this,e),this.N=t,this.Yn=new Map,this.Xn=new Map}return d(e,[{key:"getBundleMetadata",value:function(e,t){return gu.resolve(this.Yn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Yn.set(t.id,{id:(n=t).id,version:n.version,createTime:qs(n.createTime)}),gu.resolve()}},{key:"getNamedQuery",value:function(e,t){return gu.resolve(this.Xn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Xn.set(t.name,function(e){return{name:e.name,query:_u(e.bundledQuery),readTime:qs(e.readTime)}}(t)),gu.resolve()}}]),e}(),Wu=function(){function e(){n(this,e),this.Zn=new ys(Qu.ts),this.es=new ys(Qu.ns)}return d(e,[{key:"isEmpty",value:function(){return this.Zn.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Qu(e,t);this.Zn=this.Zn.add(n),this.es=this.es.add(n)}},{key:"ss",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.rs(new Qu(e,t))}},{key:"os",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"cs",value:function(e){var t=this,n=new Ma(new wa([])),r=new Qu(n,e),i=new Qu(n,e+1),a=[];return this.es.forEachInRange([r,i],(function(e){t.rs(e),a.push(e.key)})),a}},{key:"us",value:function(){var e=this;this.Zn.forEach((function(t){return e.rs(t)}))}},{key:"rs",value:function(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}},{key:"hs",value:function(e){var t=new Ma(new wa([])),n=new Qu(t,e),r=new Qu(t,e+1),i=Is();return this.es.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Qu(e,0),n=this.Zn.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Qu=function(){function e(t,r){n(this,e),this.key=t,this.ls=r}return d(e,null,[{key:"ts",value:function(e,t){return Ma.comparator(e.key,t.key)||da(e.ls,t.ls)}},{key:"ns",value:function(e,t){return da(e.ls,t.ls)||Ma.comparator(e.key,t.key)}}]),e}(),Xu=function(){function e(t,r){n(this,e),this.Ht=t,this.referenceDelegate=r,this.In=[],this.fs=1,this.ds=new ys(Qu.ts)}return d(e,[{key:"checkEmpty",value:function(e){return gu.resolve(0===this.In.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.fs;this.fs++,this.In.length>0&&this.In[this.In.length-1];var a=new ku(i,t,n,r);this.In.push(a);var o,s=Bi(r);try{for(s.s();!(o=s.n()).done;){var u=o.value;this.ds=this.ds.add(new Qu(u.key,i)),this.Ht.addToCollectionParentIndex(e,u.key.path.popLast())}}catch(e){s.e(e)}finally{s.f()}return gu.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return gu.resolve(this.ws(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this._s(n),i=r<0?0:r;return gu.resolve(this.In.length>i?this.In[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return gu.resolve(0===this.In.length?-1:this.fs-1)}},{key:"getAllMutationBatches",value:function(e){return gu.resolve(this.In.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Qu(t,0),i=new Qu(t,Number.POSITIVE_INFINITY),a=[];return this.ds.forEachInRange([r,i],(function(e){var t=n.ws(e.ls);a.push(t)})),gu.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new ys(da);return t.forEach((function(e){var t=new Qu(e,0),i=new Qu(e,Number.POSITIVE_INFINITY);n.ds.forEachInRange([t,i],(function(e){r=r.add(e.ls)}))})),gu.resolve(this.gs(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;Ma.isDocumentKey(i)||(i=i.child(""));var a=new Qu(new Ma(i),0),o=new ys(da);return this.ds.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.ls)),!0)}),a),gu.resolve(this.gs(o))}},{key:"gs",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.ws(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;ea(0===this.ys(t.batchId,"removed")),this.In.shift();var r=this.ds;return gu.forEach(t.mutations,(function(i){var a=new Qu(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ds=r}))}},{key:"te",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Qu(t,0),r=this.ds.firstAfterOrEqual(n);return gu.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.In.length,gu.resolve()}},{key:"ys",value:function(e,t){return this._s(e)}},{key:"_s",value:function(e){return 0===this.In.length?0:e-this.In[0].batchId}},{key:"ws",value:function(e){var t=this._s(e);return t<0||t>=this.In.length?null:this.In[t]}}]),e}(),Yu=function(){function e(t,r){n(this,e),this.Ht=t,this.ps=r,this.docs=new ds(Ma.comparator),this.size=0}return d(e,[{key:"addEntry",value:function(e,t,n){var r=t.key,i=this.docs.get(r),a=i?i.size:0,o=this.ps(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:o,readTime:n}),this.size+=o-a,this.Ht.addToCollectionParentIndex(e,r.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return gu.resolve(n?n.document.clone():$a.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=ks();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.clone():$a.newInvalidDocument(e))})),gu.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){for(var r=ks(),i=new Ma(t.path.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var o=a.getNext(),s=o.key,u=o.value,c=u.document,l=u.readTime;if(!t.path.isPrefixOf(s.path))break;l.compareTo(n)<=0||Ao(t,c)&&(r=r.insert(c.key,c.clone()))}return gu.resolve(r)}},{key:"Ts",value:function(e,t){return gu.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new $u(this)}},{key:"getSize",value:function(e){return gu.resolve(this.size)}}]),e}(),$u=function(e){E(r,Du);var t=zi(r);function r(e){var i;return n(this,r),(i=t.call(this)).Se=e,i}return d(r,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(t.Se.addEntry(e,i.document,t.getReadTime(r))):t.Se.removeEntry(r)})),gu.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.Se.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.Se.getEntries(e,t)}}]),r}(),Ju=function(){function e(t){n(this,e),this.persistence=t,this.Es=new Cu((function(e){return eo(e)}),to),this.lastRemoteSnapshotVersion=ya.min(),this.highestTargetId=0,this.Is=0,this.As=new Wu,this.targetCount=0,this.Rs=Su.se()}return d(e,[{key:"forEachTarget",value:function(e,t){return this.Es.forEach((function(e,n){return t(n)})),gu.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return gu.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return gu.resolve(this.Is)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Rs.next(),gu.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Is&&(this.Is=t),gu.resolve()}},{key:"ce",value:function(e){this.Es.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Rs=new Su(t),this.highestTargetId=t),e.sequenceNumber>this.Is&&(this.Is=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.ce(t),this.targetCount+=1,gu.resolve()}},{key:"updateTargetData",value:function(e,t){return this.ce(t),gu.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Es.delete(t.target),this.As.cs(t.targetId),this.targetCount-=1,gu.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Es.forEach((function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Es.delete(o),a.push(r.removeMatchingKeysForTargetId(e,s.targetId)),i++)})),gu.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return gu.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Es.get(t)||null;return gu.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.As.ss(t,n),gu.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.As.os(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),gu.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.As.cs(t),gu.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.As.hs(t);return gu.resolve(n)}},{key:"containsKey",value:function(e,t){return gu.resolve(this.As.containsKey(t))}}]),e}(),Zu=function(){function e(t,r){var i=this;n(this,e),this.bs={},this.Le=new la(0),this.Be=!1,this.Be=!0,this.referenceDelegate=t(this),this.ze=new Ju(this),this.Ht=new Iu,this.He=function(e,t){return new Yu(e,(function(e){return i.referenceDelegate.Ps(e)}))}(this.Ht),this.N=new Eu(r),this.Je=new Gu(this.N)}return d(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Be=!1,Promise.resolve()}},{key:"started",get:function(){return this.Be}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(){return this.Ht}},{key:"getMutationQueue",value:function(e){var t=this.bs[e.toKey()];return t||(t=new Xu(this.Ht,this.referenceDelegate),this.bs[e.toKey()]=t),t}},{key:"getTargetCache",value:function(){return this.ze}},{key:"getRemoteDocumentCache",value:function(){return this.He}},{key:"getBundleCache",value:function(){return this.Je}},{key:"runTransaction",value:function(e,t,n){var r=this;Xi("MemoryPersistence","Starting transaction:",e);var i=new ec(this.Le.next());return this.referenceDelegate.vs(),n(i).next((function(e){return r.referenceDelegate.Vs(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ss",value:function(e,t){return gu.or(Object.values(this.bs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),ec=function(e){E(r,yu);var t=zi(r);function r(e){var i;return n(this,r),(i=t.call(this)).currentSequenceNumber=e,i}return r}(),tc=function(){function e(t){n(this,e),this.persistence=t,this.Ds=new Wu,this.Cs=null}return d(e,[{key:"xs",get:function(){if(this.Cs)return this.Cs;throw Zi()}},{key:"addReference",value:function(e,t,n){return this.Ds.addReference(n,t),this.xs.delete(n.toString()),gu.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Ds.removeReference(n,t),this.xs.add(n.toString()),gu.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.xs.add(t.toString()),gu.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Ds.cs(t.targetId).forEach((function(e){return n.xs.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.xs.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"vs",value:function(){this.Cs=new Set}},{key:"Vs",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return gu.forEach(this.xs,(function(r){var i=Ma.fromPath(r);return t.ks(e,i).next((function(e){e||n.removeEntry(i)}))})).next((function(){return t.Cs=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.ks(e,t).next((function(e){e?n.xs.delete(t.toString()):n.xs.add(t.toString())}))}},{key:"Ps",value:function(e){return 0}},{key:"ks",value:function(e,t){var n=this;return gu.or([function(){return gu.resolve(n.Ds.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ss(e,t)}])}}],[{key:"Ns",value:function(t){return new e(t)}}]),e}(),nc=function(){function e(){n(this,e),this.activeTargetIds=Ts()}return d(e,[{key:"Fs",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Ms",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Os",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),rc=function(){function e(){n(this,e),this.yi=new nc,this.pi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return d(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.yi.Fs(e),this.pi[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.pi[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.yi.Ms(e)}},{key:"isLocalQueryTarget",value:function(e){return this.yi.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.pi[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.yi.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.yi.activeTargetIds.has(e)}},{key:"start",value:function(){return this.yi=new nc,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(){}}]),e}(),ic=function(){function e(){n(this,e)}return d(e,[{key:"Ti",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),ac=function(){function e(){var t=this;n(this,e),this.Ei=function(){return t.Ii()},this.Ai=function(){return t.Ri()},this.bi=[],this.Pi()}return d(e,[{key:"Ti",value:function(e){this.bi.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Ei),window.removeEventListener("offline",this.Ai)}},{key:"Pi",value:function(){window.addEventListener("online",this.Ei),window.addEventListener("offline",this.Ai)}},{key:"Ii",value:function(){Xi("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=Bi(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(e){t.e(e)}finally{t.f()}}},{key:"Ri",value:function(){Xi("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=Bi(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(e){t.e(e)}finally{t.f()}}}],[{key:"bt",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),oc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},sc=function(){function e(t){n(this,e),this.vi=t.vi,this.Vi=t.Vi}return d(e,[{key:"Si",value:function(e){this.Di=e}},{key:"Ci",value:function(e){this.Ni=e}},{key:"onMessage",value:function(e){this.xi=e}},{key:"close",value:function(){this.Vi()}},{key:"send",value:function(e){this.vi(e)}},{key:"ki",value:function(){this.Di()}},{key:"$i",value:function(e){this.Ni(e)}},{key:"Oi",value:function(e){this.xi(e)}}]),e}(),uc=function(e){E(r,e);var t=zi(r);function r(e){var i;return n(this,r),(i=t.call(this,e)).forceLongPolling=e.forceLongPolling,i.autoDetectLongPolling=e.autoDetectLongPolling,i.useFetchStreams=e.useFetchStreams,i}return d(r,[{key:"qi",value:function(e,t,n,r){return new Promise((function(i,a){var o=new Vi;o.listenOnce(Li.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case Oi.NO_ERROR:var t=o.getResponseJson();Xi("Connection","XHR received:",JSON.stringify(t)),i(t);break;case Oi.TIMEOUT:Xi("Connection",'RPC "'+e+'" timed out'),a(new ra(na.DEADLINE_EXCEEDED,"Request time out"));break;case Oi.HTTP_ERROR:var n=o.getStatus();if(Xi("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var s=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(na).indexOf(t)>=0?t:na.UNKNOWN}(r.status);a(new ra(s,r.message))}else a(new ra(na.UNKNOWN,"Server responded with status "+o.getStatus()))}else a(new ra(na.UNAVAILABLE,"Connection failed."));break;default:Zi()}}finally{Xi("Connection",'RPC "'+e+'" completed.')}}));var s=JSON.stringify(r);o.send(t,"POST",s,n,15)}))}},{key:"ji",value:function(e,t){var n=[this.Fi,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=new Ai,i=wn(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new Ui({})),this.Ui(a.initMessageHeaders,t),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(V())||"object"===("undefined"==typeof navigator?"undefined":o(navigator))&&"ReactNative"===navigator.product||V().indexOf("Electron/")>=0||function(){var e=V();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||V().indexOf("MSAppHost/")>=0||function(){var e="object"===("undefined"==typeof chrome?"undefined":o(chrome))?chrome.runtime:"object"===("undefined"==typeof browser?"undefined":o(browser))?browser.runtime:void 0;return"object"===o(e)&&void 0!==e.id}()||(a.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Xi("Connection","Creating WebChannel: "+s,a);var u=r.createWebChannel(s,a),c=!1,l=!1,f=new sc({vi:function(e){l?Xi("Connection","Not sending because WebChannel is closed:",e):(c||(Xi("Connection","Opening WebChannel transport."),u.open(),c=!0),Xi("Connection","WebChannel sending:",e),u.send(e))},Vi:function(){return u.close()}}),h=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return h(u,ji.EventType.OPEN,(function(){l||Xi("Connection","WebChannel transport opened.")})),h(u,ji.EventType.CLOSE,(function(){l||(l=!0,Xi("Connection","WebChannel transport closed"),f.$i())})),h(u,ji.EventType.ERROR,(function(e){l||(l=!0,$i("Connection","WebChannel transport errored:",e),f.$i(new ra(na.UNAVAILABLE,"The operation could not be completed")))})),h(u,ji.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];ea(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){Xi("Connection","WebChannel received error:",i);var a=i.status,o=function(e){var t=os[e];if(void 0!==t)return hs(t)}(a),s=i.message;void 0===o&&(o=na.INTERNAL,s="Unknown error status: "+a+" with message "+i.message),l=!0,f.$i(new ra(o,s)),u.close()}else Xi("Connection","WebChannel received:",n),f.Oi(n)}})),h(i,Mi.STAT_EVENT,(function(e){e.stat===Fi?Xi("Connection","Detected buffering proxy"):e.stat===Pi&&Xi("Connection","Detected no buffering proxy")})),setTimeout((function(){f.ki()}),0),f}}]),r}(function(){function e(t){n(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var r=t.ssl?"https":"http";this.Fi=r+"://"+t.host,this.Mi="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return d(e,[{key:"Li",value:function(e,t,n,r){var i=this.Bi(e,t);Xi("RestConnection","Sending: ",i,n);var a={};return this.Ui(a,r),this.qi(e,i,a,n).then((function(e){return Xi("RestConnection","Received: ",e),e}),(function(t){throw $i("RestConnection","".concat(e," failed with error: "),t,"url: ",i,"request:",n),t}))}},{key:"Ki",value:function(e,t,n,r){return this.Li(e,t,n,r)}},{key:"Ui",value:function(e,t){if(e["X-Goog-Api-Client"]="gl-js/ fire/"+Gi,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t)for(var n in t.authHeaders)t.authHeaders.hasOwnProperty(n)&&(e[n]=t.authHeaders[n])}},{key:"Bi",value:function(e,t){var n=oc[e];return"".concat(this.Fi,"/v1/").concat(t,":").concat(n)}}]),e}());
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cc(){return"undefined"!=typeof document?document:null}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lc(e){return new Us(e,!0)}var fc=function(){function e(t,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;n(this,e),this.Oe=t,this.timerId=r,this.Qi=i,this.Wi=a,this.Gi=o,this.zi=0,this.Hi=null,this.Ji=Date.now(),this.reset()}return d(e,[{key:"reset",value:function(){this.zi=0}},{key:"Yi",value:function(){this.zi=this.Gi}},{key:"Xi",value:function(e){var t=this;this.cancel();var n=Math.floor(this.zi+this.Zi()),r=Math.max(0,Date.now()-this.Ji),i=Math.max(0,n-r);i>0&&Xi("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.zi," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Hi=this.Oe.enqueueAfterDelay(this.timerId,i,(function(){return t.Ji=Date.now(),e()})),this.zi*=this.Wi,this.zi<this.Qi&&(this.zi=this.Qi),this.zi>this.Gi&&(this.zi=this.Gi)}},{key:"tr",value:function(){null!==this.Hi&&(this.Hi.skipDelay(),this.Hi=null)}},{key:"cancel",value:function(){null!==this.Hi&&(this.Hi.cancel(),this.Hi=null)}},{key:"Zi",value:function(){return(Math.random()-.5)*this.zi}}]),e}(),hc=function(){function e(t,r,i,a,o,s,u){n(this,e),this.Oe=t,this.er=i,this.nr=a,this.sr=o,this.credentialsProvider=s,this.listener=u,this.state=0,this.ir=0,this.rr=null,this.cr=null,this.stream=null,this.ar=new fc(t,r)}var r,i,a;return d(e,[{key:"ur",value:function(){return 1===this.state||5===this.state||this.hr()}},{key:"hr",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.lr()}},{key:"stop",value:(a=t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.ur(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"dr",value:function(){this.state=0,this.ar.reset()}},{key:"wr",value:function(){var e=this;this.hr()&&null===this.rr&&(this.rr=this.Oe.enqueueAfterDelay(this.er,6e4,(function(){return e._r()})))}},{key:"mr",value:function(e){this.gr(),this.stream.send(e)}},{key:"_r",value:(i=t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hr()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"gr",value:function(){this.rr&&(this.rr.cancel(),this.rr=null)}},{key:"yr",value:function(){this.cr&&(this.cr.cancel(),this.cr=null)}},{key:"close",value:(r=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gr(),this.yr(),this.ar.cancel(),this.ir++,4!==t?this.ar.reset():n&&n.code===na.RESOURCE_EXHAUSTED?(Yi(n.toString()),Yi("Using maximum backoff delay to prevent overloading the backend."),this.ar.Yi()):n&&n.code===na.UNAUTHENTICATED&&3!==this.state&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.pr(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Ci(n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"pr",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Tr(this.ir),n=this.ir;this.credentialsProvider.getToken().then((function(t){e.ir===n&&e.Er(t)}),(function(n){t((function(){var t=new ra(na.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Ir(t)}))}))}},{key:"Er",value:function(e){var t=this,n=this.Tr(this.ir);this.stream=this.Ar(e),this.stream.Si((function(){n((function(){return t.state=2,t.cr=t.Oe.enqueueAfterDelay(t.nr,1e4,(function(){return t.hr()&&(t.state=3),Promise.resolve()})),t.listener.Si()}))})),this.stream.Ci((function(e){n((function(){return t.Ir(e)}))})),this.stream.onMessage((function(e){n((function(){return t.onMessage(e)}))}))}},{key:"lr",value:function(){var e=this;this.state=5,this.ar.Xi(t(u.mark((function t(){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Ir",value:function(e){return Xi("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Tr",value:function(e){var t=this;return function(n){t.Oe.enqueueAndForget((function(){return t.ir===e?n():(Xi("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),dc=function(e){E(r,hc);var t=zi(r);function r(e,i,a,o,s){var u;return n(this,r),(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",i,a,s)).N=o,u}return d(r,[{key:"Ar",value:function(e){return this.sr.ji("Listen",e)}},{key:"onMessage",value:function(e){this.ar.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Zi()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.D?(ea(void 0===t||"string"==typeof t),xa.fromBase64String(t||"")):(ea(void 0===t||t instanceof Uint8Array),xa.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&function(e){var t=void 0===e.code?na.UNKNOWN:hs(e.code);return new ra(t,e.message||"")}(o);n=new Ds(r,i,a,s||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var c=Gs(e,u.document.name),l=qs(u.document.updateTime),f=new Xa({mapValue:{fields:u.document.fields}}),h=$a.newFoundDocument(c,l,f),d=u.targetIds||[],v=u.removedTargetIds||[];n=new Ns(d,v,h.key,h)}else if("documentDelete"in t){t.documentDelete;var p=t.documentDelete;p.document;var y=Gs(e,p.document),g=p.readTime?qs(p.readTime):ya.min(),m=$a.newNoDocument(y,g),k=p.removedTargetIds||[];n=new Ns([],k,m.key,m)}else if("documentRemove"in t){t.documentRemove;var b=t.documentRemove;b.document;var w=Gs(e,b.document),E=b.removedTargetIds||[];n=new Ns([],E,w,null)}else{if(!("filter"in t))return Zi();t.filter;var _=t.filter;_.targetId;var I=_.count||0,x=new ls(I),T=_.targetId;n=new Cs(T,x)}return n}(this.N,e),n=function(e){if(!("targetChange"in e))return ya.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?ya.min():t.readTime?qs(t.readTime):ya.min()}(e);return this.listener.Rr(t,n)}},{key:"br",value:function(e){var t={};t.database=Qs(this.N),t.addTarget=function(e,t){var n,r=t.target;return(n=no(r)?{documents:$s(e,r)}:{query:Js(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Vs(e,t.resumeToken):t.snapshotVersion.compareTo(ya.min())>0&&(n.readTime=js(e,t.snapshotVersion.toTimestamp())),n}(this.N,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Zi()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.N,e);n&&(t.labels=n),this.mr(t)}},{key:"Pr",value:function(e){var t={};t.database=Qs(this.N),t.removeTarget=e,this.mr(t)}}]),r}(),vc=function(e){E(r,hc);var t=zi(r);function r(e,i,a,o,s){var u;return n(this,r),(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",i,a,s)).N=o,u.vr=!1,u}return d(r,[{key:"Vr",get:function(){return this.vr}},{key:"start",value:function(){this.vr=!1,this.lastStreamToken=void 0,xe(I(r.prototype),"start",this).call(this)}},{key:"pr",value:function(){this.vr&&this.Sr([])}},{key:"Ar",value:function(e){return this.sr.ji("Write",e)}},{key:"onMessage",value:function(e){if(ea(!!e.streamToken),this.lastStreamToken=e.streamToken,this.vr){this.ar.reset();var t=function(e,t){return e&&e.length>0?(ea(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?qs(e.updateTime):qs(t);return n.isEqual(ya.min())&&(n=qs(t)),new Go(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=qs(e.commitTime);return this.listener.Dr(n,t)}return ea(!e.writeResults||0===e.writeResults.length),this.vr=!0,this.listener.Cr()}},{key:"Nr",value:function(){var e={};e.database=Qs(this.N),this.mr(e)}},{key:"Sr",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return function(e,t){var n;if(t instanceof ts)n={update:Ys(e,t.key,t.value)};else if(t instanceof us)n={delete:Ks(e,t.key)};else if(t instanceof ns)n={update:Ys(e,t.key,t.data),updateMask:cu(t.fieldMask)};else{if(!(t instanceof cs))return Zi();n={verify:Ks(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Uo)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof jo)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Bo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof zo)return{fieldPath:t.field.canonicalString(),increment:n.C};throw Zi()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Bs(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Zi()}(e,t.precondition)),n}(t.N,e)}))};this.mr(n)}}]),r}(),pc=function(e){E(r,e);var t=zi(r);function r(e,i,a){var o;return n(this,r),(o=t.call(this)).credentials=e,o.sr=i,o.N=a,o.kr=!1,o}return d(r,[{key:"$r",value:function(){if(this.kr)throw new ra(na.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Li",value:function(e,t,n){var r=this;return this.$r(),this.credentials.getToken().then((function(i){return r.sr.Li(e,t,n,i)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===na.UNAUTHENTICATED&&r.credentials.invalidateToken(),e):new ra(na.UNKNOWN,e.toString())}))}},{key:"Ki",value:function(e,t,n){var r=this;return this.$r(),this.credentials.getToken().then((function(i){return r.sr.Ki(e,t,n,i)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===na.UNAUTHENTICATED&&r.credentials.invalidateToken(),e):new ra(na.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.kr=!0}}]),r}(function(){return function e(){n(this,e)}}()),yc=function(){function e(t,r){n(this,e),this.asyncQueue=t,this.onlineStateHandler=r,this.state="Unknown",this.Or=0,this.Fr=null,this.Mr=!0}return d(e,[{key:"Lr",value:function(){var e=this;0===this.Or&&(this.Br("Unknown"),this.Fr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.Fr=null,e.Ur("Backend didn't respond within 10 seconds."),e.Br("Offline"),Promise.resolve()})))}},{key:"qr",value:function(e){"Online"===this.state?this.Br("Unknown"):(this.Or++,this.Or>=1&&(this.Kr(),this.Ur("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.Br("Offline")))}},{key:"set",value:function(e){this.Kr(),this.Or=0,"Online"===e&&(this.Mr=!1),this.Br(e)}},{key:"Br",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"Ur",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.Mr?(Yi(t),this.Mr=!1):Xi("OnlineStateTracker",t)}},{key:"Kr",value:function(){null!==this.Fr&&(this.Fr.cancel(),this.Fr=null)}}]),e}(),gc=function e(r,i,a,o,s){var c=this;n(this,e),this.localStore=r,this.datastore=i,this.asyncQueue=a,this.remoteSyncer={},this.jr=[],this.Qr=new Map,this.Wr=new Set,this.Gr=[],this.zr=s,this.zr.Ti((function(e){a.enqueueAndForget(t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=Ac(c),!e.t0){e.next=5;break}return Xi("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=t(u.mark((function e(t){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=ta(t)).Wr.add(4),e.next=4,bc(n);case 4:return n.Hr.set("Unknown"),n.Wr.delete(4),e.next=8,mc(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(c);case 5:case"end":return e.stop()}}),e)}))))})),this.Hr=new yc(a,o)};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(e){return kc.apply(this,arguments)}function kc(){return kc=t(u.mark((function e(t){var n,r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ac(t)){e.next=18;break}n=Bi(t.Gr),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])}))),kc.apply(this,arguments)}function bc(e){return wc.apply(this,arguments)}function wc(){return wc=t(u.mark((function e(t){var n,r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Bi(t.Gr),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])}))),wc.apply(this,arguments)}function Ec(e,t){var n=ta(e);n.Qr.has(t.targetId)||(n.Qr.set(t.targetId,t),Sc(n)?Tc(n):tl(n).hr()&&Ic(n,t))}function _c(e,t){var n=ta(e),r=tl(n);n.Qr.delete(t),r.hr()&&xc(n,t),0===n.Qr.size&&(r.hr()?r.wr():Ac(n)&&n.Hr.set("Unknown"))}function Ic(e,t){e.Jr.Y(t.targetId),tl(e).br(t)}function xc(e,t){e.Jr.Y(t),tl(e).Pr(t)}function Tc(e){e.Jr=new Os({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Tt:function(t){return e.Qr.get(t)||null}}),tl(e).start(),e.Hr.Lr()}function Sc(e){return Ac(e)&&!tl(e).ur()&&e.Qr.size>0}function Ac(e){return 0===ta(e).Wr.size}function Nc(e){e.Jr=void 0}function Cc(e){return Dc.apply(this,arguments)}function Dc(){return Dc=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Qr.forEach((function(e,n){Ic(t,e)}));case 1:case"end":return e.stop()}}),e)}))),Dc.apply(this,arguments)}function Rc(e,t){return Oc.apply(this,arguments)}function Oc(){return Oc=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Nc(t),Sc(t)?(t.Hr.qr(n),Tc(t)):t.Hr.set("Unknown");case 1:case"end":return e.stop()}}),e)}))),Oc.apply(this,arguments)}function Lc(e,t,n){return Mc.apply(this,arguments)}function Mc(){return Mc=t(u.mark((function e(n,r,i){var a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.Hr.set("Online"),!(r instanceof Ds&&2===r.state&&r.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=t(u.mark((function e(t,n){var r,i,a,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=Bi(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(o=a.value,e.t0=t.Qr.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.Qr.delete(o),t.Jr.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(n,r);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),Xi("RemoteStore","Failed to remove targets %s: %s ",r.targetIds.join(","),e.t0),e.next=11,Fc(n,e.t0);case 11:case 22:e.next=29;break;case 13:if(r instanceof Ns?n.Jr.rt(r):r instanceof Cs?n.Jr.ft(r):n.Jr.at(r),i.isEqual(ya.min())){e.next=29;break}return e.prev=14,e.next=17,ju(n.localStore);case 17:if(a=e.sent,e.t1=i.compareTo(a)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Jr._t(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.Qr.get(r);i&&e.Qr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.Qr.get(t);if(n){e.Qr.set(t,n.withResumeToken(xa.EMPTY_BYTE_STRING,n.snapshotVersion)),xc(e,t);var r=new wu(n.target,t,1,n.sequenceNumber);Ic(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(n,i);case 24:return e.prev=24,e.t2=e.catch(14),Xi("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,Fc(n,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),Mc.apply(this,arguments)}function Fc(e,t,n){return Pc.apply(this,arguments)}function Pc(){return Pc=t(u.mark((function e(n,r,i){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(mu(r)){e.next=2;break}throw r;case 2:return n.Wr.add(1),e.next=5,bc(n);case 5:n.Hr.set("Offline"),i||(i=function(){return ju(n.localStore)}),n.asyncQueue.enqueueRetryable(t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xi("RemoteStore","Retrying IndexedDB access"),e.next=3,i();case 3:return n.Wr.delete(1),e.next=6,mc(n);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)}))),Pc.apply(this,arguments)}function Uc(e,t){return t().catch((function(n){return Fc(e,n,t)}))}function jc(e){return Vc.apply(this,arguments)}function Vc(){return Vc=t(u.mark((function e(t){var n,r,i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=ta(t),r=nl(n),i=n.jr.length>0?n.jr[n.jr.length-1].batchId:-1;case 2:if(!Bc(n)){e.next=19;break}return e.prev=3,e.next=6,Bu(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.jr.length&&r.wr(),e.abrupt("break",19);case 10:i=a.batchId,qc(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,Fc(n,e.t0);case 17:e.next=2;break;case 19:zc(n)&&Hc(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Vc.apply(this,arguments)}function Bc(e){return Ac(e)&&e.jr.length<10}function qc(e,t){e.jr.push(t);var n=nl(e);n.hr()&&n.Vr&&n.Sr(t.mutations)}function zc(e){return Ac(e)&&!nl(e).ur()&&e.jr.length>0}function Hc(e){nl(e).start()}function Kc(e){return Gc.apply(this,arguments)}function Gc(){return Gc=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:nl(t).Nr();case 1:case"end":return e.stop()}}),e)}))),Gc.apply(this,arguments)}function Wc(e){return Qc.apply(this,arguments)}function Qc(){return Qc=t(u.mark((function e(t){var n,r,i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=nl(t),r=Bi(t.jr);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Sr(a.mutations)}catch(e){r.e(e)}finally{r.f()}case 3:case"end":return e.stop()}}),e)}))),Qc.apply(this,arguments)}function Xc(e,t,n){return Yc.apply(this,arguments)}function Yc(){return Yc=t(u.mark((function e(t,n,r){var i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.jr.shift(),a=bu.from(i,n,r),e.next=3,Uc(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,jc(t);case 5:case"end":return e.stop()}}),e)}))),Yc.apply(this,arguments)}function $c(e,t){return Jc.apply(this,arguments)}function Jc(){return Jc=t(u.mark((function e(n,r){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=r&&nl(n).Vr,!e.t0){e.next=4;break}return e.next=4,function(){var e=t(u.mark((function e(t,n){var r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fs(i=n.code)||i===na.ABORTED){e.next=7;break}return r=t.jr.shift(),nl(t).dr(),e.next=5,Uc(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,jc(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(n,r);case 4:zc(n)&&Hc(n);case 5:case"end":return e.stop()}}),e)}))),Jc.apply(this,arguments)}function Zc(e,t){return el.apply(this,arguments)}function el(){return el=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=ta(t),!n){e.next=7;break}return r.Wr.delete(2),e.next=5,mc(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.Wr.add(2),e.next=12,bc(r);case 12:r.Hr.set("Unknown");case 13:case"end":return e.stop()}}),e)}))),el.apply(this,arguments)}function tl(e){return e.Yr||(e.Yr=function(e,t,n){var r=ta(e);return r.$r(),new dc(t,r.sr,r.credentials,r.N,n)
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}(e.datastore,e.asyncQueue,{Si:Cc.bind(null,e),Ci:Rc.bind(null,e),Rr:Lc.bind(null,e)}),e.Gr.push(function(){var n=t(u.mark((function t(n){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.Yr.dr(),Sc(e)?Tc(e):e.Hr.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.Yr.stop();case 6:Nc(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}())),e.Yr}function nl(e){return e.Xr||(e.Xr=function(e,t,n){var r=ta(e);return r.$r(),new vc(t,r.sr,r.credentials,r.N,n)}(e.datastore,e.asyncQueue,{Si:Kc.bind(null,e),Ci:$c.bind(null,e),Cr:Wc.bind(null,e),Dr:Xc.bind(null,e)}),e.Gr.push(function(){var n=t(u.mark((function t(n){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Xr.dr(),t.next=4,jc(e);case 4:t.next=9;break;case 6:return t.next=8,e.Xr.stop();case 8:e.jr.length>0&&(Xi("RemoteStore","Stopping write stream with ".concat(e.jr.length," pending writes")),e.jr=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}())),e.Xr
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */}var rl=function(){function e(t,r,i,a,o){n(this,e),this.asyncQueue=t,this.timerId=r,this.targetTimeMs=i,this.op=a,this.removalCallback=o,this.deferred=new ia,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return d(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ra(na.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var o=new e(t,n,Date.now()+r,i,a);return o.start(r),o}}]),e}();function il(e,t){if(Yi("AsyncQueue","".concat(t,": ").concat(e)),mu(e))return new ra(na.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var al=function(){function e(t){n(this,e),this.comparator=t?function(e,n){return t(e,n)||Ma.comparator(e.key,n.key)}:function(e,t){return Ma.comparator(e.key,t.key)},this.keyedMap=ws(),this.sortedSet=new ds(this.comparator)}return d(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),ol=function(){function e(){n(this,e),this.Zr=new ds(Ma.comparator)}return d(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.Zr.get(t);n?0!==e.type&&3===n.type?this.Zr=this.Zr.insert(t,e):3===e.type&&1!==n.type?this.Zr=this.Zr.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Zr=this.Zr.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Zr=this.Zr.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Zr=this.Zr.remove(t):1===e.type&&2===n.type?this.Zr=this.Zr.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Zr=this.Zr.insert(t,{type:2,doc:e.doc}):Zi():this.Zr=this.Zr.insert(t,e)}},{key:"eo",value:function(){var e=[];return this.Zr.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),sl=function(){function e(t,r,i,a,o,s,u,c){n(this,e),this.query=t,this.docs=r,this.oldDocs=i,this.docChanges=a,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=u,this.excludesMetadataChanges=c}return d(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,al.emptySet(n),a,r,i,!0,!1)}}]),e}(),ul=function e(){n(this,e),this.no=void 0,this.listeners=[]},cl=function e(){n(this,e),this.queries=new Cu((function(e){return To(e)}),xo),this.onlineState="Unknown",this.so=new Set};
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ll(e,t){return fl.apply(this,arguments)}function fl(){return fl=t(u.mark((function e(t,n){var r,i,a,o,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=ta(t),i=n.query,a=!1,(o=r.queries.get(i))||(a=!0,o=new ul),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:o.no=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),s=il(e.t0,"Initialization of query '".concat(So(n.query),"' failed")),e.abrupt("return",void n.onError(s));case 13:r.queries.set(i,o),o.listeners.push(n),n.io(r.onlineState),o.no&&n.ro(o.no)&&yl(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),fl.apply(this,arguments)}function hl(e,t){return dl.apply(this,arguments)}function dl(){return dl=t(u.mark((function e(t,n){var r,i,a,o,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=ta(t),i=n.query,a=!1,(o=r.queries.get(i))&&(s=o.listeners.indexOf(n))>=0&&(o.listeners.splice(s,1),a=0===o.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)}))),dl.apply(this,arguments)}function vl(e,t){var n,r=ta(e),i=!1,a=Bi(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.query,u=r.queries.get(s);if(u){var c,l=Bi(u.listeners);try{for(l.s();!(c=l.n()).done;){c.value.ro(o)&&(i=!0)}}catch(e){l.e(e)}finally{l.f()}u.no=o}}}catch(e){a.e(e)}finally{a.f()}i&&yl(r)}function pl(e,t,n){var r=ta(e),i=r.queries.get(t);if(i){var a,o=Bi(i.listeners);try{for(o.s();!(a=o.n()).done;){a.value.onError(n)}}catch(e){o.e(e)}finally{o.f()}}r.queries.delete(t)}function yl(e){e.so.forEach((function(e){e.next()}))}var gl=function(){function e(t,r,i){n(this,e),this.query=t,this.oo=r,this.co=!1,this.ao=null,this.onlineState="Unknown",this.options=i||{}}return d(e,[{key:"ro",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=Bi(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}e=new sl(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.co?this.uo(e)&&(this.oo.next(e),a=!0):this.ho(e,this.onlineState)&&(this.lo(e),a=!0),this.ao=e,a}},{key:"onError",value:function(e){this.oo.error(e)}},{key:"io",value:function(e){this.onlineState=e;var t=!1;return this.ao&&!this.co&&this.ho(this.ao,e)&&(this.lo(this.ao),t=!0),t}},{key:"ho",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return!(this.options.fo&&n||e.docs.isEmpty()&&"Offline"!==t)}},{key:"uo",value:function(e){if(e.docChanges.length>0)return!0;var t=this.ao&&this.ao.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"lo",value:function(e){e=sl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.oo.next(e)}}]),e}(),ml=function e(t){n(this,e),this.key=t},kl=function e(t){n(this,e),this.key=t},bl=function(){function e(t,r){n(this,e),this.query=t,this.po=r,this.To=null,this.current=!1,this.Eo=Is(),this.mutatedKeys=Is(),this.Io=No(t),this.Ao=new al(this.Io)}return d(e,[{key:"Ro",get:function(){return this.po}},{key:"bo",value:function(e,t){var n=this,r=t?t.Po:new ol,i=t?t.Ao:this.Ao,a=t?t.mutatedKeys:this.mutatedKeys,o=i,s=!1,u=wo(this.query)&&i.size===this.query.limit?i.last():null,c=Eo(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),f=Ao(n.query,t)?t:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),v=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),v=!0):n.vo(l,f)||(r.track({type:2,doc:f}),v=!0,(u&&n.Io(f,u)>0||c&&n.Io(f,c)<0)&&(s=!0)):!l&&f?(r.track({type:0,doc:f}),v=!0):l&&!f&&(r.track({type:1,doc:l}),v=!0,(u||c)&&(s=!0)),v&&(f?(o=o.add(f),a=d?a.add(e):a.delete(e)):(o=o.delete(e),a=a.delete(e)))})),wo(this.query)||Eo(this.query))for(;o.size>this.query.limit;){var l=wo(this.query)?o.last():o.first();o=o.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Ao:o,Po:r,Ln:s,mutatedKeys:a}}},{key:"vo",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Ao;this.Ao=e.Ao,this.mutatedKeys=e.mutatedKeys;var a=e.Po.eo();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Zi()}};return n(e)-n(t)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e.type,t.type)||r.Io(e.doc,t.doc)})),this.Vo(n);var o=t?this.So():[],s=0===this.Eo.size&&this.current?1:0,u=s!==this.To;return this.To=s,0!==a.length||u?{snapshot:new sl(this.query,e.Ao,i,a,e.mutatedKeys,0===s,u,!1),Do:o}:{Do:o}}},{key:"io",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ao:this.Ao,Po:new ol,mutatedKeys:this.mutatedKeys,Ln:!1},!1)):{Do:[]}}},{key:"Co",value:function(e){return!this.po.has(e)&&!!this.Ao.has(e)&&!this.Ao.get(e).hasLocalMutations}},{key:"Vo",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.po=t.po.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.po=t.po.delete(e)})),this.current=e.current)}},{key:"So",value:function(){var e=this;if(!this.current)return[];var t=this.Eo;this.Eo=Is(),this.Ao.forEach((function(t){e.Co(t.key)&&(e.Eo=e.Eo.add(t.key))}));var n=[];return t.forEach((function(t){e.Eo.has(t)||n.push(new kl(t))})),this.Eo.forEach((function(e){t.has(e)||n.push(new ml(e))})),n}},{key:"No",value:function(e){this.po=e.Gn,this.Eo=Is();var t=this.bo(e.documents);return this.applyChanges(t,!0)}},{key:"xo",value:function(){return sl.fromInitialDocuments(this.query,this.Ao,this.mutatedKeys,0===this.To)}}]),e}(),wl=function e(t,r,i){n(this,e),this.query=t,this.targetId=r,this.view=i},El=function e(t){n(this,e),this.key=t,this.ko=!1},_l=function(){function e(t,r,i,a,o,s){n(this,e),this.localStore=t,this.remoteStore=r,this.eventManager=i,this.sharedClientState=a,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.$o={},this.Oo=new Cu((function(e){return To(e)}),xo),this.Fo=new Map,this.Mo=new Set,this.Lo=new ds(Ma.comparator),this.Bo=new Map,this.Uo=new Wu,this.qo={},this.Ko=new Map,this.jo=Su.ie(),this.onlineState="Unknown",this.Qo=void 0}return d(e,[{key:"isPrimaryClient",get:function(){return!0===this.Qo}}]),e}();
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(e,t){return xl.apply(this,arguments)}function xl(){return xl=t(u.mark((function e(t,n){var r,i,a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Zl(t),!(o=r.Oo.get(n))){e.next=6;break}i=o.targetId,r.sharedClientState.addLocalQueryTarget(i),a=o.view.xo(),e.next=15;break;case 6:return e.next=8,qu(r.localStore,Io(n));case 8:return s=e.sent,c=r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.targetId,e.next=13,Tl(r,n,i,"current"===c);case 13:a=e.sent,r.isPrimaryClient&&Ec(r.remoteStore,s);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)}))),xl.apply(this,arguments)}function Tl(e,t,n,r){return Sl.apply(this,arguments)}function Sl(){return Sl=t(u.mark((function e(n,r,i,a){var o,s,c,l,f,h;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.Wo=function(e,r,i){return(a=t(u.mark((function e(t,n,r,i){var a,o,s;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.bo(r),e.t0=a.Ln,!e.t0){e.next=6;break}return e.next=5,Ku(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.bo(t,a)}));case 5:a=e.sent;case 6:return o=i&&i.targetChanges.get(n.targetId),s=n.view.applyChanges(a,t.isPrimaryClient,o),e.abrupt("return",(Kl(t,n.targetId,s.Do),s.snapshot));case 8:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return a.apply(this,arguments)})(n,e,r,i);var a},e.next=3,Ku(n.localStore,r,!0);case 3:return o=e.sent,s=new bl(r,o.Gn),c=s.bo(o.documents),l=As.createSynthesizedTargetChangeForCurrentChange(i,a&&"Offline"!==n.onlineState),f=s.applyChanges(c,n.isPrimaryClient,l),Kl(n,i,f.Do),h=new wl(r,i,s),e.abrupt("return",(n.Oo.set(r,h),n.Fo.has(i)?n.Fo.get(i).push(r):n.Fo.set(i,[r]),f.snapshot));case 11:case"end":return e.stop()}}),e)}))),Sl.apply(this,arguments)}function Al(e,t){return Nl.apply(this,arguments)}function Nl(){return Nl=t(u.mark((function e(t,n){var r,i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=ta(t),i=r.Oo.get(n),!((a=r.Fo.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.Fo.set(i.targetId,a.filter((function(e){return!xo(e,n)}))),void r.Oo.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,zu(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),_c(r.remoteStore,i.targetId),zl(r,i.targetId)})).catch(Au);case 9:e.next=14;break;case 11:return zl(r,i.targetId),e.next=14,zu(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)}))),Nl.apply(this,arguments)}function Cl(e,t,n){return Dl.apply(this,arguments)}function Dl(){return Dl=t(u.mark((function e(t,n,r){var i,a,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=ef(t),e.prev=1,e.next=4,function(e,t){var n,r=ta(e),i=pa.now(),a=t.reduce((function(e,t){return e.add(t.key)}),Is());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(e){return r.Qn.Pn(e,a).next((function(a){n=a;var o,s=[],u=Bi(t);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=Jo(c,n.get(c.key));null!=l&&s.push(new ns(c.key,l,Ya(l.value.mapValue),Wo.exists(!0)))}}catch(e){u.e(e)}finally{u.f()}return r.In.addMutationBatch(e,i,s,t)}))})).then((function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.qo[e.currentUser.toKey()];r||(r=new ds(da)),r=r.insert(t,n),e.qo[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,Ql(i,a.changes);case 9:return e.next=11,jc(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=il(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Dl.apply(this,arguments)}function Rl(e,t){return Ol.apply(this,arguments)}function Ol(){return Ol=t(u.mark((function e(t,n){var r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ta(t),e.prev=1,e.next=4,Vu(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Bo.get(t);n&&(ea(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.ko=!0:e.modifiedDocuments.size>0?ea(n.ko):e.removedDocuments.size>0&&(ea(n.ko),n.ko=!1))})),e.next=8,Ql(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Au(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),Ol.apply(this,arguments)}function Ll(e,t,n){var r=ta(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Oo.forEach((function(e,n){var r=n.view.io(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=ta(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=Bi(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.io(t)&&(r=!0)}}catch(e){a.e(e)}finally{a.f()}})),r&&yl(n)}(r.eventManager,t),i.length&&r.$o.Rr(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Ml(e,t,n){return Fl.apply(this,arguments)}function Fl(){return Fl=t(u.mark((function e(t,n,r){var i,a,o,s,c,l;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=ta(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Bo.get(n),!(o=a&&a.key)){e.next=14;break}return s=(s=new ds(Ma.comparator)).insert(o,$a.newNoDocument(o,ya.min())),c=Is().add(o),l=new Ss(ya.min(),new Map,new ys(da),s,c),e.next=9,Rl(i,l);case 9:i.Lo=i.Lo.remove(o),i.Bo.delete(n),Wl(i),e.next=16;break;case 14:return e.next=16,zu(i.localStore,n,!1).then((function(){return zl(i,n,r)})).catch(Au);case 16:case"end":return e.stop()}}),e)}))),Fl.apply(this,arguments)}function Pl(e,t){return Ul.apply(this,arguments)}function Ul(){return Ul=t(u.mark((function e(t,n){var r,i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ta(t),i=n.batch.batchId,e.prev=1,e.next=4,Uu(r.localStore,n);case 4:return a=e.sent,ql(r,i,null),Bl(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,Ql(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Au(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Ul.apply(this,arguments)}function jl(e,t,n){return Vl.apply(this,arguments)}function Vl(){return Vl=t(u.mark((function e(t,n,r){var i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=ta(t),e.prev=1,e.next=4,function(e,t){var n=ta(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.In.lookupMutationBatch(e,t).next((function(t){return ea(null!==t),r=t.keys(),n.In.removeMutationBatch(e,t)})).next((function(){return n.In.performConsistencyCheck(e)})).next((function(){return n.Qn.Pn(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,ql(i,n,r),Bl(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Ql(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Au(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Vl.apply(this,arguments)}function Bl(e,t){(e.Ko.get(t)||[]).forEach((function(e){e.resolve()})),e.Ko.delete(t)}function ql(e,t,n){var r=ta(e),i=r.qo[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.qo[r.currentUser.toKey()]=i}}function zl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=Bi(e.Fo.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.Oo.delete(a),n&&e.$o.Go(a,n)}}catch(e){i.e(e)}finally{i.f()}e.Fo.delete(t),e.isPrimaryClient&&e.Uo.cs(t).forEach((function(t){e.Uo.containsKey(t)||Hl(e,t)}))}function Hl(e,t){e.Mo.delete(t.path.canonicalString());var n=e.Lo.get(t);null!==n&&(_c(e.remoteStore,n),e.Lo=e.Lo.remove(t),e.Bo.delete(n),Wl(e))}function Kl(e,t,n){var r,i=Bi(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof ml?(e.Uo.addReference(a.key,t),Gl(e,a)):a instanceof kl?(Xi("SyncEngine","Document no longer in limbo: "+a.key),e.Uo.removeReference(a.key,t),e.Uo.containsKey(a.key)||Hl(e,a.key)):Zi()}}catch(e){i.e(e)}finally{i.f()}}function Gl(e,t){var n=t.key,r=n.path.canonicalString();e.Lo.get(n)||e.Mo.has(r)||(Xi("SyncEngine","New document in limbo: "+n),e.Mo.add(r),Wl(e))}function Wl(e){for(;e.Mo.size>0&&e.Lo.size<e.maxConcurrentLimboResolutions;){var t=e.Mo.values().next().value;e.Mo.delete(t);var n=new Ma(wa.fromString(t)),r=e.jo.next();e.Bo.set(r,new El(n)),e.Lo=e.Lo.insert(n,r),Ec(e.remoteStore,new wu(Io(bo(n.path)),r,2,la.T))}}function Ql(e,t,n){return Xl.apply(this,arguments)}function Xl(){return Xl=t(u.mark((function e(n,r,i){var a,o,s,c;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=ta(n),o=[],s=[],c=[],e.t0=a.Oo.isEmpty(),e.t0){e.next=9;break}return a.Oo.forEach((function(e,t){c.push(a.Wo(t,r,i).then((function(e){if(e){a.isPrimaryClient&&a.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),o.push(e);var n=Ou.kn(t.targetId,e);s.push(n)}})))})),e.next=6,Promise.all(c);case 6:return a.$o.Rr(o),e.next=9,function(){var e=t(u.mark((function e(t,n){var r,i,a,o,s,c,l,f;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=ta(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return gu.forEach(n,(function(t){return gu.forEach(t.Nn,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return gu.forEach(t.xn,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),mu(e.t0)){e.next=10;break}throw e.t0;case 10:Xi("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=Bi(n);try{for(i.s();!(a=i.n()).done;)o=a.value,s=o.targetId,o.fromCache||(c=r.Un.get(s),l=c.snapshotVersion,f=c.withLastLimboFreeSnapshotVersion(l),r.Un=r.Un.insert(s,f))}catch(e){i.e(e)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(a.localStore,s);case 9:case"end":return e.stop()}}),e)}))),Xl.apply(this,arguments)}function Yl(e,t){return $l.apply(this,arguments)}function $l(){return $l=t(u.mark((function e(t,n){var r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=ta(t)).currentUser.isEqual(n)){e.next=11;break}return Xi("SyncEngine","User change. New user:",n.toKey()),e.next=5,Fu(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.Ko.forEach((function(e){e.forEach((function(e){e.reject(new ra(na.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ko.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,Ql(r,i.Wn);case 11:case"end":return e.stop()}}),e)}))),$l.apply(this,arguments)}function Jl(e,t){var n=ta(e),r=n.Bo.get(t);if(r&&r.ko)return Is().add(r.key);var i=Is(),a=n.Fo.get(t);if(!a)return i;var o,s=Bi(a);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=n.Oo.get(u);i=i.unionWith(c.view.Ro)}}catch(e){s.e(e)}finally{s.f()}return i}function Zl(e){var t=ta(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Rl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Jl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Ml.bind(null,t),t.$o.Rr=vl.bind(null,t.eventManager),t.$o.Go=pl.bind(null,t.eventManager),t}function ef(e){var t=ta(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Pl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jl.bind(null,t),t}var tf=function(){function e(){n(this,e),this.synchronizeTabs=!1}var r,i;return d(e,[{key:"initialize",value:(i=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.N=lc(t.databaseInfo.databaseId),this.sharedClientState=this.Ho(t),this.persistence=this.Jo(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.Yo(t),this.localStore=this.Xo(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"Yo",value:function(e){return null}},{key:"Xo",value:function(e){return function(e,t,n,r){return new Mu(e,t,n,r)}(this.persistence,new Lu,e.initialUser,this.N)}},{key:"Jo",value:function(e){return new Zu(tc.Ns,this.N)}},{key:"Ho",value:function(e){return new rc}},{key:"terminate",value:(r=t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),e}(),nf=function(){function e(){n(this,e)}var r;return d(e,[{key:"initialize",value:(r=t(u.mark((function e(t,n){var r=this;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Ll(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Yl.bind(null,this.syncEngine),e.next=12,Zc(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"createEventManager",value:function(e){return new cl}},{key:"createDatastore",value:function(e){var t,n=lc(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new uc(t));return function(e,t,n){return new pc(e,t,n)}(e.credentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return Ll(o.syncEngine,e,0)},a=ac.bt()?new ac:new ic,new gc(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,o){var s=new _l(e,t,n,r,i,a);return o&&(s.Qo=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return(e=t(u.mark((function e(t){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=ta(t),Xi("RemoteStore","RemoteStore shutting down."),n.Wr.add(5),e.next=5,bc(n);case 5:n.zr.shutdown(),n.Hr.set("Unknown");case 7:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}(),rf=function(){function e(t){n(this,e),this.observer=t,this.muted=!1}return d(e,[{key:"next",value:function(e){this.observer.next&&this.tc(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.tc(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"ec",value:function(){this.muted=!0}},{key:"tc",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),af=function(){function e(r,i,a){var o=this;n(this,e),this.credentials=r,this.asyncQueue=i,this.databaseInfo=a,this.user=Ki.UNAUTHENTICATED,this.clientId=ha.I(),this.credentialListener=function(){return Promise.resolve()},this.credentials.start(i,function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xi("FirestoreClient","Received user=",t.uid),e.next=3,o.credentialListener(t);case 3:o.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}var r;return d(e,[{key:"getConfiguration",value:(r=t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setCredentialChangeListener",value:function(e){this.credentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new ra(na.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var n=new ia;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(t(u.mark((function t(){var r;return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,t.t0=e.onlineComponents,!t.t0){t.next=5;break}return t.next=5,e.onlineComponents.terminate();case 5:if(t.t1=e.offlineComponents,!t.t1){t.next=9;break}return t.next=9,e.offlineComponents.terminate();case 9:e.credentials.shutdown(),n.resolve(),t.next=17;break;case 13:t.prev=13,t.t2=t.catch(0),r=il(t.t2,"Failed to shutdown persistence"),n.reject(r);case 17:case"end":return t.stop()}}),t,null,[[0,13]])})))),n.promise}}]),e}();function of(e,t){return sf.apply(this,arguments)}function sf(){return sf=t(u.mark((function e(n,r){var i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.asyncQueue.verifyOperationInProgress(),Xi("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,n.getConfiguration();case 3:return i=e.sent,e.next=6,r.initialize(i);case 6:a=i.initialUser,n.setCredentialChangeListener(function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a.isEqual(t),e.t0){e.next=5;break}return e.next=4,Fu(r.localStore,t);case 4:a=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.persistence.setDatabaseDeletedListener((function(){return n.terminate()})),n.offlineComponents=r;case 8:case"end":return e.stop()}}),e)}))),sf.apply(this,arguments)}function uf(e,t){return cf.apply(this,arguments)}function cf(){return cf=t(u.mark((function e(n,r){var i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.asyncQueue.verifyOperationInProgress(),e.next=3,lf(n);case 3:return i=e.sent,Xi("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,n.getConfiguration();case 7:return a=e.sent,e.next=10,r.initialize(i,a);case 10:n.setCredentialChangeListener((function(e){return(n=t(u.mark((function e(t,n){var r,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=ta(t)).asyncQueue.verifyOperationInProgress(),Xi("RemoteStore","RemoteStore received new credentials"),i=Ac(r),r.Wr.add(3),e.next=6,bc(r);case 6:return i&&r.Hr.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.Wr.delete(3),e.next=12,mc(r);case 12:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})(r.remoteStore,e);var n})),n.onlineComponents=r;case 12:case"end":return e.stop()}}),e)}))),cf.apply(this,arguments)}function lf(e){return ff.apply(this,arguments)}function ff(){return ff=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return Xi("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,of(t,new tf);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)}))),ff.apply(this,arguments)}function hf(e){return df.apply(this,arguments)}function df(){return df=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return Xi("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,uf(t,new nf);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)}))),df.apply(this,arguments)}function vf(e){return hf(e).then((function(e){return e.syncEngine}))}function pf(e){return yf.apply(this,arguments)}function yf(){return yf=t(u.mark((function e(t){var n,r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hf(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=Il.bind(null,n.syncEngine),r.onUnlisten=Al.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)}))),yf.apply(this,arguments)}var gf=function e(t,r,i,a,o,s,u,c){n(this,e),this.databaseId=t,this.appId=r,this.persistenceKey=i,this.host=a,this.ssl=o,this.forceLongPolling=s,this.autoDetectLongPolling=u,this.useFetchStreams=c},mf=function(){function e(t,r){n(this,e),this.projectId=t,this.database=r||"(default)"}return d(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}]),e}(),kf=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function bf(e,t,n){if(!n)throw new ra(na.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function wf(e){if(!Ma.isDocumentKey(e))throw new ra(na.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Ef(e){if(Ma.isDocumentKey(e))throw new ra(na.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function _f(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==o(e)){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Zi()}function If(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new ra(na.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=_f(e);throw new ra(na.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}var xf=function(){function e(t){var r;if(n(this,e),void 0===t.host){if(void 0!==t.ssl)throw new ra(na.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(r=t.ssl)||void 0===r||r;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ra(na.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(e,t,n,r){if(!0===t&&!0===r)throw new ra(na.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return d(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),Tf=function(){function e(t,r){n(this,e),this._credentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xf({}),this._settingsFrozen=!1,t instanceof mf?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ra(na.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mf(e.options.projectId)}(t))}return d(e,[{key:"app",get:function(){if(!this._app)throw new ra(na.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new ra(na.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xf(e),void 0!==e.credentials&&(this._credentials=function(e){if(!e)return new oa;switch(e.type){case"gapi":var t=e.client;return ea(!("object"!=o(t)||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new ca(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new ra(na.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=kf.get(e);t&&(Xi("ComponentProvider","Removing Datastore"),kf.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}(),Sf=function(){function e(t,r,i){n(this,e),this.converter=r,this._key=i,this.type="document",this.firestore=t}return d(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Nf(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Af=function(){function e(t,r,i){n(this,e),this.converter=r,this._query=i,this.type="query",this.firestore=t}return d(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Nf=function(e){E(r,Af);var t=zi(r);function r(e,i,a){var o;return n(this,r),(o=t.call(this,e,i,bo(a)))._path=a,o.type="collection",o}return d(r,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Sf(this.firestore,null,new Ma(e))}},{key:"withConverter",value:function(e){return new r(this.firestore,e,this._path)}}]),r}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cf(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=W(e),1===arguments.length&&(t=ha.I()),bf("doc","path",t),e instanceof Tf){var a=wa.fromString.apply(wa,[t].concat(r));return wf(a),new Sf(e,null,new Ma(a))}if(!(e instanceof Sf||e instanceof Nf))throw new ra(na.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(wa.fromString.apply(wa,[t].concat(r)));return wf(o),new Sf(e.firestore,e instanceof Nf?e.converter:null,new Ma(o))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Df=function(){function e(){var t=this;n(this,e),this._c=Promise.resolve(),this.mc=[],this.gc=!1,this.yc=[],this.Tc=null,this.Ec=!1,this.Ic=!1,this.Ac=[],this.ar=new fc(this,"async_queue_retry"),this.Rc=function(){var e=cc();e&&Xi("AsyncQueue","Visibility state changed to "+e.visibilityState),t.ar.tr()};var r=cc();r&&"function"==typeof r.addEventListener&&r.addEventListener("visibilitychange",this.Rc)}var r,i;return d(e,[{key:"isShuttingDown",get:function(){return this.gc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.bc(),this.Pc(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.gc){this.gc=!0,this.Ic=e||!1;var t=cc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Rc)}}},{key:"enqueue",value:function(e){var t=this;if(this.bc(),this.gc)return new Promise((function(){}));var n=new ia;return this.Pc((function(){return t.gc&&t.Ic?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.mc.push(e),t.vc()}))}},{key:"vc",value:(i=t(u.mark((function e(){var t=this;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.mc.length){e.next=14;break}return e.prev=1,e.next=4,this.mc[0]();case 4:this.mc.shift(),this.ar.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),mu(e.t0)){e.next=12;break}throw e.t0;case 12:Xi("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.mc.length>0&&this.ar.Xi((function(){return t.vc()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return i.apply(this,arguments)})},{key:"Pc",value:function(e){var t=this,n=this._c.then((function(){return t.Ec=!0,e().catch((function(e){t.Tc=e,t.Ec=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */(e);throw Yi("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Ec=!1,e}))}));return this._c=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.bc(),this.Ac.indexOf(e)>-1&&(t=0);var i=rl.createAndSchedule(this,e,t,n,(function(e){return r.Vc(e)}));return this.yc.push(i),i}},{key:"bc",value:function(){this.Tc&&Zi()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Sc",value:(r=t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._c,e.next=3,t;case 3:if(t!==this._c){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"Dc",value:function(e){var t,n=Bi(this.yc);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"Cc",value:function(e){var t=this;return this.Sc().then((function(){t.yc.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=Bi(t.yc);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(e){r.e(e)}finally{r.f()}return t.Sc()}))}},{key:"Nc",value:function(e){this.Ac.push(e)}},{key:"Vc",value:function(e){var t=this.yc.indexOf(e);this.yc.splice(t,1)}}]),e}(),Rf=function(e){E(r,Tf);var t=zi(r);function r(e,i){var a;return n(this,r),(a=t.call(this,e,i)).type="firestore",a._queue=new Df,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return d(r,[{key:"_terminate",value:function(){return this._firestoreClient||Lf(this),this._firestoreClient.terminate()}}]),r}();function Of(e){return e._firestoreClient||Lf(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Lf(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new gf(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new af(e._credentials,e._queue,r)}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Mf=function(){function e(){n(this,e);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0;a<r.length;++a)if(0===r[a].length)throw new ra(na.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _a(r)}return d(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}(),Ff=function(){function e(t){n(this,e),this._byteString=t}return d(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(xa.fromBase64String(t))}catch(t){throw new ra(na.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(xa.fromUint8Array(t))}}]),e}(),Pf=function e(t){n(this,e),this._methodName=t},Uf=function(){function e(t,r){if(n(this,e),!isFinite(t)||t<-90||t>90)throw new ra(na.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(r)||r<-180||r>180)throw new ra(na.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+r);this._lat=t,this._long=r}return d(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return da(this._lat,e._lat)||da(this._long,e._long)}}]),e}(),jf=/^__.*__$/,Vf=function(){function e(t,r,i){n(this,e),this.data=t,this.fieldMask=r,this.fieldTransforms=i}return d(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new ns(e,this.data,this.fieldMask,t,this.fieldTransforms):new ts(e,this.data,t,this.fieldTransforms)}}]),e}(),Bf=function(){function e(t,r,i){n(this,e),this.data=t,this.fieldMask=r,this.fieldTransforms=i}return d(e,[{key:"toMutation",value:function(e,t){return new ns(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qf(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Zi()}}var zf=function(){function e(t,r,i,a,o,s){n(this,e),this.settings=t,this.databaseId=r,this.N=i,this.ignoreUndefinedProperties=a,void 0===o&&this.xc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}return d(e,[{key:"path",get:function(){return this.settings.path}},{key:"kc",get:function(){return this.settings.kc}},{key:"$c",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.N,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Oc",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$c({path:n,Fc:!1});return r.Mc(e),r}},{key:"Lc",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$c({path:n,Fc:!1});return r.xc(),r}},{key:"Bc",value:function(e){return this.$c({path:void 0,Fc:!0})}},{key:"Uc",value:function(e){return rh(e,this.settings.methodName,this.settings.qc||!1,this.path,this.settings.Kc)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"xc",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Mc(this.path.get(e))}},{key:"Mc",value:function(e){if(0===e.length)throw this.Uc("Document fields must not be empty");if(qf(this.kc)&&jf.test(e))throw this.Uc('Document fields cannot begin and end with "__"')}}]),e}(),Hf=function(){function e(t,r,i){n(this,e),this.databaseId=t,this.ignoreUndefinedProperties=r,this.N=i||lc(t)}return d(e,[{key:"jc",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new zf({kc:e,methodName:t,Kc:n,path:_a.emptyPath(),Fc:!1,qc:r},this.databaseId,this.N,this.ignoreUndefinedProperties)}}]),e}();function Kf(e){var t=e._freezeSettings(),n=lc(e._databaseId);return new Hf(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Gf(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.jc(a.merge||a.mergeFields?2:0,t,n,i);Zf("Data must be an object, but it was:",o,r);var s,u,c=$f(r,o);if(a.merge)s=new Ia(o.fieldMask),u=o.fieldTransforms;else if(a.mergeFields){var l,f=[],h=Bi(a.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=l.value,v=eh(t,d,n);if(!o.contains(v))throw new ra(na.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));ih(f,v)||f.push(v)}}catch(e){h.e(e)}finally{h.f()}s=new Ia(f),u=o.fieldTransforms.filter((function(e){return s.covers(e.field)}))}else s=null,u=o.fieldTransforms;return new Vf(new Xa(c),s,u)}var Wf=function(e){E(r,Pf);var t=zi(r);function r(){return n(this,r),t.apply(this,arguments)}return d(r,[{key:"_toFieldTransform",value:function(e){if(2!==e.kc)throw 1===e.kc?e.Uc("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Uc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof r}}]),r}();function Qf(e,t,n,r){var i=e.jc(1,t,n);Zf("Data must be an object, but it was:",i,r);var a=[],o=Xa.empty();ma(r,(function(e,r){var s=nh(t,e,n);r=W(r);var u=i.Lc(s);if(r instanceof Wf)a.push(s);else{var c=Yf(r,u);null!=c&&(a.push(s),o.set(s,c))}}));var s=new Ia(a);return new Bf(o,s,i.fieldTransforms)}function Xf(e,t,n,r,i,a){var o=e.jc(1,t,n),s=[eh(t,r,n)],u=[i];if(a.length%2!=0)throw new ra(na.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)s.push(eh(t,a[c])),u.push(a[c+1]);for(var l=[],f=Xa.empty(),h=s.length-1;h>=0;--h)if(!ih(l,s[h])){var d=s[h],v=u[h];v=W(v);var p=o.Lc(d);if(v instanceof Wf)l.push(d);else{var y=Yf(v,p);null!=y&&(l.push(d),f.set(d,y))}}var g=new Ia(l);return new Bf(f,g,o.fieldTransforms)}function Yf(e,t){if(Jf(e=W(e)))return Zf("Unsupported field value:",t,e),$f(e,t);if(e instanceof Pf)return function(e,t){if(!qf(t.kc))throw t.Uc("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Uc("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&4!==t.kc)throw t.Uc("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=Bi(e);try{for(a.s();!(n=a.n()).done;){var o=Yf(n.value,t.Bc(i));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),i++}}catch(e){a.e(e)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=W(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Oo(t.N,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=pa.fromDate(e);return{timestampValue:js(t.N,n)}}if(e instanceof pa){var r=new pa(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:js(t.N,r)}}if(e instanceof Uf)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ff)return{bytesValue:Vs(t.N,e._byteString)};if(e instanceof Sf){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Uc("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:zs(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Uc("Unsupported field value: ".concat(_f(e)))}(e,t)}function $f(e,t){var n={};return ka(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ma(e,(function(e,r){var i=Yf(r,t.Oc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Jf(e){return!("object"!=o(e)||null===e||e instanceof Array||e instanceof Date||e instanceof pa||e instanceof Uf||e instanceof Ff||e instanceof Sf||e instanceof Pf)}function Zf(e,t,n){if(!Jf(n)||!function(e){return"object"==o(e)&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=_f(n);throw"an object"===r?t.Uc(e+" a custom object"):t.Uc(e+" "+r)}}function eh(e,t,n){if((t=W(t))instanceof Mf)return t._internalPath;if("string"==typeof t)return nh(e,t);throw rh("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var th=new RegExp("[~\\*/\\[\\]]");function nh(e,t,n){if(t.search(th)>=0)throw rh("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return F(Mf,f(t.split(".")))._internalPath}catch(r){throw rh("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function rh(e,t,n,r,i){var a=r&&!r.isEmpty(),o=void 0!==i,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var u="";return(a||o)&&(u+=" (found",a&&(u+=" in field ".concat(r)),o&&(u+=" in document ".concat(i)),u+=")"),new ra(na.INVALID_ARGUMENT,s+e+u)}function ih(e,t){return e.some((function(e){return e.isEqual(t)}))}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ah=function(){function e(t,r,i,a,o){n(this,e),this._firestore=t,this._userDataWriter=r,this._key=i,this._document=a,this._converter=o}return d(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new Sf(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new oh(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(sh("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),oh=function(e){E(r,ah);var t=zi(r);function r(){return n(this,r),t.apply(this,arguments)}return d(r,[{key:"data",value:function(){return xe(I(r.prototype),"data",this).call(this)}}]),r}();function sh(e,t){return"string"==typeof t?nh(e,t):t instanceof Mf?t._internalPath:t._delegate._internalPath}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var uh=function(){function e(t,r){n(this,e),this.hasPendingWrites=t,this.fromCache=r}return d(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),ch=function(e){E(r,ah);var t=zi(r);function r(e,i,a,o,s,u){var c;return n(this,r),(c=t.call(this,e,i,a,o,u))._firestore=e,c._firestoreImpl=e,c.metadata=s,c}return d(r,[{key:"exists",value:function(){return xe(I(r.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new lh(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(sh("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),r}(),lh=function(e){E(r,ch);var t=zi(r);function r(){return n(this,r),t.apply(this,arguments)}return d(r,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return xe(I(r.prototype),"data",this).call(this,e)}}]),r}(),fh=function(){function e(t,r,i,a){n(this,e),this._firestore=t,this._userDataWriter=r,this._snapshot=a,this.metadata=new uh(a.hasPendingWrites,a.fromCache),this.query=i}return d(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new lh(n._firestore,n._userDataWriter,r.key,r,new uh(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ra(na.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new lh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new lh(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uh(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:hh(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function hh(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Zi()}}
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var dh=function(){function e(){n(this,e)}return d(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Fa(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Aa(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Na(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Zi()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return ma(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new Uf(Aa(e.latitude),Aa(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=Da(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Ra(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=Sa(e);return new pa(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=wa.fromString(e);ea(lu(n));var r=new mf(n.get(1),n.get(3)),i=new Ma(n.popFirst(5));return r.isEqual(t)||Yi("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function vh(e){e=If(e,Sf);var n=If(e.firestore,Rf);return function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=new ia;return e.asyncQueue.enqueueAndForget(t(u.mark((function t(){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t,n,r,i){var a=new rf({next:function(a){t.enqueueAndForget((function(){return hl(e,o)}));var s=a.docs.has(n);!s&&a.fromCache?i.reject(new ra(na.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&a.fromCache&&r&&"server"===r.source?i.reject(new ra(na.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),o=new gl(bo(n.path),a,{includeMetadataChanges:!0,fo:!0});return ll(e,o)},t.next=3,pf(e);case 3:return t.t1=t.sent,t.t2=e.asyncQueue,t.t3=n,t.t4=r,t.t5=i,t.abrupt("return",(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5));case 9:case"end":return t.stop()}}),t)})))),i.promise}(Of(n),e._key).then((function(t){return function(e,t,n){var r=n.docs.get(t._key),i=new ph(e);return new ch(e,i,t._key,r,new uh(n.hasPendingWrites,n.fromCache),t.converter)}(n,e,t)}))}var ph=function(e){E(r,dh);var t=zi(r);function r(e){var i;return n(this,r),(i=t.call(this)).firestore=e,i}return d(r,[{key:"convertBytes",value:function(e){return new Ff(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Sf(this.firestore,null,t)}}]),r}();function yh(e){e=If(e,Af);var n=If(e.firestore,Rf),r=Of(n),i=new ph(n);return function(e){if(Eo(e)&&0===e.explicitOrderBy.length)throw new ra(na.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=new ia;return e.asyncQueue.enqueueAndForget(t(u.mark((function t(){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t,n,r,i){var a=new rf({next:function(n){t.enqueueAndForget((function(){return hl(e,o)})),n.fromCache&&"server"===r.source?i.reject(new ra(na.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),o=new gl(n,a,{includeMetadataChanges:!0,fo:!0});return ll(e,o)},t.next=3,pf(e);case 3:return t.t1=t.sent,t.t2=e.asyncQueue,t.t3=n,t.t4=r,t.t5=i,t.abrupt("return",(0,t.t0)(t.t1,t.t2,t.t3,t.t4,t.t5));case 9:case"end":return t.stop()}}),t)})))),i.promise}(r,e._query).then((function(t){return new fh(n,i,e,t)}))}function gh(e,t,n){e=If(e,Sf);var r=If(e.firestore,Rf),i=function(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}(e.converter,t,n);return kh(r,[Gf(Kf(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Wo.none())])}function mh(e,t,n){e=If(e,Sf);for(var r=If(e.firestore,Rf),i=Kf(r),a=arguments.length,o=new Array(a>3?a-3:0),s=3;s<a;s++)o[s-3]=arguments[s];return kh(r,[("string"==typeof(t=W(t))||t instanceof Mf?Xf(i,"updateDoc",e._key,t,n,o):Qf(i,"updateDoc",e._key,t)).toMutation(e._key,Wo.exists(!0))])}function kh(e,n){return function(e,n){var r=new ia;return e.asyncQueue.enqueueAndForget(t(u.mark((function t(){return u.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Cl,t.next=3,vf(e);case 3:return t.t1=t.sent,t.t2=n,t.t3=r,t.abrupt("return",(0,t.t0)(t.t1,t.t2,t.t3));case 7:case"end":return t.stop()}}),t)})))),r.promise}(Of(e),n)}function bh(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I(e);if(t){var i=I(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _(this,n)}}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];Gi="9.3.0",ge(new Y("firestore",(function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new Rf(i,new sa(e.getProvider("auth-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC")),Ie(Hi,"3.2.1",e),Ie(Hi,"3.2.1","esm2017")}();var wh=function(e){E(a,A);var i=bh(a);function a(e,s,c){var l;if(n(this,a),r(b(l=i.call(this,e,s,c)),"keys",t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.prev=1,e.next=4,yh(l._collection);case 4:return e.sent.forEach((function(e){t.push(e.id)})),e.abrupt("return",t);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",[]);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))),r(b(l),"get",function(){var e=t(u.mark((function e(t){var n,r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Cf(l._firestore,l._name,t),e.next=4,vh(n);case 4:if(!(r=e.sent).exists()){e.next=9;break}return e.abrupt("return",r.data());case 9:return e.abrupt("return",null);case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(0),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()),r(b(l),"set",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,r=Cf(l._firestore,l._name,t),e.next=6,gh(r,n);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()),r(b(l),"update",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!1);case 2:return e.prev=2,r=Cf(l._firestore,l._name,t),e.next=6,mh(r,n);case 6:return e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(2),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}()),r(b(l),"sort",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(l),"search",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.type(),r=n.range,n.fuzzy?x.Fuzzy:x.Literal,f(r),e.abrupt("return",[]);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(b(l),"remove",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(b(l),"clear",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)})))),r(b(l),"destroy",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete l._collection,e.abrupt("return",!0);case 2:case"end":return e.stop()}}),e)})))),!l._isValidConfig(c.config,["apiKey","authDomain","projectId"]))throw new Error("Invalid configuration: ".concat(c.config));return l._firebaseApp=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==o(t)){t={name:t}}var n=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw we.create("bad-app-name",{appName:String(r)});var i=ve.get(r);if(i){if(K(e,i.options)&&K(n,i.config))return i;throw we.create("duplicate-app",{appName:r})}var a,s=new ee(r),u=ue(pe.values());try{for(u.s();!(a=u.n()).done;){var c=a.value;s.addComponent(c)}}catch(e){u.e(e)}finally{u.f()}var l=new Ee(e,n,s);return ve.set(r,l),l}({apiKey:c.config.apiKey,authDomain:c.config.authDomain,projectId:c.config.projectId}),l._firestore=function(){return me(arguments.length>0&&void 0!==arguments[0]?arguments[0]:_e(),"firestore").getImmediate()}(l._firebaseApp),l._collection=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=W(e),bf("collection","path",t),e instanceof Tf){var a=wa.fromString.apply(wa,[t].concat(r));return Ef(a),new Nf(e,null,a)}if(!(e instanceof Sf||e instanceof Nf))throw new ra(na.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(wa.fromString.apply(wa,[t].concat(r)));return Ef(o),new Nf(e.firestore,null,o)}(l._firestore,l._name),l}return a}(),Eh=function e(i,a){var o=this;n(this,e),r(this,"_overall",[]),r(this,"_foreach",{}),r(this,"_mutex",new k(1)),r(this,"load",t(u.mark((function e(){var t,n,r,i,a;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o._docCollection.keys();case 2:return t=e.sent,o._overall=t,e.next=6,o._orderCollection.get(o._docCollection.name());case 6:if(!(n=e.sent)){e.next=16;break}if(o._foreach=n,!(a=null===(r=o._options)||void 0===r||null===(i=r.search)||void 0===i?void 0:i.orderBy)){e.next=14;break}return e.next=13,o.sort(a,t);case 13:o._overall=e.sent;case 14:e.next=19;break;case 16:return o._foreach={},e.next=19,o._orderCollection.set(o._docCollection.name(),o._foreach);case 19:case"end":return e.stop()}}),e)})))),r(this,"order",(function(){return o._overall})),r(this,"get",(function(e,t){var n={};return t.forEach((function(t){t in o._foreach&&(n[t]=o._foreach[t].indexOf(e))})),n})),r(this,"set",function(){var e=t(u.mark((function e(t){var n,r,i,a,s,c,l,f,h;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return n=[],r={},e.next=6,o._mutex.lock();case 6:e.t0=u.keys(t);case 7:if((e.t1=e.t0()).done){e.next=14;break}if("_"!==(i=e.t1.value)[0]){e.next=11;break}return e.abrupt("continue",7);case 11:"string"!=typeof t[i]&&"number"!=typeof t[i]||(i in o._foreach||(o._foreach[i]=[]),n.push(o._findIdx(i,t,0,o._foreach[i].length).then((function(e){Object.assign(r,e)})))),e.next=7;break;case 14:return e.next=16,Promise.all(n);case 16:for(a=0,s=Object.entries(r);a<s.length;a++)c=g(s[a],2),l=c[0],f=c[1],o._foreach[l].includes(t._id)||o._foreach[l].splice(f,0,t._id);return e.next=19,o._orderCollection.set(o._docCollection.name(),o._foreach);case 19:return h=e.sent,o._mutex.unlock(),e.abrupt("return",h);case 22:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"_findIdx",function(){var e=t(u.mark((function e(t,n,r,i){var a,s,c,l,f,h,d,v;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={},s=n[t],0!==i){e.next=11;break}if("number"!=typeof s&&"string"!=typeof s){e.next=8;break}return a[t]=0,e.abrupt("return",a);case 8:return e.abrupt("return",{});case 9:e.next=70;break;case 11:if(1!==i){e.next=34;break}return c=r,e.next=15,o._docCollection.get(o._foreach[t][c]);case 15:if(!(l=e.sent)){e.next=31;break}if(f=l[t],e.prev=18,"number"!=typeof s){e.next=24;break}return a[t]=s<=f?c:c+1,e.abrupt("return",a);case 24:if("string"!=typeof s){e.next=27;break}return a[t]=s<=f?c:c+1,e.abrupt("return",a);case 27:e.next=31;break;case 29:e.prev=29,e.t0=e.catch(18);case 31:return e.abrupt("return",{});case 34:return h=r+~~((i-1)/2),e.next=37,o._docCollection.get(o._foreach[t][h]);case 37:if(!(d=e.sent)){e.next=69;break}if(v=d[t],e.prev=40,"number"!=typeof s){e.next=54;break}if(!(s<=v)){e.next=48;break}return e.next=45,o._findIdx(t,n,r,h+1-r);case 45:e.t1=e.sent,e.next=51;break;case 48:return e.next=50,o._findIdx(t,n,h+1,r+i-1-h);case 50:e.t1=e.sent;case 51:return e.abrupt("return",e.t1);case 54:if("string"!=typeof s){e.next=65;break}if(!(s<=v)){e.next=61;break}return e.next=58,o._findIdx(t,n,r,h+1-r);case 58:e.t2=e.sent,e.next=64;break;case 61:return e.next=63,o._findIdx(t,n,h+1,r+i-1-h);case 63:e.t2=e.sent;case 64:return e.abrupt("return",e.t2);case 65:e.next=69;break;case 67:e.prev=67,e.t3=e.catch(40);case 69:return e.abrupt("return",{});case 70:case"end":return e.stop()}}),e,null,[[18,29],[40,67]])})));return function(t,n,r,i){return e.apply(this,arguments)}}()),r(this,"reset",t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t in o._foreach)o._foreach[t]=[];return e.next=3,o._orderCollection.set(o._docCollection.name(),o._foreach);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))),r(this,"sort",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){if(!e)return function(e,t){return 0};var t=[],n=e.map((function(e,n){return"-"===e[0]?(t[n]=-1,e=e.substring(1)):t[n]=1,e}));return function(e,r){if(n)for(var i=o.get(e,n),a=o.get(r,n),s=0;s<n.length;s++){var u=n[s];if(i[u]>a[u])return t[s];if(i[u]<a[u])return-t[s]}return 0}},e.abrupt("return",n.sort(r(t)));case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(this,"remove",function(){var e=t(u.mark((function e(t){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n in o._foreach)o._foreach[n]=o._foreach[n].filter((function(e){return e!==t}));return e.next=3,o._orderCollection.set(o._docCollection.name(),o._foreach);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"destroy",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o._orderCollection.remove(o._docCollection.name());case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))),this._docCollection=i,this._options=a;var s=a.storage.toLowerCase();if("json"===s)this._orderCollection=new C("_orders",this,a);else if("indexeddb"===s)this._orderCollection=new L("_orders",this,a);else{if("firestore"!==s)throw new Error("Invalid storage: ".concat(a.storage));this._orderCollection=new wh("_orders",this,a)}},_h=function e(i,a){var s=this;n(this,e),r(this,"init",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._order.load();case 2:case"end":return e.stop()}}),e)})))),r(this,"name",(function(){return s._name})),r(this,"keys",t(u.mark((function e(){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s._collection.keys());case 1:case"end":return e.stop()}}),e)})))),r(this,"get",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,s._collection.get(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"set",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",!1);case 2:if(e.prev=2,"string"==typeof n&&(n=JSON.parse(n)),"object"!==o(n)||!1!==Array.isArray(n)){e.next=15;break}return t=t||(new p).new(),Object.assign(n,{_id:t,_date:(new Date).getTime()}),e.next=9,s._collection.set(t,n);case 9:if(!(r=e.sent)){e.next=14;break}return e.next=13,s._order.set(n);case 13:return e.abrupt("return",e.sent);case 14:return e.abrupt("return",r);case 15:e.next=19;break;case 17:e.prev=17,e.t0=e.catch(2);case 19:return e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(t,n){return e.apply(this,arguments)}}()),r(this,"update",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&n){e.next=2;break}return e.abrupt("return",!1);case 2:if(e.prev=2,"string"!=typeof n){e.next=9;break}return e.next=6,s._collection.update(t,JSON.parse(n));case 6:return e.abrupt("return",e.sent);case 9:if("object"!==o(n)){e.next=13;break}return e.next=12,s._collection.update(t,n);case 12:return e.abrupt("return",e.sent);case 13:e.next=17;break;case 15:e.prev=15,e.t0=e.catch(2);case 17:return e.abrupt("return",!1);case 18:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n){return e.apply(this,arguments)}}()),r(this,"sort",function(){var e=t(u.mark((function e(t,n){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!Array.isArray(n)){e.next=4;break}e.t0=n,e.next=12;break;case 4:if(!("range"in s._options.search)){e.next=8;break}e.t1=s._options.search.range,e.next=11;break;case 8:return e.next=10,s.keys();case 10:e.t1=e.sent;case 11:e.t0=e.t1;case 12:if(n=e.t0,t=t&&Array.isArray(t)?t:"orderBy"in s._options.search?s._options.search.orderBy:[],n.length&&t.length){e.next=16;break}return e.abrupt("return",n);case 16:return e.abrupt("return",s._collection.sort(t,n));case 17:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(this,"search",function(){var e=t(u.mark((function e(t,n){var r,i,a,o;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new y(t),i=Object.assign({},s._options.search),!("range"in(n=n?Object.assign(i,n):i))||!Array.isArray(n.range)){e.next=7;break}e.t0=n.range,e.next=10;break;case 7:return e.next=9,s.keys();case 9:e.t0=e.sent;case 10:if(n.range=e.t0,n.range.length){e.next=13;break}return e.abrupt("return",[]);case 13:if(n.orderBy="orderBy"in n&&Array.isArray(n.orderBy)?n.orderBy:[],n.fuzzy="fuzzy"in n&&"boolean"==typeof n.fuzzy?n.fuzzy:i.fuzzy,n.limit="limit"in n&&"number"==typeof n.limit?n.limit:i.limit,n.exclude="exclude"in n&&Array.isArray(n.exclude)?n.exclude:[],!r||"invalid"===r.type()){e.next=26;break}return e.next=20,s._collection.search(r,n);case 20:if(a=e.sent,!n.orderBy.length){e.next=23;break}return e.abrupt("return",s.sort(n.orderBy,a));case 23:return e.abrupt("return",a);case 26:if(o=n.range.slice(0,n.limit),!n.orderBy.length){e.next=29;break}return e.abrupt("return",s.sort(n.orderBy,o));case 29:return e.abrupt("return",o);case 30:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(this,"remove",function(){var e=t(u.mark((function e(t){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,s._collection.remove(t);case 4:return(n=e.sent)&&s._order.remove(t),e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"clear",t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._collection.clear();case 2:return(t=e.sent)&&s._order.reset(),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))),r(this,"destory",t(u.mark((function e(){var t;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s._collection.destroy();case 2:return(t=e.sent)&&s._order.destroy(),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))),r(this,"import",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,s._collection.import(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"export",function(){var e=t(u.mark((function e(t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t||(t=s._order.order()),e.next=3,s._collection.export(t);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this._name=i,this._options=a,this._order=new Eh(this,a);var c=this._options.storage.toLowerCase();if("json"===c)this._collection=new C(i,this._order,this._options);else if("indexeddb"===c)this._collection=new L(i,this._order,this._options);else{if("firestore"!==c)throw new Error("Invalid storage: ".concat(this._options.storage));this._collection=new wh(i,this._order,this._options)}},Ih=function e(i){var a=this;n(this,e),r(this,"_options",{storage:"indexeddb",name:"document-manager",search:{fuzzy:!1,limit:Number.MAX_SAFE_INTEGER}}),r(this,"_collections",{}),r(this,"randomId",(function(){return(new p).new()})),r(this,"getCollectionNames",(function(){return Object.keys(a._collections)})),r(this,"collection",function(){var e=t(u.mark((function e(t,n){var r;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=t?t.toLowerCase():"").length&&"_orders"!==t){e.next=3;break}return e.abrupt("return",null);case 3:if(!(t in a._collections)){e.next=9;break}if(!a._collections[t]){e.next=8;break}return e.abrupt("return",a._collections[t]);case 8:delete a._collections[t];case 9:if(!(r=new _h(t.toLowerCase(),a._options))){e.next=24;break}if(!n){e.next=18;break}return e.t0=r,e.next=15,n.export();case 15:return e.t1=e.sent,e.next=18,e.t0.import.call(e.t0,e.t1);case 18:return e.next=20,r.init();case 20:return a._collections[t]=r,e.abrupt("return",r);case 24:return e.abrupt("return",null);case 25:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),r(this,"removeCollection",function(){var e=t(u.mark((function e(t){var n;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.length){e.next=2;break}return e.abrupt("return",!1);case 2:if(!(t in a._collections)){e.next=10;break}return e.next=5,a._collections[t].destory();case 5:return(n=e.sent)&&delete a._collections[t],e.abrupt("return",n);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r(this,"removeStorage",(function(){for(var e in a._collections)a._collections[e]&&a.removeCollection(e)})),Object.assign(this._options,i)};export{Ih as default};
